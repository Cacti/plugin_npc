npc.portlet.monitoringPerf=function(){var c="Monitoring Performance";var e="monitoringPerf";var d="npc.php?module=nagios&action=checkPerf&p_resolution=1";var f="dashcol2";var h=new Ext.data.JsonStore({url:d,totalProperty:"totalCount",root:"data",fields:["name","min","max","avg",],autoload:true});var i=new Ext.grid.ColumnModel([{dataIndex:"name",width:100},{header:"Min",dataIndex:"min",width:50},{header:"Max",dataIndex:"max",width:50},{header:"Avg",dataIndex:"avg",width:50}]);var a=new Ext.grid.GridPanel({id:e+"-grid",autoExpandColumn:"name",autoHeight:true,store:h,cm:i,stripeRows:true,view:new Ext.grid.GridView({forceFit:true,autoFill:true,scrollOffset:0})});var g={hide:function(){h.stopAutoRefresh()},show:function(){b()},collapse:function(){h.stopAutoRefresh()},expand:function(){b()}};function b(){h.startAutoRefresh(npc.params.npc_portlet_refresh)}npc.addPortlet(e,c,f);Ext.getCmp(e).items.add(a);Ext.getCmp("centerTabPanel").doLayout();a.render();h.load();if(Ext.getCmp(e).isVisible()){b()}Ext.getCmp(e).addListener(g)};npc.portlet.eventLog=function(){var d="Event Log";var h="eventLog";var g="dashcol2";var b=Ext.state.Manager.get(h).height;b=(b>150)?b:150;var a=new Ext.grid.ColumnModel([{dataIndex:"logentry_data",renderer:npc.renderEventIcon,width:25},{header:"Date",dataIndex:"entry_time",width:125,renderer:npc.formatDate,align:"left"},{header:"Log Entry",dataIndex:"logentry_data",width:600,align:"left"}]);var e=new npc.eventLogGrid({id:h+"-grid",height:b,enableDragDrop:false,cm:a,stripeRows:true,loadMask:{msg:"Loading..."}});npc.addPortlet(h,d,g);Ext.getCmp(h).items.add(e);Ext.getCmp("centerTabPanel").doLayout();if(Ext.getCmp(h).isVisible()){c()}var f={hide:function(){e.store.stopAutoRefresh()},show:function(){c()},collapse:function(){e.store.stopAutoRefresh()},expand:function(){c()}};Ext.getCmp(h).addListener(f);function c(){e.store.startAutoRefresh(npc.params.npc_portlet_refresh)}};npc.hostgroupServiceStatusGrid=Ext.extend(Ext.ux.grid.livegrid.GridPanel,{initComponent:function(){var a=new Ext.ux.grid.livegrid.JsonReader({root:"response.value.items",versionProperty:"response.value.version",totalProperty:"response.value.total_count",id:"service_object_id"},[{name:"hostgroup_name",sortType:"string"},{name:"alias",sortType:"string"},{name:"instance_id",type:"int",sortType:"int"},{name:"hostgroup_object_id",type:"int",sortType:"int"},{name:"critical",type:"int",sortType:"int"},{name:"warning",type:"int",sortType:"int"},{name:"unknown",type:"int",sortType:"int"},{name:"ok",type:"int",sortType:"int"},{name:"pending",type:"int",sortType:"int"}]);this.store=new Ext.ux.grid.livegrid.Store({autoLoad:true,bufferSize:100,reader:a,sortInfo:{field:"alias",direction:"ASC"},url:"npc.php?module=hostgroups&action=getHostgroupServiceStatus"});this.selModel=new Ext.ux.grid.livegrid.RowSelectionModel();this.view=new Ext.ux.grid.livegrid.GridView({nearLimit:30,forceFit:true,autoFill:true,emptyText:"No hostgroups.",loadMask:{msg:"Please wait..."}});this.bbar=new Ext.ux.grid.livegrid.Toolbar({view:this.view,displayInfo:true});npc.hostgroupServiceStatusGrid.superclass.initComponent.call(this)}});npc.portlet.hostgroupServiceStatus=function(){var b="Hostgroup: Service Status";var d="hostgroupServiceStatus";var e="dashcol2";var i=Ext.state.Manager.get(d).height;i=(i>150)?i:150;var h=new Ext.grid.ColumnModel([{header:"Hostgroup",dataIndex:"alias",sortable:true},{id:"hgSSCRITICAL",header:"Critical",dataIndex:"critical",align:"center",width:40,renderer:npc.renderStatusBg},{id:"hgSSWARNING",header:"Warning",dataIndex:"warning",align:"center",width:40,renderer:npc.renderStatusBg},{id:"hgSSUNKNOWN",header:"Unknown",dataIndex:"unknown",align:"center",width:40,renderer:npc.renderStatusBg},{id:"hgSSOK",header:"Ok",dataIndex:"ok",align:"center",width:20,renderer:npc.renderStatusBg},{id:"hgSSPENDING",header:"Pending",dataIndex:"pending",align:"center",width:40,renderer:npc.renderStatusBg}]);var a=new npc.hostgroupServiceStatusGrid({id:"hostgroup-service-status-grid",height:i,autoExpandColumn:"alias",cm:h,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),stripeRows:true,loadMask:{msg:"Loading..."}});npc.addPortlet(d,b,e);Ext.getCmp(d).items.add(a);Ext.getCmp("centerTabPanel").doLayout();a.render();if(Ext.getCmp(d).isVisible()){c()}var f={hide:function(){store.stopAutoRefresh()},show:function(){c()},collapse:function(){store.stopAutoRefresh()},expand:function(){c()}};Ext.getCmp(d).addListener(f);function c(){a.store.startAutoRefresh(npc.params.npc_portlet_refresh)}a.on("rowdblclick",g);a.on("rowcontextmenu",npc.hostgroupContextMenu);function g(k,n,m){var l=k.getStore().getAt(n).json.hostgroup_object_id;var j=k.getStore().getAt(n).json.alias;npc.hostgroupGrid("hostgroupGrid-"+l,"Hostgroup: "+j,l)}};npc.portlet.hostProblems=function(){var c="Host Problems";var e="hostProblems";var d="npc.php?module=hosts&action=getHosts&p_state=not_ok";var i=Ext.state.Manager.get(e).height;i=(i>150)?i:150;var f="dashcol2";var h=new Ext.grid.ColumnModel([{header:"Host",dataIndex:"host_name",sortable:true,renderer:npc.renderHostIcons,width:100},{header:"Alias",dataIndex:"alias",hidden:true,width:100},{header:"Status",dataIndex:"current_state",renderer:npc.hostStatusImage,align:"center",width:50},{header:"Plugin Output",dataIndex:"output",width:400}]);var a=new npc.hostsGrid({id:e+"-grid",height:i,filter:"not_ok",enableDragDrop:false,cm:h,stripeRows:true,loadMask:{msg:"Loading..."}});npc.addPortlet(e,c,f);Ext.getCmp(e).items.add(a);Ext.getCmp("centerTabPanel").doLayout();if(Ext.getCmp(e).isVisible()){b()}var g={hide:function(){a.store.stopAutoRefresh()},show:function(){b()},collapse:function(){store.stopAutoRefresh()},expand:function(){b()}};Ext.getCmp(e).addListener(g);function b(){a.store.startAutoRefresh(npc.params.npc_portlet_refresh)}a.on("rowdblclick",npc.hostGridClick);a.on("rowcontextmenu",npc.hostContextMenu)};npc.portlet.serviceProblems=function(){var b="Service Problems";var d="serviceProblems";var e="dashcol2";var i=Ext.state.Manager.get(d).height;i=(i>150)?i:150;var g=new Ext.grid.ColumnModel([{header:"Host",dataIndex:"host_name",renderer:npc.renderHostIcons,hidden:false},{header:"Host Alias",dataIndex:"host_alias",hidden:true},{header:"Host Address",dataIndex:"host_address",hidden:true},{header:"Service",dataIndex:"service_description",renderer:npc.renderServiceIcons,width:100},{header:"Status",dataIndex:"current_state",renderer:npc.serviceStatusImage,width:45},{header:"Plugin Output",dataIndex:"output",width:500}]);var a=new npc.servicesGrid({id:d+"-grid",height:i,filter:"not_ok",enableDragDrop:false,cm:g,stripeRows:true,loadMask:{msg:"Loading..."}});npc.addPortlet(d,b,e);Ext.getCmp(d).items.add(a);Ext.getCmp("centerTabPanel").doLayout();a.getBottomToolbar().add("","","","-","","",{text:"Unhandled",enableToggle:true,iconCls:"pageWhiteWrench",handler:h});if(Ext.getCmp(d).isVisible()){c()}var f={hide:function(){a.store.stopAutoRefresh()},show:function(){c()},collapse:function(){store.stopAutoRefresh()},expand:function(){c()}};Ext.getCmp(d).addListener(f);function c(){a.store.startAutoRefresh(npc.params.npc_portlet_refresh)}a.on("rowdblclick",npc.serviceGridClick);a.on("rowcontextmenu",npc.serviceContextMenu);function h(k){var j="npc.php?module=services&action=getServices&p_state=not_ok";if(k.pressed){j=j+"&p_unhandled=1";k.setText("All Problems")}else{k.setText("Unhandled")}a.store.proxy.conn.url=j;a.store.reload()}};npc.hostgroupHostStatusGrid=Ext.extend(Ext.ux.grid.livegrid.GridPanel,{filter:"any",initComponent:function(){var a=new Ext.ux.grid.livegrid.JsonReader({root:"response.value.items",versionProperty:"response.value.version",totalProperty:"response.value.total_count",id:"service_object_id"},[{name:"alias",sortType:"string"},{name:"instance_id",type:"int",sortType:"int"},{name:"hostgroup_object_id",type:"int",sortType:"int"},{name:"down",type:"int",sortType:"int"},{name:"unreachable",type:"int",sortType:"int"},{name:"up",type:"int",sortType:"int"},{name:"pending",type:"int",sortType:"int"}]);this.store=new Ext.ux.grid.livegrid.Store({autoLoad:true,bufferSize:100,reader:a,sortInfo:{field:"alias",direction:"ASC"},url:"npc.php?module=hostgroups&action=getHostgroupHostStatus"});this.selModel=new Ext.ux.grid.livegrid.RowSelectionModel();this.view=new Ext.ux.grid.livegrid.GridView({nearLimit:30,forceFit:true,autoFill:true,emptyText:"No hostgroups.",loadMask:{msg:"Please wait..."}});this.bbar=new Ext.ux.grid.livegrid.Toolbar({view:this.view,displayInfo:true});npc.hostgroupHostStatusGrid.superclass.initComponent.call(this)}});npc.portlet.hostgroupHostStatus=function(){var b="Hostgroup: Host Status";var d="hostgroupHostStatus";var e="dashcol2";var i=Ext.state.Manager.get(d).height;i=(i>150)?i:150;var h=new Ext.grid.ColumnModel([{header:"Hostgroup",dataIndex:"alias",sortable:true},{id:"hgHSDOWN",header:"Down",dataIndex:"down",align:"center",width:40,renderer:npc.renderStatusBg},{id:"hgHSUNREACHABLE",header:"Unreachable",dataIndex:"unreachable",align:"center",width:40,renderer:npc.renderStatusBg},{id:"hgHSUP",header:"Up",dataIndex:"up",align:"center",width:20,renderer:npc.renderStatusBg},{id:"hgHSPENDING",header:"Pending",dataIndex:"pending",align:"center",width:40,renderer:npc.renderStatusBg}]);var a=new npc.hostgroupHostStatusGrid({id:"hostgroup-host-status-grid",height:i,autoExpandColumn:"alias",cm:h,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),stripeRows:true,loadMask:{msg:"Loading..."}});npc.addPortlet(d,b,e);Ext.getCmp(d).items.add(a);Ext.getCmp("centerTabPanel").doLayout();a.render();if(Ext.getCmp(d).isVisible()){c()}var f={hide:function(){store.stopAutoRefresh()},show:function(){c()},collapse:function(){store.stopAutoRefresh()},expand:function(){c()}};Ext.getCmp(d).addListener(f);function c(){a.store.startAutoRefresh(npc.params.npc_portlet_refresh)}a.on("rowdblclick",g);function g(k,n,m){var l=k.getStore().getAt(n).json.hostgroup_object_id;var j=k.getStore().getAt(n).json.alias;npc.hostgroupGrid("hostgroupGrid-"+l,"Hostgroup: "+j,l)}};npc.servicegroupServiceStatusGrid=Ext.extend(Ext.ux.grid.livegrid.GridPanel,{filter:"any",initComponent:function(){var a=new Ext.ux.grid.livegrid.JsonReader({root:"response.value.items",versionProperty:"response.value.version",totalProperty:"response.value.total_count",id:"service_object_id"},[{name:"alias",sortType:"string"},{name:"instance_id",type:"int",sortType:"int"},{name:"servicegroup_object_id",type:"int",sortType:"int"},{name:"critical",type:"int",sortType:"int"},{name:"warning",type:"int",sortType:"int"},{name:"unknown",type:"int",sortType:"int"},{name:"ok",type:"int",sortType:"int"},{name:"pending",type:"int",sortType:"int"}]);this.store=new Ext.ux.grid.livegrid.Store({autoLoad:true,bufferSize:100,reader:a,sortInfo:{field:"alias",direction:"ASC"},url:"npc.php?module=servicegroups&action=getServicegroupServiceStatus"});this.selModel=new Ext.ux.grid.livegrid.RowSelectionModel();this.view=new Ext.ux.grid.livegrid.GridView({nearLimit:30,forceFit:true,autoFill:true,emptyText:"No servicegroups.",loadMask:{msg:"Please wait..."}});this.bbar=new Ext.ux.grid.livegrid.Toolbar({view:this.view,displayInfo:true});npc.servicegroupServiceStatusGrid.superclass.initComponent.call(this)}});npc.portlet.servicegroupServiceStatus=function(){var b="Servicegroup: Service Status";var d="servicegroupServiceStatus";var e="dashcol1";var i=Ext.state.Manager.get(d).height;i=(i>150)?i:150;var h=new Ext.grid.ColumnModel([{header:"Servicegroup",dataIndex:"alias",sortable:true},{id:"sgSSCRITICAL",header:"Critical",dataIndex:"critical",align:"center",width:40,renderer:npc.renderStatusBg},{id:"sgSSWARNING",header:"Warning",dataIndex:"warning",align:"center",width:40,renderer:npc.renderStatusBg},{id:"sgSSUNKNOWN",header:"Unknown",dataIndex:"unknown",align:"center",width:40,renderer:npc.renderStatusBg},{id:"sgSSOK",header:"Ok",dataIndex:"ok",align:"center",width:20,renderer:npc.renderStatusBg},{id:"sgSSPENDING",header:"Pending",dataIndex:"pending",align:"center",width:40,renderer:npc.renderStatusBg}]);var a=new npc.servicegroupServiceStatusGrid({id:"servicegroup-service-status-grid",height:i,autoExpandColumn:"alias",cm:h,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),stripeRows:true});npc.addPortlet(d,b,e);Ext.getCmp(d).items.add(a);Ext.getCmp("centerTabPanel").doLayout();a.render();if(Ext.getCmp(d).isVisible()){c()}var g={hide:function(){store.stopAutoRefresh()},show:function(){c()},collapse:function(){store.stopAutoRefresh()},expand:function(){c()}};Ext.getCmp(d).addListener(g);function c(){a.store.startAutoRefresh(npc.params.npc_portlet_refresh)}a.on("rowdblclick",f);function f(k,n,m){var l=k.getStore().getAt(n).json.servicegroup_object_id;var j=k.getStore().getAt(n).json.alias;npc.servicegroupGrid("servicegroupGrid-"+l,"Servicegroup: "+j,l)}};npc.serviceSummary=function(){var d="Service Status Summary";var h="serviceSummary";var c="npc.php?module=services&action=summary";var f=npc.params.npc_portlet_refresh;var b=new Ext.data.JsonStore({url:c,totalProperty:"totalCount",root:"data",fields:["critical","warning","unknown","ok","pending"],autoload:true});var a=new Ext.grid.ColumnModel([{id:"serviceTotalsCRITICAL",header:"Critical",dataIndex:"critical",renderer:npc.renderStatusBg,width:80,align:"center"},{id:"serviceTotalsWARNING",header:"Warning",dataIndex:"warning",renderer:npc.renderStatusBg,width:80,align:"center"},{id:"serviceTotalsUNKNOWN",header:"Unknown",dataIndex:"unknown",renderer:npc.renderStatusBg,width:80,align:"center"},{id:"serviceTotalsOK",header:"Ok",dataIndex:"ok",renderer:npc.renderStatusBg,width:80,align:"center"},{id:"serviceTotalsPENDING",header:"Pending",dataIndex:"pending",renderer:npc.renderStatusBg,width:80,align:"center"}]);var e=new Ext.grid.GridPanel({title:d,id:h+"-grid",autoHeight:true,width:400,store:b,cm:a,view:new Ext.grid.GridView({forceFit:true,autoFill:true,scrollOffset:0})});Ext.getCmp("serviceStatusCol").add(e);Ext.getCmp("north-panel").doLayout();e.render();e.store.load();b.startAutoRefresh(f);e.on("cellclick",g);function g(k,n,j,l){var i=k.getStore().getAt(n);var m=k.getColumnModel().getDataIndex(j);npc.services("Services: "+m.substr(0,1).toUpperCase()+m.substr(1),m)}};npc.servicegroupHostStatusGrid=Ext.extend(Ext.ux.grid.livegrid.GridPanel,{filter:"any",initComponent:function(){var a=new Ext.ux.grid.livegrid.JsonReader({root:"response.value.items",versionProperty:"response.value.version",totalProperty:"response.value.total_count",id:"service_object_id"},[{name:"alias",sortType:"string"},{name:"instance_id",type:"int",sortType:"int"},{name:"servicegroup_object_id",type:"int",sortType:"int"},{name:"down",type:"int",sortType:"int"},{name:"unreachable",type:"int",sortType:"int"},{name:"up",type:"int",sortType:"int"},{name:"pending",type:"int",sortType:"int"}]);this.store=new Ext.ux.grid.livegrid.Store({autoLoad:true,bufferSize:100,reader:a,sortInfo:{field:"alias",direction:"ASC"},url:"npc.php?module=servicegroups&action=getHostStatusPortlet"});this.selModel=new Ext.ux.grid.livegrid.RowSelectionModel();this.view=new Ext.ux.grid.livegrid.GridView({nearLimit:30,forceFit:true,autoFill:true,emptyText:"No hostgroups.",loadMask:{msg:"Please wait..."}});this.bbar=new Ext.ux.grid.livegrid.Toolbar({view:this.view,displayInfo:true});npc.servicegroupHostStatusGrid.superclass.initComponent.call(this)}});npc.portlet.servicegroupHostStatus=function(){var b="Servicegroup: Host Status";var d="servicegroupHostStatus";var e="dashcol2";var i=Ext.state.Manager.get(d).height;i=(i>150)?i:150;var h=new Ext.grid.ColumnModel([{header:"Servicegroup",dataIndex:"alias",sortable:true},{id:"sgHSDOWN",header:"Down",dataIndex:"down",align:"center",width:40,renderer:npc.renderStatusBg},{id:"sgHSUNREACHABLE",header:"Unreachable",dataIndex:"unreachable",align:"center",width:40,renderer:npc.renderStatusBg},{id:"sgHSUP",header:"Up",dataIndex:"up",align:"center",width:20,renderer:npc.renderStatusBg},{id:"sgHSPENDING",header:"Pending",dataIndex:"pending",align:"center",width:40,renderer:npc.renderStatusBg}]);var a=new npc.servicegroupHostStatusGrid({id:"servicegroup-host-status-grid",height:i,autoExpandColumn:"alias",cm:h,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),stripeRows:true});npc.addPortlet(d,b,e);Ext.getCmp(d).items.add(a);Ext.getCmp("centerTabPanel").doLayout();a.render();if(Ext.getCmp(d).isVisible()){c()}var g={hide:function(){store.stopAutoRefresh()},show:function(){c()},collapse:function(){store.stopAutoRefresh()},expand:function(){c()}};Ext.getCmp(d).addListener(g);function c(){a.store.startAutoRefresh(npc.params.npc_portlet_refresh)}a.on("rowdblclick",f);function f(k,n,m){var l=k.getStore().getAt(n).json.servicegroup_object_id;var j=k.getStore().getAt(n).json.alias;npc.servicegroupGrid("servicegroupGrid-"+l,"Servicegroup: "+j,l)}};npc.hostSummary=function(){var d="Host Status Summary";var h="hostSummary";var c="npc.php?module=hosts&action=summary";var f=npc.params.npc_portlet_refresh;var b=new Ext.data.JsonStore({url:c,totalProperty:"totalCount",root:"data",fields:["down","unreachable","up","pending"],autoload:true});var a=new Ext.grid.ColumnModel([{id:"hostTotalsDOWN",header:"Down",dataIndex:"down",renderer:npc.renderStatusBg,width:100,align:"center"},{id:"hostTotalsUNREACHABLE",header:"Unreachable",dataIndex:"unreachable",renderer:npc.renderStatusBg,width:100,align:"center"},{id:"hostTotalsUP",header:"Up",dataIndex:"up",renderer:npc.renderStatusBg,width:100,align:"center"},{id:"hostTotalsPENDING",header:"Pending",dataIndex:"pending",renderer:npc.renderStatusBg,width:100,align:"center"}]);var e=new Ext.grid.GridPanel({title:d,id:"host-status-summary-grid",autoHeight:true,width:400,store:b,cm:a,view:new Ext.grid.GridView({forceFit:true,autoFill:true,scrollOffset:0})});Ext.getCmp("hostStatusCol").add(e);Ext.getCmp("north-panel").doLayout();e.render();e.store.load();b.startAutoRefresh(f);e.on("cellclick",g);function g(k,n,j,l){var i=k.getStore().getAt(n);var m=k.getColumnModel().getDataIndex(j);npc.hosts("Hosts: "+m.substr(0,1).toUpperCase()+m.substr(1),m)}};npc.nagiosStatus=function(){var b="Nagios Status";var d="nagiosStatus";var c="npc.php?module=nagios&action=getProgramStatus";var f=npc.params.npc_portlet_refresh;var h=new Ext.data.JsonStore({url:c,totalProperty:"totalCount",root:"data",fields:[{name:"is_currently_running",type:"int"},{name:"process_id",type:"int"},{name:"notifications_enabled",type:"int"},{name:"active_service_checks_enabled",type:"int"},{name:"active_host_checks_enabled",type:"int"},{name:"status_update_time",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"server_time",type:"date",dateFormat:"Y-m-d H:i:s"}],autoload:true});var i=new Ext.grid.ColumnModel([{header:"Nagios",dataIndex:"is_currently_running",renderer:g,width:80,align:"center"},{header:"Notifications",dataIndex:"notifications_enabled",renderer:e,width:80,align:"center"},{header:"Host Checks",dataIndex:"active_host_checks_enabled",renderer:e,width:80,align:"center"},{header:"Service Checks",dataIndex:"active_service_checks_enabled",renderer:e,width:80,align:"center"}]);var a=new Ext.grid.GridPanel({title:b,id:d+"-grid",autoHeight:true,width:400,store:h,cm:i,view:new Ext.grid.GridView({forceFit:true,autoFill:true,scrollOffset:0})});Ext.getCmp("nagiosStatusCol").add(a);Ext.getCmp("north-panel").doLayout();a.render();a.store.load();h.startAutoRefresh(f);function g(k,j,p){s=k?"On":"Off";if(s=="On"){var o=p.data.status_update_time;var n=p.data.server_time;var q=new Date();var l=n.dateFormat("U")-o.dateFormat("U");s=(l>60)?"Off":"On"}bg=s.match("On")?"33FF00":"F83838";j.attr='style="background-color: #'+bg+';"';return String.format("<b>{0}</b>",s)}function e(k,j,l){if(!l.data.is_currently_running){s="NA";bg="C0C0C0"}else{s=k?"Enabled":"Disabled";bg=s.match("Enabled")?"33FF00":"F83838"}j.attr='style="background-color: #'+bg+';"';return String.format("<b>{0}</b>",s)}};