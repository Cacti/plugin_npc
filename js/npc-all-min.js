Ext.namespace("Ext.ux","Ext.ux.grid");Ext.ux.grid.Search=function(a){Ext.apply(this,a,{position:"bottom",searchText:"Search",searchTipText:"Type a text to search and press Enter",iconCls:"ux-icon-search",checkIndexes:"all",disableIndexes:[],dateFormat:undefined,mode:"remote",paramNames:{fields:"p_searchFields",query:"p_searchString"}});Ext.ux.grid.Search.superclass.constructor.call(this)};Ext.extend(Ext.ux.grid.Search,Ext.util.Observable,{init:function(a){this.grid=a;a.onRender=a.onRender.createSequence(this.onRender,this);a.reconfigure=a.reconfigure.createSequence(this.reconfigure,this)},onRender:function(){var b=this.grid;var a="bottom"==this.position?b.bottomToolbar:b.topToolbar;this.menu=new Ext.menu.Menu();a.addSeparator();a.add({text:this.searchText,menu:this.menu,iconCls:this.iconCls});this.field=new Ext.form.TwinTriggerField({width:this.width,selectOnFocus:undefined===this.selectOnFocus?true:this.selectOnFocus,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",onTrigger1Click:this.onTriggerClear.createDelegate(this),onTrigger2Click:this.onTriggerSearch.createDelegate(this)});this.field.on("render",function(){this.field.el.dom.qtip=this.searchTipText;var c=new Ext.KeyMap(this.field.el,[{key:Ext.EventObject.ENTER,scope:this,fn:this.onTriggerSearch},{key:Ext.EventObject.ESC,scope:this,fn:this.onTriggerClear}]);c.stopEvent=true},this,{single:true});a.add(this.field);this.reconfigure()},onTriggerClear:function(){this.field.setValue("");this.field.focus();this.onTriggerSearch()},onTriggerSearch:function(){var c=this.field.getValue();var b=this.grid.store;if("local"===this.mode){b.clearFilter();if(c){b.filterBy(function(e){var d=false;this.menu.items.each(function(g){if(!g.checked||d){return}var h=e.get(g.dataIndex);h=h instanceof Date?h.format(this.dateFormat||e.fields.get(g.dataIndex).dateFormat):h;var f=new RegExp(c,"gi");d=f.test(h)},this);if(d){return true}return d},this)}else{}}else{if(b.lastOptions){b.lastOptions.params[b.paramNames.start]=0}var a=[];this.menu.items.each(function(d){if(d.checked){a.push(d.dataIndex)}});delete (b.baseParams[this.paramNames.fields]);delete (b.baseParams[this.paramNames.query]);delete (b.lastOptions.params[this.paramNames.fields]);delete (b.lastOptions.params[this.paramNames.query]);if(a.length){b.baseParams[this.paramNames.fields]=Ext.encode(a);b.baseParams[this.paramNames.query]=c}b.reload()}},reconfigure:function(){var b=this.menu;b.removeAll();var a=this.grid.colModel;Ext.each(a.config,function(d){var c=false;if(d.header){Ext.each(this.disableIndexes,function(e){c=c?c:e===d.dataIndex});if(!c){b.add(new Ext.menu.CheckItem({text:d.header,hideOnClick:false,checked:"all"===this.checkIndexes,dataIndex:d.dataIndex}))}}},this);if(this.checkIndexes instanceof Array){Ext.each(this.checkIndexes,function(d){var c=b.items.find(function(e){return e.dataIndex===d});if(c){c.setChecked(true,true)}},this)}}});Ext.state.HttpProvider=function(a){Ext.state.HttpProvider.superclass.constructor.call(this);this.url="";Ext.apply(this,a);this.state=this.readValues()};Ext.extend(Ext.state.HttpProvider,Ext.state.Provider,{set:function(a,b){if(typeof b=="undefined"||b===null){this.clear(a);return}this.setValue(a,b);Ext.state.HttpProvider.superclass.set.call(this,a,b)},clear:function(a){this.clearValue(a);Ext.state.HttpProvider.superclass.clear.call(this,a)},readValues:function(){var b={};for(var a in ExtState){if(a!="remove"){b[a]=this.decodeValue(ExtState[a])}}return b},setValue:function(a,c){var b=new Ext.data.Connection();b.request({url:this.url,params:{task:"set",p_name:a,p_value:this.encodeValue(c)}})},clearValue:function(a){var b=new Ext.data.Connection();b.request({url:this.url,params:{task:"set",name:a,value:"null"}})}});Ext.ns("Ext.ux.form");Ext.ux.form.XCheckbox=Ext.extend(Ext.form.Checkbox,{submitOffValue:"false",submitOnValue:"true",onRender:function(){this.inputValue=this.submitOnValue;Ext.ux.form.XCheckbox.superclass.onRender.apply(this,arguments);this.hiddenField=this.wrap.insertFirst({tag:"input",type:"hidden"});if(this.tooltip){this.imageEl.set({qtip:this.tooltip})}this.updateHidden()},setValue:function(a){a=this.convertValue(a);this.updateHidden(a);Ext.ux.form.XCheckbox.superclass.setValue.apply(this,arguments)},updateHidden:function(a){a=undefined!==a?a:this.checked;a=this.convertValue(a);if(this.hiddenField){this.hiddenField.dom.value=a?this.submitOnValue:this.submitOffValue;this.hiddenField.dom.name=a?"":this.el.dom.name}},convertValue:function(a){return(a===true||a==="true"||a===this.submitOnValue||String(a).toLowerCase()==="on")}});Ext.reg("xcheckbox",Ext.ux.form.XCheckbox);Ext.namespace("Ext.ux.Andrie");Ext.ux.Andrie.pPageSize=function(a){Ext.apply(this,a)};Ext.extend(Ext.ux.Andrie.pPageSize,Ext.util.Observable,{beforeText:"Rows",afterText:"",addBefore:"-",addAfter:null,dynamic:false,variations:[5,10,15,20,25,30,35,40,45,50,100,200,300,400,500,1000,2000,4000],comboCfg:undefined,init:function(a){this.pagingToolbar=a;this.pagingToolbar.pageSizeCombo=this;this.pagingToolbar.setPageSize=this.setPageSize.createDelegate(this);this.pagingToolbar.getPageSize=function(){return this.pageSize};this.pagingToolbar.on("render",this.onRender,this)},addSize:function(a){if(a>0){this.sizes.push([a])}},updateStore:function(){if(this.dynamic){var b=this.pagingToolbar.pageSize,e;b=(b>0)?b:1;this.sizes=[];var c=this.variations;for(var d=0,a=c.length;d<a;d++){this.addSize(b-c[c.length-1-d])}this.addToStore(b);for(var d=0,a=c.length;d<a;d++){this.addSize(b+c[d])}}else{if(!this.staticSizes){this.sizes=[];var c=this.variations;var b=0;for(var d=0,a=c.length;d<a;d++){this.addSize(b+c[d])}this.staticSizes=this.sizes.slice(0)}else{this.sizes=this.staticSizes.slice(0)}}this.combo.store.loadData(this.sizes);this.combo.collapse();this.combo.setValue(this.pagingToolbar.pageSize)},setPageSize:function(g,k){var l=this.pagingToolbar;this.combo.collapse();g=parseInt(g)||parseInt(this.combo.getValue());g=(g>0)?g:1;if(g==l.pageSize){return}else{if(g<l.pageSize){l.pageSize=g;var b=Math.round(l.cursor/g)+1;var j=(b-1)*g;var h=l.store;if(j>h.getTotalCount()){this.pagingToolbar.pageSize=g;this.pagingToolbar.doLoad(j-g)}else{h.suspendEvents();for(var c=0,e=j-l.cursor;c<e;c++){h.remove(h.getAt(0))}while(h.getCount()>g){h.remove(h.getAt(h.getCount()-1))}h.resumeEvents();h.fireEvent("datachanged",h);l.cursor=j;var f=l.getPageData();l.afterTextEl.el.innerHTML=String.format(l.afterPageText,f.pages);l.field.dom.value=b;l.first.setDisabled(b==1);l.prev.setDisabled(b==1);l.next.setDisabled(b==f.pages);l.last.setDisabled(b==f.pages);l.updateInfo()}}else{this.pagingToolbar.pageSize=g;this.pagingToolbar.doLoad(Math.floor(this.pagingToolbar.cursor/this.pagingToolbar.pageSize)*this.pagingToolbar.pageSize)}}var a=Ext.state.Manager.get(this.gridId);if(a){a.rows=g}else{a={rows:g}}Ext.state.Manager.set(this.gridId,a);this.updateStore()},onRender:function(){this.combo=Ext.ComponentMgr.create(Ext.applyIf(this.comboCfg||{},{store:new Ext.data.SimpleStore({fields:["pageSize"],data:[]}),displayField:"pageSize",valueField:"pageSize",mode:"local",triggerAction:"all",width:50,xtype:"combo"}));this.combo.on("select",this.setPageSize,this);this.updateStore();if(this.addBefore){this.pagingToolbar.add(this.addBefore)}if(this.beforeText){this.pagingToolbar.add(this.beforeText)}this.pagingToolbar.add(this.combo);if(this.afterText){this.pagingToolbar.add(this.afterText)}if(this.addAfter){this.pagingToolbar.add(this.addAfter)}}});Ext.namespace("Ext.ux.grid.livegrid");Ext.ux.grid.livegrid.GridPanel=Ext.extend(Ext.grid.GridPanel,{onRender:function(c,a){Ext.ux.grid.livegrid.GridPanel.superclass.onRender.call(this,c,a);var b=this.getStore();if(b._autoLoad===true){delete b._autoLoad;b.load()}},walkCells:function(b,g,d,e,f){var c=this.store;var a=c.getCount;c.getCount=c.getTotalCount;var h=Ext.ux.grid.livegrid.GridPanel.superclass.walkCells.call(this,b,g,d,e,f);c.getCount=a;return h}});Ext.namespace("Ext.ux.grid.livegrid");Ext.ux.grid.livegrid.GridView=function(a){this.addEvents({beforebuffer:true,buffer:true,bufferfailure:true,cursormove:true});this.horizontalScrollOffset=17;this.loadMask=false;Ext.apply(this,a);this.templates={};this.templates.master=new Ext.Template('<div class="x-grid3" hidefocus="true"><div class="ext-ux-livegrid-liveScroller"><div></div></div>','<div class="x-grid3-viewport"">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset">{header}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller" style="overflow-y:hidden !important;"><div class="x-grid3-body">{body}</div><a href="#" class="x-grid3-focus" tabIndex="-1"></a></div>',"</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>");this._gridViewSuperclass=Ext.ux.grid.livegrid.GridView.superclass;this._gridViewSuperclass.constructor.call(this)};Ext.extend(Ext.ux.grid.livegrid.GridView,Ext.grid.GridView,{_maskIndex:20001,hdHeight:0,rowClipped:0,liveScroller:null,liveScrollerInset:null,rowHeight:-1,visibleRows:1,lastIndex:-1,lastRowIndex:0,lastScrollPos:0,rowIndex:0,isBuffering:false,requestQueue:-1,loadMask:null,isPrebuffering:false,reset:function(b){if(b===false){this.ds.modified=[];this.rowIndex=0;this.lastScrollPos=0;this.lastRowIndex=0;this.lastIndex=0;this.adjustVisibleRows();this.adjustScrollerPos(-this.liveScroller.dom.scrollTop,true);this.showLoadMask(false);this.refresh(true);this.fireEvent("cursormove",this,0,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength);return false}else{var c={};var a=this.ds.sortInfo;if(a){c={dir:a.direction,sort:a.field}}return this.ds.load({params:c})}},renderUI:function(){var a=this.grid;var b=a.enableDragDrop||a.enableDrag;a.enableDragDrop=false;a.enableDrag=false;this._gridViewSuperclass.renderUI.call(this);var a=this.grid;a.enableDragDrop=b;a.enableDrag=b;if(b){this.dragZone=new Ext.ux.grid.livegrid.DragZone(a,{ddGroup:a.ddGroup||"GridDD"})}if(this.loadMask){this.loadMask=new Ext.LoadMask(this.mainBody.dom.parentNode.parentNode,this.loadMask)}},init:function(a){this._gridViewSuperclass.init.call(this,a);a.on("expand",this._onExpand,this)},initData:function(b,a){if(this.ds){this.ds.un("bulkremove",this.onBulkRemove,this);this.ds.un("beforeload",this.onBeforeLoad,this)}if(b){b.on("bulkremove",this.onBulkRemove,this);b.on("beforeload",this.onBeforeLoad,this)}this._gridViewSuperclass.initData.call(this,b,a)},renderBody:function(){var a=this.renderRows(0,this.visibleRows-1);return this.templates.body.apply({rows:a})},doRender:function(e,f,c,a,d,b){return this._gridViewSuperclass.doRender.call(this,e,f,c,a+this.ds.bufferRange[0],d,b)},initElements:function(){var b=Ext.Element;var d=this.grid.getGridEl().dom.firstChild;var a=d.childNodes;this.el=new b(d);this.mainWrap=new b(a[1]);this.liveScroller=new b(a[0]);this.liveScrollerInset=this.liveScroller.dom.firstChild;this.liveScroller.on("scroll",this.onLiveScroll,this,{buffer:this.scrollDelay});var c=this.mainWrap.dom.firstChild;this.mainHd=new b(c);this.hdHeight=c.offsetHeight;this.innerHd=this.mainHd.dom.firstChild;this.scroller=new b(this.mainWrap.dom.childNodes[1]);if(this.forceFit){this.scroller.setStyle("overflow-x","hidden")}this.mainBody=new b(this.scroller.dom.firstChild);this.mainBody.on("mousewheel",this.handleWheel,this);this.focusEl=new b(this.scroller.dom.childNodes[1]);this.focusEl.swallowEvent("click",true);this.resizeMarker=new b(a[2]);this.resizeProxy=new b(a[3])},layout:function(){if(!this.mainBody){return}var i=this.grid;var g=i.getGridEl(),e=this.cm,c=i.autoExpandColumn,d=this;var b=g.getSize(true);var f=b.width;if(f<20||b.height<20){return}if(i.autoHeight){this.scroller.dom.style.overflow="visible"}else{this.el.setSize(b.width,b.height);var h=this.mainHd.getHeight();var a=b.height-(h);this.scroller.setSize(f,a);if(this.innerHd){this.innerHd.style.width=(f)+"px"}}this.liveScroller.dom.style.top=this.hdHeight+"px";if(this.forceFit){if(this.lastViewWidth!=f){this.fitColumns(false,false);this.lastViewWidth=f}}else{this.autoExpand()}this.adjustVisibleRows();this.adjustBufferInset();this.onLayout(f,a)},removeRow:function(a){Ext.removeNode(this.getRow(a))},removeRows:function(c,a){var d=this.mainBody.dom;for(var b=c;b<=a;b++){Ext.removeNode(d.childNodes[c])}},_onExpand:function(a){this.adjustVisibleRows();this.adjustBufferInset();this.adjustScrollerPos(this.rowHeight*this.rowIndex,true)},onColumnMove:function(a,b,c){this.indexMap=null;this.replaceLiveRows(this.rowIndex,true);this.updateHeaders();this.updateHeaderSortState();this.afterMove(c)},onColumnWidthUpdated:function(b,a,c){this.adjustVisibleRows();this.adjustBufferInset()},onAllColumnWidthsUpdated:function(a,b){this.adjustVisibleRows();this.adjustBufferInset()},onRowSelect:function(a){if(a<this.rowIndex||a>this.rowIndex+this.visibleRows){return}this.addRowClass(a,"x-grid3-row-selected")},onRowDeselect:function(a){if(a<this.rowIndex||a>this.rowIndex+this.visibleRows){return}this.removeRowClass(a,"x-grid3-row-selected")},onClear:function(){this.reset(false)},onBulkRemove:function(h,g){var l=null;var j=0;var e=0;var i=g.length;var d=false;var k=false;var n=0;if(i==0){return}var b=this.rowIndex;var c=0;var o=0;var a=0;for(var m=0;m<i;m++){l=g[m][0];j=g[m][1];e=(j!=Number.MIN_VALUE&&j!=Number.MAX_VALUE)?j+this.ds.bufferRange[0]:j;if(e<this.rowIndex){c++}else{if(e>=this.rowIndex&&e<=this.rowIndex+(this.visibleRows-1)){a++}else{if(e>=this.rowIndex+this.visibleRows){o++}}}this.fireEvent("beforerowremoved",this,e,l);this.fireEvent("rowremoved",this,e,l)}var f=this.ds.totalLength;this.rowIndex=Math.max(0,Math.min(this.rowIndex-c,f-(this.visibleRows-1)));this.lastRowIndex=this.rowIndex;this.adjustScrollerPos(-(c*this.rowHeight),true);this.updateLiveRows(this.rowIndex,true);this.adjustBufferInset();this.processRows(0,undefined,false)},onRemove:function(b,a,c){this.onBulkRemove(b,[[a,c]])},onAdd:function(c,b,g){var h=b.length;if(g==Number.MAX_VALUE||g==Number.MIN_VALUE){this.fireEvent("beforerowsinserted",this,g,g);if(g==Number.MIN_VALUE){this.rowIndex=this.rowIndex+h;this.lastRowIndex=this.rowIndex;this.adjustBufferInset();this.adjustScrollerPos(this.rowHeight*h,true);this.fireEvent("rowsinserted",this,g,g,h);this.processRows(0,undefined,false);this.fireEvent("cursormove",this,this.rowIndex,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength);return}this.adjustBufferInset();this.fireEvent("rowsinserted",this,g,g,h);return}var d=g+this.ds.bufferRange[0];var i=d+(h-1);var f=this.getRows().length;var a=0;var e=0;if(d>this.rowIndex+(this.visibleRows-1)){this.fireEvent("beforerowsinserted",this,d,i);this.fireEvent("rowsinserted",this,d,i,h);this.adjustVisibleRows();this.adjustBufferInset()}else{if(d>=this.rowIndex&&d<=this.rowIndex+(this.visibleRows-1)){a=g;e=g+(h-1);this.lastRowIndex=this.rowIndex;this.rowIndex=(d>this.rowIndex)?this.rowIndex:d;this.insertRows(c,a,e);if(this.lastRowIndex!=this.rowIndex){this.fireEvent("cursormove",this,this.rowIndex,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength)}this.adjustVisibleRows();this.adjustBufferInset()}else{if(d<this.rowIndex){this.fireEvent("beforerowsinserted",this,d,i);this.rowIndex=this.rowIndex+h;this.lastRowIndex=this.rowIndex;this.adjustVisibleRows();this.adjustBufferInset();this.adjustScrollerPos(this.rowHeight*h,true);this.fireEvent("rowsinserted",this,d,i,h);this.processRows(0,undefined,true);this.fireEvent("cursormove",this,this.rowIndex,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength)}}}},onBeforeLoad:function(c,b){b.params=b.params||{};var a=Ext.apply;a(b,{scope:this,callback:function(){this.reset(false)}});a(b.params,{start:0,limit:this.ds.bufferSize});return true},onLoad:function(b,c,a){this.adjustBufferInset()},onDataChange:function(a){this.updateHeaderSortState()},liveBufferUpdate:function(a,d,b){if(b===true){this.fireEvent("buffer",this,this.ds,this.rowIndex,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength,d);this.isBuffering=false;this.isPrebuffering=false;this.showLoadMask(false);this.grid.selModel.replaceSelections(a);if(this.isInRange(this.rowIndex)){this.replaceLiveRows(this.rowIndex,d.forceRepaint)}else{this.updateLiveRows(this.rowIndex)}if(this.requestQueue>=0){var c=this.requestQueue;this.requestQueue=-1;this.updateLiveRows(c)}return}else{this.fireEvent("bufferfailure",this,this.ds,d)}this.requestQueue=-1;this.isBuffering=false;this.isPrebuffering=false;this.showLoadMask(false)},handleWheel:function(a){if(this.rowHeight==-1){a.stopEvent();return}var b=a.getWheelDelta();this.adjustScrollerPos(-(b*this.rowHeight));a.stopEvent()},onLiveScroll:function(){var a=this.liveScroller.dom.scrollTop;var b=Math.floor((a)/this.rowHeight);this.rowIndex=b;if(b==this.lastRowIndex){return}this.updateLiveRows(b);this.lastScrollPos=this.liveScroller.dom.scrollTop},refreshRow:function(a){var b=this.ds,c;if(typeof a=="number"){c=a;a=b.getAt(c)}else{c=b.indexOf(a)}var d=c+this.ds.bufferRange[0];if(d<this.rowIndex||d>=this.rowIndex+this.visibleRows){this.fireEvent("rowupdated",this,d,a);return}this.insertRows(b,c,c,true);this.fireEvent("rowupdated",this,d,a)},processRows:function(j,k,n){k=k||!this.grid.stripeRows;j=0;var e=this.getRows();var h=" x-grid3-row-alt ";var i=this.rowIndex;var l=0;var d=this.grid.selModel.selections;var c=this.ds;var f=null;for(var a=j,m=e.length;a<m;a++){l=a+i;f=e[a];f.rowIndex=l;if(n!==false){if(this.grid.selModel.isSelected(this.ds.getAt(l))===true){this.addRowClass(l,"x-grid3-row-selected")}else{this.removeRowClass(l,"x-grid3-row-selected")}this.fly(f).removeClass("x-grid3-row-over")}if(!k){var b=((l+1)%2==0);var g=(" "+f.className+" ").indexOf(h)!=-1;if(b==g){continue}if(b){f.className+=" x-grid3-row-alt"}else{f.className=f.className.replace("x-grid3-row-alt","")}}}},insertRows:function(m,c,e,f){var d=c+this.ds.bufferRange[0];var l=e+this.ds.bufferRange[0];if(!f){this.fireEvent("beforerowsinserted",this,d,l)}if(f!==true&&(this.getRows().length+(e-c))>=this.visibleRows){this.removeRows((this.visibleRows-1)-(e-c),this.visibleRows-1)}else{if(f){this.removeRows(d-this.rowIndex,l-this.rowIndex)}}var k=(c==e)?e:Math.min(e,(this.rowIndex-this.ds.bufferRange[0])+(this.visibleRows-1));var a=this.renderRows(c,k);var i=this.getRow(d);if(i){Ext.DomHelper.insertHtml("beforeBegin",i,a)}else{Ext.DomHelper.insertHtml("beforeEnd",this.mainBody.dom,a)}if(f===true){var g=this.getRows();var h=this.rowIndex;for(var b=0,j=g.length;b<j;b++){g[b].rowIndex=h+b}}if(!f){this.fireEvent("rowsinserted",this,d,l,(l-d)+1);this.processRows(0,undefined,true)}},getRow:function(a){if(a-this.rowIndex<0){return null}return this.getRows()[a-this.rowIndex]},getCell:function(b,a){var b=this.getRow(b);return b?b.getElementsByTagName("td")[a]:null},focusCell:function(b,a,c){var d=this.ensureVisible(b,a,c);if(!d){return}this.focusEl.setXY(d);if(Ext.isGecko){this.focusEl.focus()}else{this.focusEl.focus.defer(1,this.focusEl)}},ensureVisible:function(e,b,c){if(typeof e!="number"){e=e.rowIndex}if(e<0||e>=this.ds.totalLength){return}b=(b!==undefined?b:0);var h=e-this.rowIndex;if(this.rowClipped&&e==this.rowIndex+this.visibleRows-1){this.adjustScrollerPos(this.rowHeight)}else{if(e>=this.rowIndex+this.visibleRows){this.adjustScrollerPos(((e-(this.rowIndex+this.visibleRows))+1)*this.rowHeight)}else{if(e<=this.rowIndex){this.adjustScrollerPos((h)*this.rowHeight)}}}var i=this.getRow(e),a;if(!i){return}if(!(c===false&&b===0)){while(this.cm.isHidden(b)){b++}a=this.getCell(e,b)}var f=this.scroller.dom;if(c!==false){var g=parseInt(a.offsetLeft,10);var j=g+a.offsetWidth;var k=parseInt(f.scrollLeft,10);var d=k+f.clientWidth;if(g<k){f.scrollLeft=g}else{if(j>d){f.scrollLeft=j-f.clientWidth}}}return a?Ext.fly(a).getXY():[f.scrollLeft+this.el.getX(),Ext.fly(i).getY()]},isRecordRendered:function(a){var b=this.ds.indexOf(a);if(b>=this.rowIndex&&b<this.rowIndex+this.visibleRows){return true}return false},isInRange:function(b){var a=Math.min(this.ds.totalLength-1,b+(this.visibleRows-1));return(b>=this.ds.bufferRange[0])&&(a<=this.ds.bufferRange[1])},getPredictedBufferIndex:function(a,c,b){if(!c){if(a+this.ds.bufferSize>=this.ds.totalLength){return this.ds.totalLength-this.ds.bufferSize}return Math.max(0,(a+this.visibleRows)-Math.round(this.ds.bufferSize/2))}if(!b){return Math.max(0,(a-this.ds.bufferSize)+this.visibleRows)}if(b){return Math.max(0,Math.min(a,this.ds.totalLength-this.ds.bufferSize))}},updateLiveRows:function(i,h,a){var f=this.isInRange(i);if(this.isBuffering){if(this.isPrebuffering){if(f){this.replaceLiveRows(i)}else{this.showLoadMask(true)}}this.fireEvent("cursormove",this,i,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength);this.requestQueue=i;return}var k=this.lastIndex;this.lastIndex=i;var f=this.isInRange(i);var g=false;if(f&&a!==true){this.replaceLiveRows(i,h);this.fireEvent("cursormove",this,i,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength);if(i>k){g=true;var e=this.ds.totalLength;if(i+this.visibleRows+this.nearLimit<=this.ds.bufferRange[1]){return}if(this.ds.bufferRange[1]+1>=e){return}}else{if(i<k){g=false;if(this.ds.bufferRange[0]<=0){return}if(i-this.nearLimit>this.ds.bufferRange[0]){return}}else{return}}this.isPrebuffering=true}this.isBuffering=true;var c=this.getPredictedBufferIndex(i,f,g);if(!f){this.showLoadMask(true)}this.ds.suspendEvents();var j=this.ds.sortInfo;var b={};if(this.ds.lastOptions){Ext.apply(b,this.ds.lastOptions.params)}b.start=c;b.limit=this.ds.bufferSize;if(j){b.dir=j.direction;b.sort=j.field}var d={forceRepaint:h,callback:this.liveBufferUpdate,scope:this,params:b};this.fireEvent("beforebuffer",this,this.ds,i,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength,d);this.ds.load(d);this.ds.resumeEvents()},showLoadMask:function(a){if(this.loadMask==null){if(a){this.loadMask=new Ext.LoadMask(this.mainBody.dom.parentNode.parentNode,this.loadMaskConfig)}else{return}}if(a){this.loadMask.show();this.liveScroller.setStyle("zIndex",this._maskIndex)}else{this.loadMask.hide();this.liveScroller.setStyle("zIndex",1)}},replaceLiveRows:function(f,g,b){var a=f-this.lastRowIndex;if(a==0&&g!==true){return}var d=a>0;a=Math.abs(a);var c=this.ds.bufferRange;var e=f-c[0];var i=Math.min(e+this.visibleRows-1,c[1]-c[0]);if(a>=this.visibleRows||a==0){this.mainBody.update(this.renderRows(e,i))}else{if(d){this.removeRows(0,a-1);if(e+this.visibleRows-a<=c[1]-c[0]){var h=this.renderRows(e+this.visibleRows-a,i);Ext.DomHelper.insertHtml("beforeEnd",this.mainBody.dom,h)}}else{this.removeRows(this.visibleRows-a,this.visibleRows-1);var h=this.renderRows(e,e+a-1);Ext.DomHelper.insertHtml("beforeBegin",this.mainBody.dom.firstChild,h)}}if(b!==false){this.processRows(0,undefined,true)}this.lastRowIndex=f},adjustBufferInset:function(){var h=this.liveScroller.dom;var f=this.grid,e=f.store;var b=f.getGridEl();var g=b.getSize().width;var d=(e.totalLength==this.visibleRows-this.rowClipped)?0:Math.max(0,e.totalLength-(this.visibleRows-this.rowClipped));if(d==0){this.scroller.setWidth(g);h.style.display="none";return}else{this.scroller.setWidth(g-this.scrollOffset);h.style.display=""}var c=this.cm.getTotalWidth()+this.scrollOffset>g;var a=h.parentNode.offsetHeight+((e.totalLength>0&&c)?-this.horizontalScrollOffset:0)-this.hdHeight;h.style.height=Math.max(a,this.horizontalScrollOffset*2)+"px";if(this.rowHeight==-1){return}this.liveScrollerInset.style.height=(d==0?0:a+(d*this.rowHeight))+"px"},adjustVisibleRows:function(){if(this.rowHeight==-1){if(this.getRows()[0]){this.rowHeight=this.getRows()[0].offsetHeight;if(this.rowHeight<=0){this.rowHeight=-1;return}}else{return}}var j=this.grid,b=j.store;var i=j.getGridEl();var g=this.cm;var e=i.getSize();var c=e.width;var a=e.height;var h=c-this.scrollOffset;if(g.getTotalWidth()>h){a-=this.horizontalScrollOffset}a-=this.mainHd.getHeight();var f=b.totalLength||0;var d=Math.max(1,Math.floor(a/this.rowHeight));this.rowClipped=0;if(f>d&&this.rowHeight/3<(a-(d*this.rowHeight))){d=Math.min(d+1,f);this.rowClipped=1}if(this.visibleRows==d){return}this.visibleRows=d;if(this.isBuffering){return}if(this.rowIndex+(d-this.rowClipped)>f){this.rowIndex=Math.max(0,f-(d-this.rowClipped));this.lastRowIndex=this.rowIndex}this.updateLiveRows(this.rowIndex,true)},adjustScrollerPos:function(b,a){if(b==0){return}var c=this.liveScroller;var d=c.dom;if(a===true){c.un("scroll",this.onLiveScroll,this)}this.lastScrollPos=d.scrollTop;d.scrollTop+=b;if(a===true){d.scrollTop=d.scrollTop;c.on("scroll",this.onLiveScroll,this,{buffer:this.scrollDelay})}}});Ext.namespace("Ext.ux.grid.livegrid");Ext.ux.grid.livegrid.JsonReader=function(a,b){Ext.ux.grid.livegrid.JsonReader.superclass.constructor.call(this,a,b)};Ext.extend(Ext.ux.grid.livegrid.JsonReader,Ext.data.JsonReader,{readRecords:function(b){var d=this.meta;if(!this.ef&&d.versionProperty){this.getVersion=this.getJsonAccessor(d.versionProperty)}if(!this.__readRecords){this.__readRecords=Ext.ux.grid.livegrid.JsonReader.superclass.readRecords}var c=this.__readRecords.call(this,b);if(d.versionProperty){var a=this.getVersion(b);c.version=(a===undefined||a==="")?null:a}return c}});Ext.namespace("Ext.ux.grid.livegrid");Ext.ux.grid.livegrid.RowSelectionModel=function(a){this.addEvents({selectiondirty:true});Ext.apply(this,a);this.pendingSelections={};Ext.ux.grid.livegrid.RowSelectionModel.superclass.constructor.call(this)};Ext.extend(Ext.ux.grid.livegrid.RowSelectionModel,Ext.grid.RowSelectionModel,{initEvents:function(){Ext.ux.grid.livegrid.RowSelectionModel.superclass.initEvents.call(this);this.grid.view.on("rowsinserted",this.onAdd,this);this.grid.store.on("selectionsload",this.onSelectionsLoad,this)},onRemove:function(h,f,c){var a=this.getPendingSelections();var g=a.length;var d=false;if(f==Number.MIN_VALUE||f==Number.MAX_VALUE){if(c){if(this.isIdSelected(c.id)&&f==Number.MIN_VALUE){this.shiftSelections(this.grid.store.bufferRange[1],-1)}this.selections.remove(c);d=true}if(f==Number.MIN_VALUE){this.clearPendingSelections(0,this.grid.store.bufferRange[0])}else{this.clearPendingSelections(this.grid.store.bufferRange[1])}if(g!=0){this.fireEvent("selectiondirty",this,f,1)}}else{d=this.isIdSelected(c.id);if(!d){return}this.selections.remove(c);if(g!=0){var b=a[0];var e=a[g-1];if(f<=e||f<=b){this.shiftSelections(f,-1);this.fireEvent("selectiondirty",this,f,1)}}}if(d){this.fireEvent("selectionchange",this)}},onAdd:function(g,i,a,c){var d=this.getPendingSelections();var f=d.length;if((i==Number.MIN_VALUE||i==Number.MAX_VALUE)){if(i==Number.MIN_VALUE){this.clearPendingSelections(0,this.grid.store.bufferRange[0]);this.shiftSelections(this.grid.store.bufferRange[1],c)}else{this.clearPendingSelections(this.grid.store.bufferRange[1])}if(f!=0){this.fireEvent("selectiondirty",this,i,r)}return}var h=d[0];var b=d[f-1];var e=i;if(e<=b||e<=h){this.fireEvent("selectiondirty",this,e,c);this.shiftSelections(e,c)}},shiftSelections:function(f,b){var j=0;var g=0;var c={};var a=this.grid.store;var i=f-a.bufferRange[0];var l=0;var e=this.grid.store.totalLength;var m=null;var d=this.getPendingSelections();var h=d.length;if(h==0){return}for(var k=0;k<h;k++){j=d[k];if(j<f){continue}g=j+b;l=i+b;if(g>=e){break}m=a.getAt(l);if(m){this.selections.add(m)}else{c[g]=true}}this.pendingSelections=c},onSelectionsLoad:function(b,c,a){this.replaceSelections(c)},hasNext:function(){return this.last!==false&&(this.last+1)<this.grid.store.getTotalCount()},getCount:function(){return this.selections.length+this.getPendingSelections().length},isSelected:function(a){if(typeof a=="number"){var d=a;a=this.grid.store.getAt(d);if(!a){var b=this.getPendingSelections().indexOf(d);if(b!=-1){return true}return false}}var c=a;return(c&&this.selections.key(c.id)?true:false)},deselectRecord:function(a,d){if(this.locked){return}var b=this.selections.key(a.id);if(!b){return}var e=this.grid.store;var c=e.indexOfId(a.id);if(c==-1){c=e.findInsertIndex(a);if(c!=Number.MIN_VALUE&&c!=Number.MAX_VALUE){c+=e.bufferRange[0]}}else{delete this.pendingSelections[c]}if(this.last==c){this.last=false}if(this.lastActive==c){this.lastActive=false}this.selections.remove(a);if(!d){this.grid.getView().onRowDeselect(c)}this.fireEvent("rowdeselect",this,c,a);this.fireEvent("selectionchange",this)},deselectRow:function(c,a){if(this.locked){return}if(this.last==c){this.last=false}if(this.lastActive==c){this.lastActive=false}var b=this.grid.store.getAt(c);delete this.pendingSelections[c];if(b){this.selections.remove(b)}if(!a){this.grid.getView().onRowDeselect(c)}this.fireEvent("rowdeselect",this,c,b);this.fireEvent("selectionchange",this)},selectRow:function(d,b,a){if(this.locked||d<0||d>=this.grid.store.getTotalCount()){return}var c=this.grid.store.getAt(d);if(this.fireEvent("beforerowselect",this,d,b,c)!==false){if(!b||this.singleSelect){this.clearSelections()}if(c){this.selections.add(c);delete this.pendingSelections[d]}else{this.pendingSelections[d]=true}this.last=this.lastActive=d;if(!a){this.grid.getView().onRowSelect(d)}this.fireEvent("rowselect",this,d,c);this.fireEvent("selectionchange",this)}},clearPendingSelections:function(b,c){if(c==undefined){c=Number.MAX_VALUE}var g={};var a=this.getPendingSelections();var e=a.length;var f=0;for(var d=0;d<e;d++){f=a[d];if(f<=c&&f>=b){continue}g[f]=true}this.pendingSelections=g},replaceSelections:function(j){if(!j||j.length==0){return}var a=this.grid.store;var i=null;var f=[];var d=this.getPendingSelections();var e=d.length;var b=this.selections;var g=0;for(var h=0;h<e;h++){g=d[h];i=a.getAt(g);if(i){b.add(i);f.push(i.id);delete this.pendingSelections[g]}}var c=null;for(h=0,len=j.length;h<len;h++){i=j[h];c=i.id;if(f.indexOf(c)==-1&&b.containsKey(c)){b.add(i)}}},getPendingSelections:function(c){var e=1;var f=[];var g=0;var b=[];for(var d in this.pendingSelections){b.push(parseInt(d))}b.sort(function(h,i){if(h>i){return 1}else{if(h<i){return -1}else{return 0}}});if(!c){return b}var a=b.length;if(a==0){return[]}f[g]=[b[0],b[0]];for(var d=0,a=a-1;d<a;d++){if(b[d+1]-b[d]==1){f[g][1]=b[d+1]}else{g++;f[g]=[b[d+1],b[d+1]]}}return f},clearSelections:function(a){if(this.locked){return}if(a!==true){var b=this.grid.store;var d=this.selections;var c=-1;d.each(function(e){c=b.indexOfId(e.id);if(c!=-1){this.deselectRow(c+b.bufferRange[0])}},this);d.clear();this.pendingSelections={}}else{this.selections.clear();this.pendingSelections={}}this.last=false},selectRange:function(d,a,b){if(this.locked){return}if(!b){this.clearSelections()}if(d<=a){for(var c=d;c<=a;c++){this.selectRow(c,true)}}else{for(var c=d;c>=a;c--){this.selectRow(c,true)}}}});Ext.namespace("Ext.ux.grid.livegrid");Ext.ux.grid.livegrid.Store=function(a){a=a||{};a.remoteSort=true;this._autoLoad=a.autoLoad?true:false;a.autoLoad=false;this.addEvents("bulkremove","versionchange","beforeselectionsload","selectionsload");Ext.ux.grid.livegrid.Store.superclass.constructor.call(this,a);this.totalLength=0;this.bufferRange=[-1,-1];this.on("clear",function(){this.bufferRange=[-1,-1]},this);if(this.url&&!this.selectionsProxy){this.selectionsProxy=new Ext.data.HttpProxy({url:this.url})}};Ext.extend(Ext.ux.grid.livegrid.Store,Ext.data.Store,{version:null,insert:function(e,f){f=[].concat(f);e=e>=this.bufferSize?Number.MAX_VALUE:e;if(e==Number.MIN_VALUE||e==Number.MAX_VALUE){var g=f.length;if(e==Number.MIN_VALUE){this.bufferRange[0]+=g;this.bufferRange[1]+=g}this.totalLength+=g;this.fireEvent("add",this,f,e);return}var c=false;var b=f;if(f.length+e>=this.bufferSize){c=true;b=f.splice(0,this.bufferSize-e)}this.totalLength+=b.length;if(this.bufferRange[0]<=-1){this.bufferRange[0]=0}if(this.bufferRange[1]<(this.bufferSize-1)){this.bufferRange[1]=Math.min(this.bufferRange[1]+b.length,this.bufferSize-1)}for(var d=0,a=b.length;d<a;d++){this.data.insert(e,b[d]);b[d].join(this)}while(this.getCount()>this.bufferSize){this.data.remove(this.data.last())}this.fireEvent("add",this,b,e);if(c==true){this.fireEvent("add",this,f,Number.MAX_VALUE)}},remove:function(c,a){var b=this._getIndex(c);if(b<0){this.totalLength-=1;if(this.pruneModifiedRecords){this.modified.remove(c)}this.bufferRange[0]=Math.max(-1,this.bufferRange[0]-1);this.bufferRange[1]=Math.max(-1,this.bufferRange[1]-1);if(a!==true){this.fireEvent("remove",this,c,b)}return b}this.bufferRange[1]=Math.max(-1,this.bufferRange[1]-1);this.data.removeAt(b);if(this.pruneModifiedRecords){this.modified.remove(c)}this.totalLength-=1;if(a!==true){this.fireEvent("remove",this,c,b)}return b},_getIndex:function(a){var b=this.indexOfId(a.id);if(b<0){b=this.findInsertIndex(a)}return b},bulkRemove:function(g){var b=null;var d=[];var e=0;var a=g.length;var c=[];for(var f=0;f<a;f++){b=g[f];c[b.id]=this._getIndex(b)}for(var f=0;f<a;f++){b=g[f];this.remove(b,true);d.push([b,c[b.id]])}this.fireEvent("bulkremove",this,d)},removeAll:function(){this.totalLength=0;this.bufferRange=[-1,-1];this.data.clear();if(this.pruneModifiedRecords){this.modified=[]}this.fireEvent("clear",this)},loadRanges:function(f){var a=f.length;if(a>0&&!this.selectionsProxy.activeRequest&&this.fireEvent("beforeselectionsload",this,f)!==false){var c=this.lastOptions.params;var b={};b.ranges=Ext.encode(f);if(c){if(c.sort){b.sort=c.sort}if(c.dir){b.dir=c.dir}}var e={};for(var d in this.lastOptions){e.i=this.lastOptions.i}e.ranges=b.ranges;this.selectionsProxy.load(b,this.reader,this.selectionsLoaded,this,e)}},loadSelections:function(a){if(a.length==0){return}this.loadRanges(a)},selectionsLoaded:function(b,f,c){if(this.checkVersionChange(b,f,c)!==false){var d=b.records;for(var e=0,a=d.length;e<a;e++){d[e].join(this)}this.fireEvent("selectionsload",this,b.records,Ext.decode(f.ranges))}else{this.fireEvent("selectionsload",this,[],Ext.decode(f.ranges))}},checkVersionChange:function(b,d,c){if(b&&c!==false){if(b.version!==undefined){var a=this.version;this.version=b.version;if(this.version!==a){return this.fireEvent("versionchange",this,a,this.version)}}}},findInsertIndex:function(a){this.remoteSort=false;var b=Ext.ux.grid.livegrid.Store.superclass.findInsertIndex.call(this,a);this.remoteSort=true;if(this.bufferRange[0]<=0&&b==0){return b}else{if(this.bufferRange[0]>0&&b==0){return Number.MIN_VALUE}else{if(b>=this.bufferSize){return Number.MAX_VALUE}}}return b},sortData:function(c,b){b=b||"ASC";var a=this.fields.get(c).sortType;var d=function(g,h){var e=a(g.data[c]),f=a(h.data[c]);return e>f?1:(e<f?-1:0)};this.data.sort(b,d)},onMetaChange:function(c,a,b){this.version=null;Ext.ux.grid.livegrid.Store.superclass.onMetaChange.call(this,c,a,b)},loadRecords:function(b,a,c){this.checkVersionChange(b,a,c);if(!b){this.bufferRange=[-1,-1]}else{this.bufferRange=[a.params.start,Math.max(0,Math.min((a.params.start+a.params.limit)-1,b.totalRecords-1))]}Ext.ux.grid.livegrid.Store.superclass.loadRecords.call(this,b,a,c)},getAt:function(a){if(this.bufferRange[0]==-1){return undefined}var b=a-this.bufferRange[0];return this.data.itemAt(b)},clearFilter:function(){},isFiltered:function(){},collect:function(){},createFilterFn:function(){},sum:function(){},filter:function(){},filterBy:function(){},query:function(){},queryBy:function(){},find:function(){},findBy:function(){}});Ext.namespace("Ext.ux.grid.livegrid");Ext.ux.grid.livegrid.Toolbar=Ext.extend(Ext.Toolbar,{displayMsg:"Displaying {0} - {1} of {2}",emptyMsg:"No data to display",refreshText:"Refresh",initComponent:function(){Ext.ux.grid.livegrid.Toolbar.superclass.initComponent.call(this);if(this.grid){this.view=this.grid.getView()}var a=this;this.view.init=this.view.init.createSequence(function(){a.bind(this)},this.view)},updateInfo:function(b,c,a){if(this.displayEl){var d=a==0?this.emptyMsg:String.format(this.displayMsg,b+1,b+c,a);this.displayEl.update(d)}},unbind:function(a){var c;var b;if(a instanceof Ext.grid.GridView){b=a}else{b=a.getView()}c=a.ds;c.un("loadexception",this.enableLoading,this);c.un("beforeload",this.disableLoading,this);c.un("load",this.enableLoading,this);b.un("rowremoved",this.onRowRemoved,this);b.un("rowsinserted",this.onRowsInserted,this);b.un("beforebuffer",this.beforeBuffer,this);b.un("cursormove",this.onCursorMove,this);b.un("buffer",this.onBuffer,this);b.un("bufferfailure",this.enableLoading,this);this.view=undefined},bind:function(a){this.view=a;var b=a.ds;b.on("loadexception",this.enableLoading,this);b.on("beforeload",this.disableLoading,this);b.on("load",this.enableLoading,this);a.on("rowremoved",this.onRowRemoved,this);a.on("rowsinserted",this.onRowsInserted,this);a.on("beforebuffer",this.beforeBuffer,this);a.on("cursormove",this.onCursorMove,this);a.on("buffer",this.onBuffer,this);a.on("bufferfailure",this.enableLoading,this)},enableLoading:function(){this.loading.setDisabled(false)},disableLoading:function(){this.loading.setDisabled(true)},onCursorMove:function(d,b,c,a){this.updateInfo(b,c,a)},onRowsInserted:function(c,b,a){this.updateInfo(c.rowIndex,Math.min(c.ds.totalLength,c.visibleRows-c.rowClipped),c.ds.totalLength)},onRowRemoved:function(c,b,a){this.updateInfo(c.rowIndex,Math.min(c.ds.totalLength,c.visibleRows-c.rowClipped),c.ds.totalLength)},beforeBuffer:function(f,e,b,c,a,d){this.loading.disable();this.updateInfo(b,c,a)},onBuffer:function(e,d,b,c,a){this.loading.enable();this.updateInfo(b,c,a)},onClick:function(a){switch(a){case"refresh":if(this.view.reset(true)){this.loading.disable()}else{this.loading.enable()}break}},onRender:function(b,a){Ext.PagingToolbar.superclass.onRender.call(this,b,a);this.loading=this.addButton({tooltip:this.refreshText,iconCls:"x-tbar-loading",handler:this.onClick.createDelegate(this,["refresh"])});this.addSeparator();if(this.displayInfo){this.displayEl=Ext.fly(this.el.dom).createChild({cls:"x-paging-info"})}}});Ext.namespace("Ext.ux.grid.livegrid");Ext.ux.grid.livegrid.DragZone=function(b,a){Ext.ux.grid.livegrid.DragZone.superclass.constructor.call(this,b,a);this.view.ds.on("beforeselectionsload",this._onBeforeSelectionsLoad,this);this.view.ds.on("selectionsload",this._onSelectionsLoad,this)};Ext.extend(Ext.ux.grid.livegrid.DragZone,Ext.grid.GridDragZone,{isDropValid:true,onInitDrag:function(a){this.view.ds.loadSelections(this.grid.selModel.getPendingSelections(true));Ext.ux.grid.livegrid.DragZone.superclass.onInitDrag.call(this,a)},_onBeforeSelectionsLoad:function(){this.isDropValid=false;Ext.fly(this.proxy.el.dom.firstChild).addClass("ext-ux-livegrid-drop-waiting")},_onSelectionsLoad:function(){this.isDropValid=true;this.ddel.innerHTML=this.grid.getDragDropText();Ext.fly(this.proxy.el.dom.firstChild).removeClass("ext-ux-livegrid-drop-waiting")}});Ext.namespace("Ext.ux.grid.livegrid");Ext.ux.grid.livegrid.EditorGridPanel=Ext.extend(Ext.grid.EditorGridPanel,{initEvents:function(){Ext.ux.grid.livegrid.EditorGridPanel.superclass.initEvents.call(this);this.view.on("cursormove",this.stopEditing,this,[true])},startEditing:function(b,a){this.stopEditing();if(this.colModel.isCellEditable(a,b)){this.view.ensureVisible(b,a,true);if(!this.store.getAt(b)){return}}return Ext.ux.grid.livegrid.EditorGridPanel.superclass.startEditing.call(this,b,a)},walkCells:function(b,a,c,d,e){return Ext.ux.grid.livegrid.GridPanel.prototype.walkCells.call(this,b,a,c,d,e)},onRender:function(b,a){return Ext.ux.grid.livegrid.GridPanel.prototype.onRender.call(this,b,a)}});Ext.menu.Menu.prototype.load=function(b){var a=new Ext.menu.Item({text:"Loading..."});var c=new Ext.data.Connection();this.addItem(a);c.on("requestcomplete",function(e,d){this.remove(a);d=Ext.decode(d.responseText);Ext.each(d.menu,function(f){this.add(f)},this)},this);c.on("requestexception",function(){this.remove(a);this.add({text:"Failed to load menu items"})},this);c.request(b)};Ext.grid.PropertyStore.prototype.setSource=function(d){this.source=d;this.store.removeAll();var c=[];for(var a in d){var b=false;if(this.grid.onlyFields&&this.grid.onlyFields.length>0){b=true;if(this.grid.onlyFields.indexOf(a)>-1){b=false}}if(this.grid.avoidFields&&this.grid.avoidFields.length>0){if(this.grid.avoidFields.indexOf(a)>-1){b=true}}if(!b&&this.isEditableValue(d[a])){c.push(new Ext.grid.PropertyRecord({name:a,value:d[a]},a))}}this.store.loadRecords({records:c},{},true)};Ext.grid.PropertyColumnModel.prototype.renderCell=function(e,d,a,g,b,c){var f=e;if(this.grid.customRenderers&&this.grid.customRenderers[a.get("name")]){f=this.grid.customRenderers[a.get("name")](this.grid.customEditors[a.get("name")],e,d,a,g,b,c)}else{if(e instanceof Date){f=this.renderDate(e)}else{if(typeof e=="boolean"){f=this.renderBool(e)}}}return Ext.util.Format.htmlEncode(f)};Ext.BLANK_IMAGE_URL="js/ext/resources/images/default/s.gif";Ext.namespace("npc");npc=function(){var a;var c;var e=[{id:"gear",handler:function(f,g,h){d(h)}},{id:"close",handler:function(h,g,f){f.hide()}}];function d(l){var i=Ext.state.Manager.get(l.id);var k=i.height;var f=125;var g={name:"rows",xtype:"hidden"};if(k){f=150;g={fieldLabel:"Display Height",name:"height",value:k,labelStyle:"cursor: help;",tooltipText:"The height of the portlet.",allowBlank:false,xtype:"textfield",listeners:{render:function(m){npc.setFormFieldTooltip(m)}}}}var h=new Ext.FormPanel({labelWidth:75,frame:true,bodyStyle:"padding:5px 5px 0",width:200,defaults:{width:50},defaultType:"textfield",items:[g],buttons:[{text:"Save",handler:function(p){var n=parseInt(h.form.getValues().refresh);var m=l.items.items[0];if(k){i.height=parseInt(h.form.getValues().height);m.setHeight(i.height);l.setHeight(i.height)}Ext.state.Manager.set(l.id,i);p.ownerCt.ownerCt.close()}},{text:"Cancel",handler:function(m){m.ownerCt.ownerCt.close()}}]});var j=new Ext.Window({title:"Portlet Configuration",layout:"fit",modal:true,closable:true,height:f,width:250,items:h}).show()}Ext.override(Ext.data.Store,{startAutoRefresh:function(g,h,i,f){if(f){this.reload({callback:i})}if(this.autoRefreshProcId){clearInterval(this.autoRefreshProcId)}this.autoRefreshProcId=setInterval(this.reload.createDelegate(this,[{callback:i}]),g*1000)},stopAutoRefresh:function(){if(this.autoRefreshProcId){clearInterval(this.autoRefreshProcId)}}});Ext.ux.IFrameComponent=Ext.extend(Ext.BoxComponent,{onRender:function(g,f){this.el=g.createChild({tag:"iframe",id:"iframe-"+this.id,frameBorder:0,src:this.url})}});function b(f,g){return['<div class="msg">','<div class="x-box-tl"><div class="x-box-tr"><div class="x-box-tc"></div></div></div>','<div class="x-box-ml"><div class="x-box-mr"><div class="x-box-mc"><h3>',f,"</h3>",g,"</div></div></div>",'<div class="x-box-bl"><div class="x-box-br"><div class="x-box-bc"></div></div></div>',"</div>"].join("")}return{params:new Array(),portlet:{},serviceGridClick:function(f,h,g){npc.serviceDetail(f.getStore().getAt(h))},hostGridClick:function(f,h,g){npc.hostDetail(f.getStore().getAt(h))},hostContextMenu:function(f,j,g){g.stopEvent();var i=new Ext.menu.Menu();i=npc.hostCommandMenu(f.getStore().getAt(j).data,i);var h=new Ext.menu.Menu({items:[{text:"Commands",iconCls:"cogAdd",menu:i},{text:"Host Detail",iconCls:"appViewDetail",handler:function(){npc.hostGridClick(f,j,g)}}]});h.showAt(g.getXY())},hostgroupContextMenu:function(f,j,g){g.stopEvent();var i=new Ext.menu.Menu();i=npc.hostgroupCommandMenu(f.getStore().getAt(j).data,i);var h=new Ext.menu.Menu({items:[{text:"Commands",iconCls:"cogAdd",menu:i}]});h.showAt(g.getXY())},serviceContextMenu:function(f,j,g){g.stopEvent();var i=new Ext.menu.Menu();i=npc.serviceCommandMenu(f.getStore().getAt(j).data,i);var h=new Ext.menu.Menu({items:[{text:"Commands",iconCls:"cogAdd",menu:i},{text:"Service Detail",iconCls:"appViewDetail",handler:function(){npc.serviceGridClick(f,j,g)}}]});h.showAt(g.getXY())},setRefreshCombo:function(f,g,h){return([" "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","-","Refresh",new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["name","value"],data:[["10",10],["30",30],["60",60],["120",120],["180",180],["240",240],["300",300]]}),name:"refresh",value:(h&&h.refresh)?h.refresh:60,displayField:"name",valueField:"value",forceSelection:true,listeners:{select:function(i){if(!h){h=Ext.state.Manager.get(f);h=h?h:{}}h.refresh=i.getValue();Ext.state.Manager.set(f,h);g.stopAutoRefresh();g.startAutoRefresh(h.refresh)}},mode:"local",editable:false,width:50,allowBlank:false,triggerAction:"all",selectOnFocus:true})])},doCommand:function(g,f){Ext.Msg.show({title:"Confirm",msg:g,buttons:Ext.Msg.YESNO,fn:function(h){if(h=="yes"){npc.aPost(f)}},animEl:"elId",icon:Ext.MessageBox.QUESTION})},cmdFormButtons:[{text:"Submit",handler:function(f){f.ownerCt.getForm().submit({success:function(h,g){f.ownerCt.ownerCt.close()},failure:function(h,g){f.ownerCt.ownerCt.close();response=Ext.decode(g.response.responseText);Ext.Msg.alert("Failed",response.msg)}})}},{text:"Cancel",handler:function(f){f.ownerCt.ownerCt.close()}}],setFormFieldTooltip:function(g){var f=Ext.get("x-form-el-"+g.id).prev("label");Ext.QuickTips.register({target:f,text:g.tooltipText,title:""})},aPost:function(f){Ext.Ajax.request({url:"npc.php",params:f,callback:function(i,g,h){var i=Ext.util.JSON.decode(h.responseText);if(!i.success){Ext.Msg.alert("Error",i.msg)}}})},renderStatusBg:function(g,f){if(g>0){if(f.id.match("UP")){bg="33FF00"}else{if(f.id.match("DOWN")){bg="F83838"}else{if(f.id.match("UNREACHABLE")){bg="F83838"}else{if(f.id.match("PENDING")){bg="0099FF"}else{if(f.id.match("OK")){bg="33FF00"}else{if(f.id.match("CRITICAL")){bg="F83838"}else{if(f.id.match("WARNING")){bg="FFFF00"}else{if(f.id.match("UNKNOWN")){bg="FF9900"}}}}}}}}f.attr='style="background-color: #'+bg+';"';return String.format("<b>{0}</b>",g)}return("0")},renderEventIcon:function(f){if(f.match(/SERVICE ALERT:/)&&f.match(/WARNING/)){return String.format('<img src="images/icons/error.png">')}else{if(f.match(/SERVICE ALERT:/)&&f.match(/OK/)){return String.format('<img src="images/icons/accept.png">')}else{if(f.match(/SERVICE ALERT:/)&&f.match(/CRITICAL/)){return String.format('<img src="images/icons/exclamation.png">')}else{if(f.match(/LOG ROTATION:/)){return String.format('<img src="images/icons/arrow_rotate_clockwise.png">')}else{if(f.match(/ NOTIFICATION:/)){return String.format('<img src="images/icons/transmit.png">')}else{if(f.match(/HOST ALERT:/)&&(f.match(/;RECOVERY;/)||f.match(/;UP;/))){return String.format('<img src="images/icons/accept.png">')}else{if(f.match(/Finished daemonizing.../)){return String.format('<img src="images/icons/arrow_up.png">')}else{if(f.match(/ shutting down.../)){return String.format('<img src="images/icons/cancel.png">')}else{if(f.match(/Successfully shutdown/)){return String.format('<img src="images/icons/stop.png">')}else{if(f.match(/ restarting.../)){return String.format('<img src="images/icons/arrow_refresh.png">')}else{if(f.match(/EXTERNAL COMMAND/)){return String.format('<img src="images/icons/resultset_next.png">')}}}}}}}}}}}return String.format('<img src="images/icons/information.png">')},hostStatusImage:function(h){var f;var g;if(h==0){f="greendot.gif";g="UP"}else{if(h==1){f="reddot.gif";g="DOWN"}else{if(h==2){f="reddot.gif";g="UNREACHABLE"}else{if(h==-1){f="bluedot.gif";g="PENDING"}}}}return String.format('<p align="center"><img ext:qtip="{0}" src="images/icons/{1}"></p>',g,f)},serviceStatusImage:function(h){var f;var g;if(h==0){f="greendot.gif";g="OK"}else{if(h==1){f="yellowdot.gif";g="WARNING"}else{if(h==2){f="reddot.gif";g="CRITICAL"}else{if(h==3){f="orangedot.gif";g="UNKNOWN"}else{if(h==-1){f="bluedot.gif";g="PENDING"}}}}}return String.format('<p align="center"><img ext:qtip="{0}" src="images/icons/{1}"></p>',g,f)},renderHostIcons:function(i,h,g){var j=(npc.params.npc_host_icons=="on")?true:false;var f="";if(g.data.host_icon_image&&j){f=String.format('<img ext:qtip="{0}" src="{1}">',g.data.host_icon_image_alt,g.data.host_icon_image);return String.format('<div style="float: left;">{0} {1}</div>',f,i)}else{if(g.data.service_object_id){return(i)}else{if(g.data.icon_image&&j){f=String.format('<img ext:qtip="{0}" src="{1}">',g.data.icon_image_alt,g.data.icon_image)}}}return npc.renderExtraIcons(i,h,g,f)},renderServiceIcons:function(i,h,g){var j=(npc.params.npc_service_icons=="on")?true:false;var f="";if(g.data.svc_icon_image==""||!j){return npc.renderExtraIcons(i,h,g,f)}else{if(g.data.svc_icon_image){f=String.format('<img ext:qtip="{0}" src="{1}">',g.data.svc_icon_image_alt,g.data.svc_icon_image);return String.format('<div style="float: left;">{0} {1}</div>',f,i)}else{if(g.data.icon_image){f=String.format('<img ext:qtip="{0}" src="{1}">',g.data.icon_image_alt,g.data.icon_image)}}}return npc.renderExtraIcons(i,h,g,f)},renderExtraIcons:function(k,j,f,h){var g="";if(f.data.problem_has_been_acknowledged==1){var l=f.data.acknowledgement.split("*|*");var i="";if(l[0]){i="by "+l[0]}g=String.format('&nbsp;<img ext:qtip="This problem has been acknowledged {0}" src="images/icons/wrench.png">',i)}if(f.data.in_downtime==1){g=String.format('&nbsp;<img ext:qtip="This service is currently in a period of scheduled downtime." src="images/icons/cog.png">')+g}if(f.data.notifications_enabled==0){g=String.format('&nbsp;<img ext:qtip="Notifications have been disabled." src="images/icons/sound_mute.png">')+g}if(f.data.comment){g=String.format('&nbsp;<img ext:qtip="There are comments for this item" src="images/icons/comment.png">')+g}if(f.data.is_flapping){g=String.format('&nbsp;<img ext:qtip="Flapping between states" src="images/icons/text_align_justify.png">')+g}if(f.data.active_checks_enabled==0&&f.data.passive_checks_enabled==0){g=String.format('&nbsp;<img ext:qtip="Active and passive checks have been disabled" src="images/icons/cross.png">')+g}else{if(f.data.active_checks_enabled==0){g=String.format('&nbsp;<img qtitle="Active checks disabled" ext:qtip="Passive checks are being accepted" src="images/nagios/passiveonly.gif">')+g}}return String.format('<div><div style="float: left;">{0} {1}</div><div style="float: right;">{2}</div></div>',h,k,g)},renderCommentType:function(g){var f;switch(g){case"1":f="User";break;case"2":f="Scheduled Downtime";break;case"3":f="Flap Detection";break;case"4":f="Acknowledgement";break}return String.format("{0}",f)},renderPersistent:function(g){var f;switch(g){case"0":f="No";break;case"1":f="Yes";break}return String.format("{0}",f)},renderCommentExpires:function(h,g,f){if(f.data.is_persistent==1){return String.format("NA")}if(typeof h=="object"){if(h.getYear()=="69"){return String.format("NA")}else{return String.format(h.dateFormat(npc.params.npc_date_format+" "+npc.params.npc_time_format))}}return h},renderGraph:function(h,g,f){return String.format('<img src="'+npc.params.cacti_path+'/graph_image.php?action=view&local_graph_id={0}&rra_id=1&graph_height=120&graph_width=500">',f.data.local_graph_id)},mapGraph:function(f,i){var g=new Ext.grid.GridPanel({id:"graphGrid",autoHeight:true,autoWidth:true,store:new Ext.data.JsonStore({url:"npc.php?module="+f+"&action=getMappedGraph&p_id="+i,totalProperty:"totalCount",root:"data",fields:["local_graph_id"],autoload:true}),cm:new Ext.grid.ColumnModel([{header:"",menuDisabled:true,dataIndex:"graph",renderer:npc.renderGraph,width:600}]),autoExpandColumn:"Value",stripeRows:true,tbar:[new Ext.form.ComboBox({store:new Ext.data.JsonStore({url:"npc.php?module=cacti&action=getGraphList",totalProperty:"totalCount",root:"data",fields:["local_graph_id","height","width","title"],autoload:true}),fieldLabel:"Graph",displayField:"title",valueField:"local_graph_id",typeAhead:false,forceSelection:true,editable:false,mode:"remote",listeners:{select:function(l,p,m){var j=l.store.getAt(m).data.local_graph_id;var k={module:f,action:"setMappedGraph",p_object_id:i,p_local_graph_id:j};npc.aPost(k);g.store.reload()}},triggerAction:"all",emptyText:"Select a graph...",selectOnFocus:true,listWidth:400,width:400})],view:new Ext.grid.GridView({forceFit:true,autoFill:true,scrollOffset:0})});var h=new Ext.Window({title:"Map Graph",layout:"fit",modal:true,closable:true,width:640,items:g});h.show();g.render();g.store.load()},getDuration:function(g){var i=new Date();var o=i.dateFormat("U")-g.dateFormat("U");var f=86400;var j=3600;var m=60;var n=Math.floor(o/f);var k=Math.floor((o%f)/j);var h=Math.floor(((o%f)%j)/m);var l=Math.floor((((o%f)%j)%m));return String.format("{0}d {1}h {2}m {3}s",n,k,h,l)},formatDate:function(f){if(typeof f=="object"){if(f.getYear()=="69"){return String.format("NA")}else{return String.format(f.dateFormat(npc.params.npc_date_format+" "+npc.params.npc_time_format))}}return f},toggleRegion:function(h,g){var f=Ext.getCmp(h);if(f.isVisible()){f.collapse()}else{f.expand()}},msg:function(i,h){if(!c){c=Ext.DomHelper.insertFirst(document.body,{id:"msg-div"},true)}c.alignTo(document,"t-t");var g=String.format.apply(String,Array.prototype.slice.call(arguments,1));var f=Ext.DomHelper.append(c,{html:b(i,g)},true);f.slideIn("t").pause(5).ghost("t",{remove:true})},addTabExt:function(j,i,f){var h=Ext.getCmp("centerTabPanel");var g=(Ext.getCmp(j));if(!g){h.add({title:i,id:j,layout:"fit",closable:true,scripts:true,items:[new Ext.ux.IFrameComponent({url:f})]}).show();h.doLayout()}h.setActiveTab(g)},addCenterNestedTab:function(i,h){var g=Ext.getCmp("centerTabPanel");var f=Ext.getCmp(i);if(f){g.setActiveTab(f);g.doLayout()}else{g.add({id:i,title:h,closable:true,deferredRender:false,layoutOnTabChange:true,autoScroll:true,layout:"fit",containerScroll:true,listeners:{activate:function(j){j.doLayout()}},items:[new Ext.TabPanel({id:i+"-inner-panel",style:"padding:5px 0 5px 5px",deferredRender:false,layoutOnTabChange:true,height:600,autoWidth:true,plain:true,defaults:{autoScroll:true}})]}).show();g.doLayout();g.setActiveTab(i)}},initPortlets:function(){var j=this.portlet;var g=[];var k=0;var f=0;for(x in j){if(!Ext.state.Manager.get(x).dt){g[f]=[x,0]}else{g[f]=[x,Ext.state.Manager.get(x).dt]}f++}g.sort(function(l,i){return i[1]-l[1]});for(var h=0;h<g.length;h++){for(x in g){if(typeof g[x][0]=="string"){if(Ext.state.Manager.get(g[x][0]).index==h){j[g[x][0]]()}}}}},addPortlet:function(h,g,f){if(!Ext.getCmp(h)){panel=new Ext.ux.Portlet({id:h,title:g,index:0,layout:"fit",stateEvents:["hide","show","collapse","expand"],stateful:true,getState:function(){var o=new Date();var q=0;var n;var k;var m=Ext.state.Manager.get(h).refresh;var p=Ext.state.Manager.get(h).rows;if(this.ownerCt){n=this.ownerCt.id;var j=this.ownerCt.items.keys;for(var l in j){if(j[l]==h){k=l;break}}}if(!n){n=Ext.state.Manager.get(h).column}if(!k){k=Ext.state.Manager.get(h).index}if(k<this.index){q=o.format("U")}else{if(k>this.index){q=-1}}this.index=k;return{collapsed:this.collapsed,hidden:this.hidden,column:n,index:k,dt:q,refresh:m,rows:p}},tools:e});Ext.getCmp(panel.column).items.add(panel);Ext.getCmp("centerTabPanel").doLayout()}},init:function(){var f=new Ext.Viewport({layout:"border",items:[{region:"north",id:"north-panel",border:false,layout:"column",collapseMode:"mini",height:76,margins:"0 0 0 0",defaults:{layout:"fit",bodyStyle:"padding: 0px 0px 0px 20px;",border:false,columnWidth:0.33},items:[{id:"nagiosStatusCol"},{id:"hostStatusCol"},{id:"serviceStatusCol"}]},{region:"west",id:"west-panel",split:true,title:"Navigation",collapsible:true,width:210,minSize:100,maxSize:400,margins:"0 0 0 0",items:[new Ext.tree.TreePanel({id:"nav-tree",loader:new Ext.tree.TreeLoader(),rootVisible:false,border:false,lines:true,autoScroll:false,root:new Ext.tree.AsyncTreeNode({text:"root",children:[{text:"Monitoring",iconCls:"tnode",expanded:true,children:[{text:"Hosts",iconCls:"tnode",expanded:true,children:[{text:"Hosts",iconCls:"tleaf",leaf:true,listeners:{click:function(){npc.hosts("Hosts","any")}}},{text:"Host Problems",iconCls:"tleaf",leaf:true,listeners:{click:function(){npc.hosts("Host Problems","not_ok")}}},{text:"Hostgroup Overview",iconCls:"tleaf",leaf:true,listeners:{click:function(){npc.hostgroupOverview()}}},{text:"Hostgroup Grid",iconCls:"tleaf",leaf:true,listeners:{click:function(){npc.hostgroupGrid()}}}]},{text:"Services",iconCls:"tnode",expanded:true,children:[{text:"Services",iconCls:"tleaf",leaf:true,listeners:{click:function(){npc.services("Services","any")}}},{text:"Service Problems",iconCls:"tleaf",leaf:true,listeners:{click:function(){npc.services("Service Problems","not_ok")}}},{text:"Servicegroup Overview",iconCls:"tleaf",leaf:true,listeners:{click:function(){npc.servicegroupOverview()}}},{text:"Servicegroup Grid",iconCls:"tleaf",leaf:true,listeners:{click:function(){npc.servicegroupGrid()}}}]},{text:"Status Map",iconCls:"tleaf",leaf:true,listeners:{click:function(){npc.addTabExt("StatusMap","Status Map",npc.params.npc_nagios_url+"/cgi-bin/statusmap.cgi?host=all")}}},{text:"Comments",iconCls:"tleaf",leaf:true,listeners:{click:function(){npc.comments()}}},{text:"Scheduled Downtime",iconCls:"tleaf",leaf:true,listeners:{click:function(){npc.downtime()}}},{text:"Process Information",iconCls:"tleaf",leaf:true,listeners:{click:function(){npc.processInfo()}}},{text:"Event Log",iconCls:"tleaf",leaf:true,listeners:{click:function(){npc.eventLog()}}}]},{text:"Reporting",iconCls:"tnode",expanded:false,children:[{text:"Trends",iconCls:"tleaf",leaf:true,listeners:{click:function(){npc.reporting("Trends",npc.params.npc_nagios_url+"/cgi-bin/trends.cgi")}}},{text:"Availability",iconCls:"tleaf",leaf:true,listeners:{click:function(){npc.reporting("Availability",npc.params.npc_nagios_url+"/cgi-bin/avail.cgi")}}},{text:"Alert Histogram",iconCls:"tleaf",leaf:true,listeners:{click:function(){npc.reporting("Alert Histogram",npc.params.npc_nagios_url+"/cgi-bin/histogram.cgi")}}},{text:"Alert History",iconCls:"tleaf",leaf:true,listeners:{click:function(){npc.reporting("Alert History",npc.params.npc_nagios_url+"/cgi-bin/history.cgi?host=all")}}},{text:"Alert Summary",iconCls:"tleaf",leaf:true,listeners:{click:function(){npc.reporting("Alert Summary",npc.params.npc_nagios_url+"/cgi-bin/summary.cgi")}}},{text:"Notifications",iconCls:"tleaf",leaf:true,listeners:{click:function(){npc.reporting("Notifications",npc.params.npc_nagios_url+"/cgi-bin/notifications.cgi?contact=all")}}}]},{text:"N2C",iconCls:"tleaf",leaf:true,listeners:{click:function(){npc.n2c()}}},{text:"Nagios",iconCls:"tleaf",leaf:true,listeners:{click:function(){npc.addTabExt("Nagios","Nagios",npc.params.npc_nagios_url)}}}]})})]},new Ext.TabPanel({region:"center",id:"centerTabPanel",enableTabScroll:true,autowidth:true,deferredRender:false,activeTab:0,items:[{id:"dashboard",title:"Dashboard",iconCls:"layout",autoScroll:true,xtype:"portal",margins:"35 5 5 0",tbar:[],items:[{id:"dashcol1",columnWidth:0.5,style:"padding:10px 0 10px 10px"},{id:"dashcol2",columnWidth:0.5,style:"padding:10px 0 10px 10px"}]}]})]});Ext.getCmp("dashboard").getTopToolbar().add("->","-",{text:"Portlets",iconCls:"layoutEdit",handler:function(){var u=Ext.getCmp("hostProblems");var n=u.isVisible();var v=Ext.getCmp("eventLog");var m=v.isVisible();var s=Ext.getCmp("serviceProblems");var q=s.isVisible();var p=Ext.getCmp("monitoringPerf");var i=p.isVisible();var t=Ext.getCmp("servicegroupServiceStatus");var g=t.isVisible();var w=Ext.getCmp("servicegroupHostStatus");var y=w.isVisible();var z=Ext.getCmp("hostgroupServiceStatus");var l=z.isVisible();var k=Ext.getCmp("hostgroupHostStatus");var j=k.isVisible();var h=new Ext.form.FormPanel({bodyStyle:"padding:5px 5px 0",layout:"form",border:false,frame:false,items:[{xtype:"fieldset",title:"Show/hide portlets",checkboxToggle:false,autoHeight:true,defaults:{width:210},defaultType:"checkbox",items:[{boxLabel:"Event Log",hideLabel:true,xtype:"checkbox",checked:m,listeners:{check:function(A,B){if(B){v.show()}else{v.hide()}}}},{boxLabel:"Host Problems",hideLabel:true,xtype:"checkbox",checked:n,listeners:{check:function(A,B){if(B){u.show()}else{u.hide()}}}},{boxLabel:"Service Problems",hideLabel:true,xtype:"checkbox",checked:q,listeners:{check:function(A,B){if(B){s.show()}else{s.hide()}}}},{boxLabel:"Monitoring Performance",hideLabel:true,xtype:"checkbox",checked:i,listeners:{check:function(A,B){if(B){p.show()}else{p.hide()}}}},{boxLabel:"Hostgroup: Service Status",hideLabel:true,xtype:"checkbox",checked:g,listeners:{check:function(A,B){if(B){z.show()}else{z.hide()}}}},{boxLabel:"Hostgroup: Host Status",hideLabel:true,xtype:"checkbox",checked:y,listeners:{check:function(A,B){if(B){k.show()}else{k.hide()}}}},{boxLabel:"Servicegroup: Service Status",hideLabel:true,xtype:"checkbox",checked:g,listeners:{check:function(A,B){if(B){t.show()}else{t.hide()}}}},{boxLabel:"Servicegroup: Host Status",hideLabel:true,xtype:"checkbox",checked:y,listeners:{check:function(A,B){if(B){w.show()}else{w.hide()}}}}]}]});var o=new Ext.Window({title:"Portlets",modal:true,closable:true,width:300,height:350,layout:"fit",items:h});o.show()}});npc.nagiosStatus();npc.hostSummary();npc.serviceSummary()}}}();Ext.ux.PortalColumn=Ext.extend(Ext.Container,{layout:"anchor",autoEl:"div",defaultType:"portlet",cls:"x-portal-column"});Ext.reg("portalcolumn",Ext.ux.PortalColumn);Ext.ux.Portlet=Ext.extend(Ext.Panel,{anchor:"100%",frame:true,collapsible:true,draggable:true,cls:"x-portlet"});Ext.reg("portlet",Ext.ux.Portlet);Ext.ux.Portal=Ext.extend(Ext.Panel,{layout:"column",autoScroll:true,cls:"x-portal",defaultType:"portalcolumn",initComponent:function(){Ext.ux.Portal.superclass.initComponent.call(this);this.addEvents({validatedrop:true,beforedragover:true,dragover:true,beforedrop:true,drop:true})},initEvents:function(){Ext.ux.Portal.superclass.initEvents.call(this);this.dd=new Ext.ux.Portal.DropZone(this,this.dropConfig)}});Ext.reg("portal",Ext.ux.Portal);Ext.ux.Portal.DropZone=function(a,b){this.portal=a;Ext.dd.ScrollManager.register(a.body);Ext.ux.Portal.DropZone.superclass.constructor.call(this,a.bwrap.dom,b);a.body.ddScrollConfig=this.ddScrollConfig};Ext.extend(Ext.ux.Portal.DropZone,Ext.dd.DropTarget,{ddScrollConfig:{vthresh:50,hthresh:-1,animate:true,increment:200},createEvent:function(a,f,d,b,h,g){return{portal:this.portal,panel:d.panel,columnIndex:b,column:h,position:g,data:d,source:a,rawEvent:f,status:this.dropAllowed}},notifyOver:function(v,t,w){var f=t.getXY(),a=this.portal,m=v.proxy;if(!this.grid){this.grid=this.getGrid()}var b=a.body.dom.clientWidth;if(!this.lastCW){this.lastCW=b}else{if(this.lastCW!=b){this.lastCW=b;a.doLayout();this.grid=this.getGrid()}}var d=0,k=this.grid.columnX,l=false;for(var q=k.length;d<q;d++){if(f[0]<(k[d].x+k[d].w)){l=true;break}}if(!l){d--}var o,j=false,i=0,u=a.items.itemAt(d),n=u.items.items;for(var q=n.length;i<q;i++){o=n[i];var s=o.el.getHeight();if(s!==0&&(o.el.getY()+(s/2))>f[1]){j=true;break}}var g=this.createEvent(v,t,w,d,u,j&&o?i:u.items.getCount());if(a.fireEvent("validatedrop",g)!==false&&a.fireEvent("beforedragover",g)!==false){m.getProxy().setWidth("auto");if(o){m.moveProxy(o.el.dom.parentNode,j?o.el.dom:null)}else{m.moveProxy(u.el.dom,null)}this.lastPos={c:u,col:d,p:j&&o?i:false};this.scrollPos=a.body.getScroll();a.fireEvent("dragover",g);return g.status}else{return g.status}},notifyOut:function(){delete this.grid},notifyDrop:function(k,g,f){delete this.grid;if(!this.lastPos){return}var i=this.lastPos.c,b=this.lastPos.col,j=this.lastPos.p;var a=this.createEvent(k,g,f,b,i,j!==false?j:i.items.getCount());if(this.portal.fireEvent("validatedrop",a)!==false&&this.portal.fireEvent("beforedrop",a)!==false){k.proxy.getProxy().remove();k.panel.el.dom.parentNode.removeChild(k.panel.el.dom);if(j!==false){i.insert(j,k.panel)}else{i.add(k.panel)}i.doLayout();this.portal.fireEvent("drop",a);var l=this.scrollPos.top;if(l){var h=this.portal.body.dom;setTimeout(function(){h.scrollTop=l},10)}}delete this.lastPos},getGrid:function(){var a=this.portal.bwrap.getBox();a.columnX=[];this.portal.items.each(function(b){a.columnX.push({x:b.el.getX(),w:b.el.getWidth()})});return a}});npc.eventLogGrid=Ext.extend(Ext.ux.grid.livegrid.GridPanel,{filter:"any",initComponent:function(){var a=new Ext.ux.grid.livegrid.JsonReader({root:"response.value.items",versionProperty:"response.value.version",totalProperty:"response.value.total_count",id:"host_object_id"},[{name:"instance_id",type:"int",sortType:"int"},{name:"instance_name",type:"string",sortType:"string"},{name:"logentry_id",type:"int",sortType:"int"},{name:"entry_time",type:"date",sortType:"date",dateFormat:"Y-m-d H:i:s"},{name:"logentry_data",type:"string",sortType:"string"}]);this.store=new Ext.ux.grid.livegrid.Store({autoLoad:true,bufferSize:200,reader:a,sortInfo:{field:"host_name",direction:"ASC"},url:"npc.php?module=logentries&action=getLogs"});this.selModel=new Ext.ux.grid.livegrid.RowSelectionModel();this.view=new Ext.ux.grid.livegrid.GridView({nearLimit:50,forceFit:true,autoFill:true,emptyText:"No events.",loadMask:{msg:"Please wait..."}});this.bbar=new Ext.ux.grid.livegrid.Toolbar({view:this.view,displayInfo:true});npc.eventLogGrid.superclass.initComponent.call(this)}});npc.eventLog=function(){var i="Event Log";var c="eventlog-tab";var e=c+"-grid";var b=Ext.state.Manager.get(e);var g=(b&&b.refresh)?b.refresh:300;var f=Ext.getCmp("centerTabPanel");var d=Ext.getCmp(c);var j=new Ext.grid.ColumnModel([{dataIndex:"logentry_data",renderer:npc.renderEventIcon,width:25},{header:"Instance",dataIndex:"instance_name",width:125,hidden:true,align:"left"},{header:"Date",dataIndex:"entry_time",width:100,renderer:npc.formatDate,align:"left"},{header:"Log Entry",dataIndex:"logentry_data",width:600,align:"left"}]);var a=new npc.eventLogGrid({id:e,height:800,cm:j,autoExpandColumn:"logentry_data",stripeRows:true,listeners:{beforestatesave:function(l,k){k.refresh=g;Ext.state.Manager.set(e,k);return false}},plugins:[new Ext.ux.grid.Search({mode:"remote",iconCls:false})]});if(d){f.setActiveTab(d)}else{f.add({id:c,title:i,closable:true,height:600,layout:"fit",deferredRender:false,containerScroll:true,items:a}).show();f.doLayout()}d=Ext.getCmp(c);f.setActiveTab(c);var h={destroy:function(){a.store.stopAutoRefresh()}};d.addListener(h)};npc.hostCommentsGrid=Ext.extend(Ext.ux.grid.livegrid.GridPanel,{host_object_id:0,initComponent:function(){var a=new Ext.ux.grid.livegrid.JsonReader({root:"response.value.items",versionProperty:"response.value.version",totalProperty:"response.value.total_count",id:"comment_id"},[{name:"comment_id",type:"int",sortType:"int"},{name:"instance_id",type:"int",sortType:"int"},{name:"host_name",sortType:"string"},{name:"host_icon_image",sortType:"string"},{name:"host_icon_image_alt",sortType:"string"},{name:"comment_time",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"object_id",type:"int",sortType:"int"},{name:"entry_type",type:"int",sortType:"int"},{name:"author_name",sortType:"string"},{name:"comment_data",sortType:"string"},{name:"is_persistent",sortType:"int",sortType:"int"},{name:"internal_comment_id",sortType:"int",sortType:"int"},{name:"expiration_time",type:"date",dateFormat:"Y-m-d H:i:s"}]);this.store=new Ext.ux.grid.livegrid.Store({autoLoad:true,bufferSize:100,reader:a,sortInfo:{field:"host_name",direction:"ASC"},url:"npc.php?module=comments&action=getHostComments&p_id="+this.host_object_id});this.selModel=new Ext.ux.grid.livegrid.RowSelectionModel();this.view=new Ext.ux.grid.livegrid.GridView({nearLimit:30,forceFit:true,autoFill:true,emptyText:"No Host comments.",loadMask:{msg:"Please wait..."}});this.bbar=new Ext.ux.grid.livegrid.Toolbar({view:this.view,displayInfo:true});npc.hostCommentsGrid.superclass.initComponent.call(this)}});npc.serviceCommentsGrid=Ext.extend(Ext.ux.grid.livegrid.GridPanel,{service_object_id:0,initComponent:function(){var a=new Ext.ux.grid.livegrid.JsonReader({root:"response.value.items",versionProperty:"response.value.version",totalProperty:"response.value.total_count",id:"comment_id"},[{name:"comment_id",type:"int",sortType:"int"},{name:"instance_id",type:"int",sortType:"int"},{name:"host_name",sortType:"string"},{name:"svc_icon_image",sortType:"string"},{name:"svc_icon_image_alt",sortType:"string"},{name:"host_icon_image",sortType:"string"},{name:"host_icon_image_alt",sortType:"string"},{name:"service_description",sortType:"string"},{name:"comment_time",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"object_id",type:"int",sortType:"int"},{name:"entry_type",type:"int",sortType:"int"},{name:"author_name",sortType:"string"},{name:"comment_data",sortType:"string"},{name:"is_persistent",sortType:"int",sortType:"int"},{name:"internal_comment_id",sortType:"int",sortType:"int"},{name:"expiration_time",type:"date",dateFormat:"Y-m-d H:i:s"}]);this.store=new Ext.ux.grid.livegrid.Store({autoLoad:true,bufferSize:100,reader:a,sortInfo:{field:"service_description",direction:"ASC"},url:"npc.php?module=comments&action=getServiceComments&p_id="+this.service_object_id});this.selModel=new Ext.ux.grid.livegrid.RowSelectionModel();this.view=new Ext.ux.grid.livegrid.GridView({nearLimit:30,forceFit:true,autoFill:true,emptyText:"No service comments.",loadMask:{msg:"Please wait..."}});this.bbar=new Ext.ux.grid.livegrid.Toolbar({view:this.view,displayInfo:true});npc.serviceCommentsGrid.superclass.initComponent.call(this)}});npc.comments=function(){var k="Comments";var b="comments-tab";npc.addCenterNestedTab(b,"Comments");var e=Ext.getCmp("centerTabPanel");var j="comments-tab-inner-panel";var f=Ext.getCmp(j);var d=Ext.getCmp(f);if(d){f.setActiveTab(d);return}else{f.add({id:"host-comments-tab",title:"Host Comments",height:600,deferredRender:false,hideMode:"offsets",layout:"fit",closable:false});f.add({id:"service-comments-tab",title:"Service Comments",height:600,deferredRender:false,hideMode:"offsets",layout:"fit",closable:false});f.show();f.setActiveTab(0)}function c(l,n,m){return String.format('<img src="images/icons/comment_delete.png">')}var g=new Ext.grid.ColumnModel([{header:"Host Name",dataIndex:"host_name",renderer:npc.renderHostIcons,width:120},{header:"Entry Time",dataIndex:"comment_time",renderer:npc.formatDate,width:120},{header:"Author",dataIndex:"author_name",width:100},{header:"Comment",dataIndex:"comment_data",width:400},{header:"Persistent",dataIndex:"is_persistent",renderer:npc.renderPersistent,hidden:true,width:80},{header:"Type",dataIndex:"entry_type",renderer:npc.renderCommentType,hidden:true,width:100},{header:"Expires",dataIndex:"expiration_time",renderer:npc.renderCommentExpires,hidden:true,width:120},{header:"Delete",dataIndex:"internal_comment_id",renderer:c,align:"center",width:50}]);var i=new npc.hostCommentsGrid({height:800,cm:g,autoExpandColumn:"comment_data",stripeRows:true,tbar:[{text:"New Comment",msg:"Add a new host comment.",iconCls:"commentAdd",handler:function(){npc.addHostComment()}},"-",{text:"Delete comments",tooltip:"Delete all host comments",iconCls:"commentsDelete",handler:function(){Ext.Msg.show({title:"Confirm Delete",msg:"Are you sure you want to delete all host comments?",buttons:Ext.Msg.YESNO,fn:function(l){if(l=="yes"){npc.aPost({module:"comments",action:"deleteAllHostComments"})}},animEl:"elId",icon:Ext.MessageBox.QUESTION})}}],plugins:[new Ext.ux.grid.Search({mode:"remote",iconCls:false,disableIndexes:["comment_time","expiration_time","is_persistent","entry_type","internal_comment_id"]})]});var h=new Ext.grid.ColumnModel([{header:"Host Name",dataIndex:"host_name",renderer:npc.renderHostIcons,width:120},{header:"Service",dataIndex:"service_description",renderer:npc.renderServiceIcons,width:120},{header:"Entry Time",dataIndex:"comment_time",renderer:npc.formatDate,width:120},{header:"Author",dataIndex:"author_name",width:100},{header:"Comment",dataIndex:"comment_data",width:400},{header:"Persistent",dataIndex:"is_persistent",renderer:npc.renderPersistent,hidden:true,width:80},{header:"Type",dataIndex:"entry_type",renderer:npc.renderCommentType,hidden:true,width:100},{header:"Expires",dataIndex:"expiration_time",renderer:npc.renderCommentExpires,hidden:true,width:120},{header:"Delete",dataIndex:"internal_comment_id",renderer:c,align:"center",width:50}]);var a=new npc.serviceCommentsGrid({height:800,cm:h,autoExpandColumn:"comment_data",stripeRows:true,tbar:[{text:"New Comment",iconCls:"commentAdd",handler:function(){npc.addComment("svc")}},"-",{text:"Delete comments",tooltip:"Delete all service comments",iconCls:"commentsDelete",handler:function(){Ext.Msg.show({title:"Confirm Delete",msg:"Are you sure you want to delete all service comments?",buttons:Ext.Msg.YESNO,fn:function(l){if(l=="yes"){npc.aPost({module:"comments",action:"deleteAllServiceComments"})}},animEl:"elId",icon:Ext.MessageBox.QUESTION})}}],plugins:[new Ext.ux.grid.Search({mode:"remote",iconCls:false,disableIndexes:["comment_time","expiration_time","is_persistent","entry_type","internal_comment_id"]})]});Ext.getCmp("host-comments-tab").add(i);Ext.getCmp("service-comments-tab").add(a);e.doLayout();i.render();a.render();i.addListener("cellclick",function(l,p,m,n){var o=l.getStore().getAt(p);var q=l.getColumnModel().getDataIndex(m);if(q=="internal_comment_id"){Ext.Msg.show({title:"Confirm Delete",msg:"Are you sure you want to delete this comment?",buttons:Ext.Msg.YESNO,fn:function(t){if(t=="yes"){var s={module:"nagios",action:"command",p_command:"DEL_HOST_COMMENT",p_comment_id:o.get(q)};npc.aPost(s)}},animEl:"elId",icon:Ext.MessageBox.QUESTION})}});a.addListener("cellclick",function(l,p,m,n){var o=l.getStore().getAt(p);var q=l.getColumnModel().getDataIndex(m);if(q=="internal_comment_id"){Ext.Msg.show({title:"Confirm Delete",msg:"Are you sure you want to delete this comment?",buttons:Ext.Msg.YESNO,fn:function(t){if(t=="yes"){var s={module:"nagios",action:"command",p_command:"DEL_SVC_COMMENT",p_comment_id:o.get(q)};npc.aPost(s)}},animEl:"elId",icon:Ext.MessageBox.QUESTION})}})};npc.servicegroupOverview=function(){var o="Servicegroup Overview";var e="servicegroupOverview-tab";var i=e+"-grid";var d="npc.php?module=servicegroups&action=getOverview";var c=Ext.state.Manager.get(i);var m=(c&&c.rows)?c.rows:15;var k=(c&&c.refresh)?c.refresh:60;var b="services-tab";npc.addCenterNestedTab(b,"Services");var h=Ext.getCmp("centerTabPanel");var n="services-tab-inner-panel";var g=Ext.getCmp(n);var f=Ext.getCmp(e);if(f){g.setActiveTab(f);return}else{g.add({id:e,title:o,height:600,layout:"fit",closable:true}).show();g.setActiveTab(f);f=Ext.getCmp(e)}var q=new Ext.data.GroupingStore({url:d,autoload:true,sortInfo:{field:"host_name",direction:"ASC"},reader:new Ext.data.JsonReader({totalProperty:"totalCount",root:"data"},[{name:"instance_id",type:"int"},{name:"servicegroup_object_id",type:"int"},"alias","host_name",{name:"host_state",type:"int"},{name:"critical",type:"int"},{name:"warning",type:"int"},{name:"unknown",type:"int"},{name:"ok",type:"int"},{name:"pending",type:"int"}]),groupField:"alias"});var p=new Ext.grid.ColumnModel([{header:"Servicegroup",dataIndex:"alias",hidden:true},{header:"Host",dataIndex:"host_name",sortable:true,width:100},{header:"Status",dataIndex:"host_state",align:"center",width:40,renderer:npc.hostStatusImage},{id:"sgHostTotalsCRITICAL",header:"Critical",dataIndex:"critical",align:"center",width:40,renderer:npc.renderStatusBg},{id:"sgHostTotalsWARNING",header:"Warning",dataIndex:"warning",align:"center",width:45,renderer:npc.renderStatusBg},{id:"sgHostTotalsUNKNOWN",header:"Unknown",dataIndex:"unknown",align:"center",width:45,renderer:npc.renderStatusBg},{id:"sgHostTotalsOK",header:"Ok",dataIndex:"ok",align:"center",width:25,renderer:npc.renderStatusBg},{id:"sgHostTotalsPENDING",header:"Pending",dataIndex:"pending",align:"center",width:45,renderer:npc.renderStatusBg}]);var a=new Ext.grid.GridPanel({id:i,height:600,layout:"fit",autoExpandColumn:"host_name",autoScroll:true,listeners:{beforestatesave:function(u,t){t.rows=m;t.refresh=k;Ext.state.Manager.set(i,t);return false}},store:q,cm:p,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),stripeRows:true,view:new Ext.grid.GroupingView({forceFit:true,autoFill:true,hideGroupedColumn:true,enableGroupingMenu:false,enableNoGroups:true,emptyText:"No servicegroups.",groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "Hosts" : "Host"]})'}),bbar:new Ext.PagingToolbar({pageSize:m,store:q,displayInfo:true,displayMsg:"",items:npc.setRefreshCombo(i,q,c),plugins:new Ext.ux.Andrie.pPageSize({gridId:i})})});f.add(a);h.doLayout();a.render();a.store.load({params:{start:0,limit:m}});q.startAutoRefresh(k);var l={destroy:function(){q.stopAutoRefresh();if(!g.items.length){h.remove(b,true)}}};f.addListener(l);a.on("rowdblclick",j);a.on("rowcontextmenu",npc.serviceContextMenu);function j(t,w,v){var u=t.getStore().getAt(w).json.servicegroup_object_id;var s=t.getStore().getAt(w).json.alias;npc.servicegroupGrid("servicegroupGrid-"+u,"Servicegroup: "+s,u)}};npc.serviceDetail=function(H){var N=(typeof H.data.service_object_id!="undefined")?H.data.service_object_id:H.data.object_id;var F="serviceDetail"+N+"-tab";var z=H.data.host_name+": "+H.data.service_description;var D="services-tab";npc.addCenterNestedTab(D,"Services");var X=Ext.getCmp("centerTabPanel");var o="services-tab-inner-panel";var C=o+"-details";var U=Ext.getCmp(o);var S=Ext.getCmp(F);var V=new Ext.menu.Menu();V=npc.serviceCommandMenu(H.data,V);function m(aa,Z,Y){return String.format("{0}/{1}",aa,Y.data.max_check_attempts)}function W(Z){var Y;switch(Z){case"0":Y="Soft";break;case"1":Y="Hard";break}return String.format("{0}",Y)}function G(Y,aa,Z){return String.format('<img src="images/icons/comment_delete.png">')}function t(aa,Z){var ac;var ad;var Y;switch(aa){case"Active Checks Enabled":Y=" active checks for this service?";ac="_SVC_CHECK";break;case"Passive Checks Enabled":Y=" passive checks for this service?";ac="_PASSIVE_SVC_CHECKS";break;case"Event Handler Enabled":Y=" event handler for this service?";ac="_SVC_EVENT_HANDLER";break;case"Flap Detection Enabled":Y=" flap detection for this service?";ac="_SVC_FLAP_DETECTION";break;case"Notifications Enabled":Y=" notifications for this service?";ac="_SVC_NOTIFICATIONS";break;case"Obsess Over Service":var ae="Stop";if(Z=="Enable"){ae="Start"}ad=ae+" obsessing over this service?";ac=ae.toUpperCase()+"_OBSESSING_OVER_SVC";break}if(aa.match("Enabled")){ac=Z.toUpperCase()+ac;ad=Z+Y}var ab={module:"nagios",action:"command",p_command:ac,p_host_name:H.data.host_name,p_service_description:H.data.service_description};npc.doCommand(ad,ab)}if(S){U.setActiveTab(S);U.doLayout();return}else{U.add({id:F,title:z,height:600,layout:"fit",deferredRender:false,layoutOnTabChange:true,closable:true,containerScroll:true,items:[new Ext.TabPanel({id:C,style:"padding:5px 0 5px 5px",height:600,plain:true,border:false,deferredRender:false,layoutOnTabChange:true})]}).show();X.doLayout();U.setActiveTab(S);S=Ext.getCmp(F)}var n=new Ext.data.JsonStore({url:"npc.php?module=services&action=getServices&p_id="+N,root:"response.value.items",versionProperty:"response.value.version",totalProperty:"response.value.total_count",id:"service_object_id",fields:["host_name","notes_url","service_description","perfdata",{name:"local_graph_id",type:"int"},{name:"service_object_id",type:"int"},{name:"current_state",type:"int"},{name:"problem_has_been_acknowledged",type:"int"},{name:"notifications_enabled",type:"int"},{name:"active_checks_enabled",type:"int"},{name:"passive_checks_enabled",type:"int"},{name:"obsess_over_service",type:"int"},{name:"event_handler_enabled",type:"int"},{name:"flap_detection_enabled",type:"int"}]});n.load();var g=new Ext.data.JsonStore({url:"npc.php?module=services&action=getStateInfo&p_id="+N,totalProperty:"totalCount",root:"data",fields:["name","value"],autoload:true});g.load();var b=new Ext.grid.ColumnModel([{header:"Parameter",dataIndex:"name",width:100},{header:"Value",dataIndex:"value",width:300,align:"left"}]);var f=new Ext.grid.GridPanel({title:"Service State Information",height:800,autoWidth:true,deferredRender:false,store:g,cm:b,autoExpandColumn:"Value",sm:new Ext.grid.RowSelectionModel(),stripeRows:true,tbar:[{text:"Commands",iconCls:"cogAdd",menu:V},"-",{text:"View Graph",iconCls:"chartBar",handler:function(){var Y=n.data.items[0].data.local_graph_id;if(Y){if(!Ext.getCmp("serviceGraph"+Y)){var Z=new Ext.Window({title:H.data.host_name+": "+H.data.service_description,id:"serviceGraph"+Y,layout:"fit",modal:false,closable:true,html:'<img src="'+npc.params.cacti_path+"/graph_image.php?action=view&local_graph_id="+Y+'&rra_id=1">',width:640}).show()}}else{npc.mapGraph("services",N)}}},"-",{text:"Map Graph",iconCls:"chartBarAdd",handler:function(){npc.mapGraph("services",N)}}],view:new Ext.grid.GridView({forceFit:true,autoFill:true})});f.on("rowdblclick",function(aa,ab){var ac=aa.getStore().getAt(ab).data.name;var Z=aa.getStore().getAt(ab).data.value;var Y=false;if(Z.match("tick.png")){Y="Disable"}else{if(Z.match("cross.png")){Y="Enable"}}if(Y){t(ac,Y)}});var O=new Ext.data.JsonStore({url:"npc.php?module=notifications&action=getNotifications&p_id="+N,totalProperty:"totalCount",root:"data",fields:["state",{name:"start_time",type:"date",dateFormat:"Y-m-d H:i:s"},"output"],autoload:true});var p=new Ext.grid.ColumnModel([{header:"",dataIndex:"state",width:40,renderer:npc.serviceStatusImage},{header:"Date",dataIndex:"start_time",width:120,renderer:npc.formatDate},{header:"Message",dataIndex:"output",width:600}]);var l=F+"-snGrid";var Q=Ext.state.Manager.get(l);var e=(Q&&Q.rows)?Q.rows:15;var a=(Q&&Q.refresh)?Q.refresh:60;var P=new Ext.grid.GridPanel({id:l,title:"Notification History",height:800,autoScroll:true,layout:"fit",deferredRender:false,store:O,cm:p,autoExpandColumn:"output",stripeRows:true,listeners:{beforestatesave:function(Z,Y){Y.rows=e;Y.refresh=a;Ext.state.Manager.set(l,Y);return false}},view:new Ext.grid.GridView({forceFit:true,autoFill:true,emptyText:"No notifications."}),bbar:new Ext.PagingToolbar({pageSize:e,store:O,displayInfo:true,items:npc.setRefreshCombo(l,O,Q),plugins:new Ext.ux.Andrie.pPageSize({gridId:l})})});var J=new Ext.data.JsonStore({url:"npc.php?module=statehistory&action=getStateHistory&type=2&p_id="+N,totalProperty:"totalCount",root:"data",fields:["state",{name:"state_time",type:"date",dateFormat:"Y-m-d H:i:s"},"state_type","current_check_attempt","max_check_attempts","output"],autoload:true});var d=new Ext.grid.ColumnModel([{header:"",dataIndex:"state",renderer:npc.serviceStatusImage,width:40},{header:"Date",dataIndex:"state_time",renderer:npc.formatDate,width:120},{header:"State Type",dataIndex:"state_type",renderer:W,width:80},{header:"Check Attempt",dataIndex:"current_check_attempt",renderer:m,width:100},{header:"Plugin Output",dataIndex:"output",width:500}]);var k=F+"-shGrid";var w=Ext.state.Manager.get(k);var B=(w&&w.rows)?w.rows:15;var K=(w&&w.refresh)?w.refresh:60;var s=new Ext.grid.GridPanel({id:k,title:"State History",height:800,autoScroll:true,layout:"fit",deferredRender:false,autoExpandColumn:"output",store:J,cm:d,stripeRows:true,listeners:{beforestatesave:function(Z,Y){Y.rows=B;Y.refresh=K;Ext.state.Manager.set(k,Y);return false}},view:new Ext.grid.GridView({forceFit:true,autoFill:true,emptyText:"No alerts."}),bbar:new Ext.PagingToolbar({pageSize:B,store:J,displayInfo:true,items:npc.setRefreshCombo(k,J,w),plugins:new Ext.ux.Andrie.pPageSize({gridId:k})})});var E=new Ext.data.JsonStore({url:"npc.php?module=downtime&action=getDowntime&p_id="+N,totalProperty:"totalCount",root:"data",fields:[{name:"entry_time",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"scheduled_start_time",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"scheduled_end_time",type:"date",dateFormat:"Y-m-d H:i:s"},"author_name","comment_data"],autoload:true});var A=new Ext.grid.ColumnModel([{header:"Entry Time",dataIndex:"entry_time",renderer:npc.formatDate,width:120},{header:"Start Time",dataIndex:"scheduled_start_time",renderer:npc.formatDate,width:120},{header:"End Time",dataIndex:"scheduled_end_time",renderer:npc.formatDate,width:120},{header:"User",dataIndex:"author_name",width:100},{header:"Comment",dataIndex:"comment_data",width:400}]);var i=F+"-sdGrid";var M=Ext.state.Manager.get(i);var T=(M&&M.rows)?M.rows:15;var y=(M&&M.refresh)?M.refresh:60;var v=new Ext.grid.GridPanel({id:i,title:"Scheduled Downtime History",height:800,layout:"fit",deferredRender:false,store:E,cm:A,autoExpandColumn:"comment_data",stripeRows:true,listeners:{beforestatesave:function(Z,Y){Y.rows=T;Y.refresh=y;Ext.state.Manager.set(i,Y);return false}},view:new Ext.grid.GridView({forceFit:true,autoFill:true,emptyText:"No downtime."}),bbar:new Ext.PagingToolbar({pageSize:T,store:E,displayInfo:true,items:npc.setRefreshCombo(i,E,M),plugins:new Ext.ux.Andrie.pPageSize({gridId:i})})});var I=new Ext.grid.ColumnModel([{header:"Entry Time",dataIndex:"comment_time",renderer:npc.formatDate,width:120},{header:"Author",dataIndex:"author_name",width:100},{header:"Comment",dataIndex:"comment_data",width:500},{header:"Persistent",dataIndex:"is_persistent",renderer:npc.renderPersistent,hidden:true,width:75},{header:"Type",dataIndex:"entry_type",renderer:npc.renderCommentType,hidden:true,width:100},{header:"Expires",dataIndex:"expiration_time",renderer:npc.renderCommentExpires,hidden:true,width:120},{header:"Delete",dataIndex:"internal_comment_id",renderer:G,align:"center",width:50}]);var j=F+"-scGrid";var u=Ext.state.Manager.get(j);var q=(u&&u.rows)?u.rows:15;var c=(u&&u.refresh)?u.refresh:60;var R=new npc.serviceCommentsGrid({id:j,service_object_id:N,title:"Comments",height:800,deferredRender:false,cm:I,autoExpandColumn:"comment_data",stripeRows:true,tbar:[{text:"New Comment",iconCls:"commentAdd",handler:function(){npc.addComment("svc",H.data.host_name,H.data.service_description)}},"-",{text:"Delete comments",tooltip:"Delete all comments",iconCls:"commentsDelete",handler:function(){Ext.Msg.show({title:"Confirm Delete",msg:"Are you sure you want to delete all comments?",buttons:Ext.Msg.YESNO,fn:function(Y){if(Y=="yes"){npc.aPost({module:"nagios",action:"command",p_command:"DEL_ALL_SVC_COMMENTS",p_host_name:H.data.host_name,p_service_description:H.data.service_description})}},animEl:"elId",icon:Ext.MessageBox.QUESTION})}}],plugins:[new Ext.ux.grid.Search({mode:"remote",iconCls:false,disableIndexes:["comment_time","expiration_time","is_persistent","entry_type","internal_comment_id"]})]});var h=Ext.getCmp(C);h.add(f);h.add(P);h.add(s);h.add(v);h.add(R);h.add({id:"sdNotes"+N,title:"Additional Information",disabled:true,tabTip:"Enabled by setting the notes_url parameter in your Nagios service definition."});X.doLayout();f.render();P.render();s.render();v.render();R.render();h.setActiveTab(f);O.load({params:{start:0,limit:e}});J.load({params:{start:0,limit:B}});E.load({params:{start:0,limit:T}});n.startAutoRefresh(60);g.startAutoRefresh(60);O.startAutoRefresh(a);J.startAutoRefresh(K);E.startAutoRefresh(y);var L={destroy:function(){n.stopAutoRefresh();g.stopAutoRefresh();O.stopAutoRefresh();J.stopAutoRefresh();E.stopAutoRefresh();if(!U.items.length){X.remove(D,true)}}};S.addListener(L);R.addListener("cellclick",function(Y,ac,Z,aa){var ab=Y.getStore().getAt(ac);var ad=Y.getColumnModel().getDataIndex(Z);if(ad=="internal_comment_id"){Ext.Msg.show({title:"Confirm Delete",msg:"Are you sure you want to delete this comment?",buttons:Ext.Msg.YESNO,fn:function(af){if(af=="yes"){var ae={module:"nagios",action:"command",p_command:"DEL_SVC_COMMENT",p_comment_id:ab.get(ad)};npc.aPost(ae)}},animEl:"elId",icon:Ext.MessageBox.QUESTION})}});n.on("load",function(){npc.serviceCommandMenu(n.data.items[0].data,V);var Y=n.data.items[0].data.notes_url;var aa=Ext.getCmp("sdNotes"+N);if(Y&&aa.disabled){h.remove(aa);h.add({id:"sdNotes"+N,title:"Additional Information",disabled:false,layout:"fit",deferredRender:false,layoutOnTabChange:true,scripts:true,items:[new Ext.ux.IFrameComponent({url:Y})]});h.doLayout()}if(!Ext.getCmp("dimb"+N)){var Z=n.data.items[0].data.perfdata;if(Z!=""){f.getTopToolbar().add("-",{text:"Data Input Method",id:"dimb"+N,iconCls:"scriptAdd",handler:function(){Ext.Msg.show({title:"Create Data Input Method",msg:"Are you sure you want to create a data input method for this service?",buttons:Ext.Msg.YESNO,fn:function(ac){if(ac=="yes"){var ab={module:"cacti",action:"addDataInputMethod",p_host:H.data.host_name,p_service:H.data.service_description,p_object_id:N};npc.aPost(ab)}},animEl:"elId",icon:Ext.MessageBox.QUESTION})}})}}})};npc.serviceCommandMenu=function(b,g){var f;var c;g.removeAll();var e={module:"nagios",action:"command",p_host_name:b.host_name,p_service_description:b.service_description};var d='<b style="font-size: xx-small">';if(b.current_state>0){if(!b.problem_has_been_acknowledged){g.add({text:d+"Acknowledge Problem</b>",handler:function(a){npc.ackProblem("svc",b.host_name,b.service_description)}})}else{g.add({text:d+"Remove problem acknowledgement</b>",handler:function(a){e.p_command="REMOVE_SVC_ACKNOWLEDGEMENT";e.p_host_name=b.host_name;e.p_service_description=b.service_description;npc.doCommand(a.text+"?",e)}})}}g.add({text:d+"Re-schedule Next Check</b>",handler:function(){npc.scheduleNextCheck("svc",b.host_name,b.service_description)}});c=b.active_checks_enabled?"Disable":"Enable";f=d+c+" Active Checks</b>";g.add({action:c,text:f,handler:function(a){e.p_command=a.action.toUpperCase()+"_SVC_CHECK";npc.doCommand(a.text+"?",e)}});c=b.notifications_enabled?"Disable":"Enable";f=d+c+" Notifications</b>";g.add({action:c,text:f,handler:function(a){e.p_command=a.action.toUpperCase()+"_SVC_NOTIFICATIONS";npc.doCommand(a.text+"?",e)}});g.add({text:d+"Send Custom Notification</b>",handler:function(){npc.sendCustomNotification("svc",b.host_name,b.service_description)}});if(b.passive_checks_enabled){g.add({text:d+"Submit Passive Check Result</b>",handler:function(){npc.submitPassiveCheckResult("service",b.host_name,b.service_description)}})}g.add({text:d+"Schedule Downtime</b>",handler:function(){npc.scheduleDowntime("svc",b.host_name,b.service_description)}});c=b.passive_checks_enabled?"Stop":"Start";f=d+c+" Accepting Passive Checks</b>";g.add({action:c,text:f,handler:function(a){e.p_command=a.action.toUpperCase()+"_PASSIVE_SVC_CHECKS</b>";npc.doCommand(a.text+"?",e)}});c=b.obsess_over_service?"Stop":"Start";f=d+c+" Obsessing</b>";g.add({action:c,text:f,handler:function(a){e.p_command=a.action.toUpperCase()+"_OBSESSING_OVER_SVC";npc.doCommand(a.text+"?",e)}});c=b.event_handler_enabled?"Disable":"Enable";f=d+c+" Event Handler</b>";g.add({action:c,text:f,handler:function(a){e.p_command=a.action.toUpperCase()+"_SVC_EVENT_HANDLER";npc.doCommand(a.text+"?",e)}});c=b.flap_detection_enabled?"Disable":"Enable";f=d+c+" Flap Detection</b>";g.add({action:c,text:f,handler:function(a){e.p_command=a.action.toUpperCase()+"_SVC_FLAP_DETECTION";npc.doCommand(a.text+"?",e)}});if(b.current_state==2){g.add({text:d+"Delay next notification</b>",handler:function(){npc.delayNextNotification("svc",b.host_name,b.service_description)}})}return(g)};npc.servicegroupGrid=function(m,s,c){s=(typeof s=="undefined")?"Servicegroup Grid":s;m=(typeof m=="undefined")?"servicegroupGrid-tab":m;var l=m+"-grid";c=(typeof c=="undefined")?"":"&p_id="+c;var f="npc.php?module=servicegroups&action=getServices"+c;var g=Ext.state.Manager.get(l);var p=(g&&g.rows)?g.rows:15;var e=(g&&g.refresh)?g.refresh:60;var j="services-tab";npc.addCenterNestedTab(j,"Services");var h=Ext.getCmp("centerTabPanel");var q="services-tab-inner-panel";var d=Ext.getCmp(q);var b=Ext.getCmp(m);if(b){d.setActiveTab(b);return}else{d.add({id:m,title:s,height:600,layout:"fit",closable:true}).show();d.setActiveTab(b);b=Ext.getCmp(m)}function o(v,u,t){return String.format("{0}/{1}",v,t.data.max_check_attempts)}var i=new Ext.data.GroupingStore({url:f,autoload:true,sortInfo:{field:"service_description",direction:"ASC"},reader:new Ext.data.JsonReader({totalProperty:"totalCount",root:"data"},["servicegroup_id","instance_id","config_type","servicegroup_object_id","alias","instance_name","servicegroup_name","servicestatus_id","current_state","output","service_object_id","host_name","service_description","comment","acknowledgement",{name:"problem_has_been_acknowledged",type:"int"},{name:"notifications_enabled",type:"int"},{name:"active_checks_enabled",type:"int"},{name:"passive_checks_enabled",type:"int"},{name:"is_flapping",type:"int"}]),groupField:"alias"});var k=new Ext.grid.ColumnModel([{header:"Host",dataIndex:"host_name",sortable:true,width:75},{header:"Service",dataIndex:"service_description",renderer:npc.renderExtraIcons,width:75},{header:"Status",dataIndex:"current_state",renderer:npc.serviceStatusImage,width:40},{header:"Plugin Output",dataIndex:"output",width:400},{header:"Serivce Group",dataIndex:"alias",hidden:true,width:75}]);var a=new Ext.grid.GridPanel({id:l,height:800,layout:"fit",autoExpandColumn:"output",autoScroll:true,store:i,cm:k,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),stripeRows:true,listeners:{beforestatesave:function(u,t){t.rows=p;t.refresh=e;Ext.state.Manager.set(l,t);return false}},view:new Ext.grid.GroupingView({forceFit:true,autoFill:true,hideGroupedColumn:true,enableGroupingMenu:false,enableNoGroups:true,emptyText:"No servicegroups.",groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "Services" : "Service"]})'}),bbar:new Ext.PagingToolbar({pageSize:p,store:i,displayInfo:true,items:npc.setRefreshCombo(l,i,g),plugins:new Ext.ux.Andrie.pPageSize({gridId:l})}),plugins:[new Ext.ux.grid.Search({mode:"remote",iconCls:false,disableIndexes:["current_state"]})]});b.add(a);h.doLayout();a.render();a.store.load({params:{start:0,limit:p}});i.startAutoRefresh(e);var n={destroy:function(){i.stopAutoRefresh();if(!d.items.length){h.remove(j,true)}}};b.addListener(n);a.on("rowdblclick",npc.serviceGridClick);a.on("rowcontextmenu",npc.serviceContextMenu)};npc.servicesGrid=Ext.extend(Ext.ux.grid.livegrid.GridPanel,{filter:"any",initComponent:function(){var a=new Ext.ux.grid.livegrid.JsonReader({root:"response.value.items",versionProperty:"response.value.version",totalProperty:"response.value.total_count",id:"service_object_id"},[{name:"instance_name",sortType:"string"},{name:"host_object_id",type:"int",sortType:"int"},{name:"host_name",sortType:"string"},{name:"host_alias",sortType:"string"},{name:"host_address",sortType:"string"},{name:"service_object_id",type:"int",sortType:"int"},{name:"local_graph_id",type:"int",sortType:"int"},{name:"service_description",sortType:"string"},{name:"notes",sortType:"string"},{name:"notes_url",sortType:"string"},{name:"action_url",sortType:"string"},{name:"icon_image",sortType:"string"},{name:"icon_image_alt",sortType:"string"},{name:"host_icon_image",sortType:"string"},{name:"host_icon_image_alt",sortType:"string"},{name:"acknowledgement",sortType:"string"},{name:"comment",sortType:"string"},{name:"output",sortType:"string"},{name:"current_state",type:"int",sortType:"int"},{name:"current_check_attempt",type:"int",sortType:"int"},{name:"max_check_attempts",type:"int",sortType:"int"},{name:"last_check",type:"date",sortType:"date",dateFormat:"Y-m-d H:i:s"},{name:"next_check",type:"date",sortType:"date",dateFormat:"Y-m-d H:i:s"},{name:"last_state_change",type:"date",sortType:"date",dateFormat:"Y-m-d H:i:s"},{name:"problem_has_been_acknowledged",type:"int",sortType:"int"},{name:"notifications_enabled",type:"int",sortType:"int"},{name:"active_checks_enabled",type:"int",sortType:"int"},{name:"passive_checks_enabled",type:"int",sortType:"int"},{name:"is_flapping",type:"int",sortType:"int"},{name:"in_downtime",type:"int",sortType:"int"}]);this.store=new Ext.ux.grid.livegrid.Store({autoLoad:true,bufferSize:100,reader:a,sortInfo:{field:"host_name",direction:"ASC"},url:"npc.php?module=services&action=getServices&p_state="+this.filter});this.selModel=new Ext.ux.grid.livegrid.RowSelectionModel();this.view=new Ext.ux.grid.livegrid.GridView({nearLimit:30,forceFit:true,autoFill:true,emptyText:"No services.",loadMask:{msg:"Please wait..."}});this.bbar=new Ext.ux.grid.livegrid.Toolbar({view:this.view,displayInfo:true});npc.servicesGrid.superclass.initComponent.call(this)}});npc.services=function(m,d){var c=m.replace(/[-' ']/g,"")+"-tab";var h=c+"-grid";var b="services-tab";npc.addCenterNestedTab(b,"Services");var f=Ext.getCmp("centerTabPanel");var l="services-tab-inner-panel";var g=Ext.getCmp(l);var e=Ext.getCmp(c);if(e){g.setActiveTab(e);g.doLayout();return}else{g.add({id:c,title:m,deferredRender:false,height:600,layout:"fit",layoutOnTabChange:true,closable:true}).show();g.setActiveTab(e);e=Ext.getCmp(c)}function j(t,s,q){return String.format("{0}/{1}",t,q.data.max_check_attempts)}function i(u,t,q){var s="";if(u){s='<img src="images/icons/chart_bar.png">'}return String.format("{0}",s)}var n=new Ext.grid.ColumnModel([{header:"Host",dataIndex:"host_name",renderer:npc.renderHostIcons,sortable:true,width:50},{header:"Host Alias",dataIndex:"host_alias",hidden:true,width:50},{header:"Host Address",dataIndex:"host_address",hidden:true,width:50},{header:"Service",dataIndex:"service_description",renderer:npc.renderServiceIcons,sortable:true,width:100},{header:"Status",dataIndex:"current_state",renderer:npc.serviceStatusImage,width:30},{header:"Graph",dataIndex:"local_graph_id",renderer:i,width:30},{header:"Instance",dataIndex:"instance_name",hidden:true,width:45},{header:"Last Check",dataIndex:"last_check",renderer:npc.formatDate,hidden:true,width:100},{header:"Next Check",dataIndex:"next_check",renderer:npc.formatDate,hidden:true,width:100},{header:"Duration",dataIndex:"last_state_change",renderer:npc.getDuration,hidden:true,width:110},{header:"Attempt",dataIndex:"current_check_attempt",renderer:j,hidden:true,width:50},{header:"Plugin Output",dataIndex:"output",width:400},{header:"Notes",dataIndex:"notes",width:100}]);var a=new npc.servicesGrid({id:h,height:800,filter:d,enableDragDrop:false,cm:n,stripeRows:true,loadMask:{msg:"Loading..."},plugins:[new Ext.ux.grid.Search({mode:"remote",iconCls:false,disableIndexes:["last_check","next_check","local_graph_id","last_state_change","current_check_attempt","current_state","host_address","instance_name"]})]});e.add(a);f.doLayout();if(d!="any"){a.getBottomToolbar().add("","","","-","","",{text:"Unhandled",enableToggle:true,iconCls:"pageWhiteWrench",handler:o})}if(d!="any"){a.store.startAutoRefresh(npc.params.npc_portlet_refresh)}var k={destroy:function(){a.store.stopAutoRefresh();if(!g.items.length){f.remove(b,true)}}};e.addListener(k);a.on("rowdblclick",npc.serviceGridClick);a.on("rowcontextmenu",npc.serviceContextMenu);a.on("cellclick",function(q,w,s){var p=q.getStore().getAt(w);var v=q.getColumnModel().getDataIndex(s);var t=p.get(v);if(v=="local_graph_id"&&t&&!Ext.getCmp("serviceGraph"+t)){var u=new Ext.Window({title:p.data.host_name+": "+p.data.service_description,id:"serviceGraph"+t,layout:"fit",modal:false,closable:true,html:'<img src="'+npc.params.cacti_path+"/graph_image.php?action=view&local_graph_id="+t+'&rra_id=1">',width:600}).show()}});function o(q){var p="npc.php?module=services&action=getServices&p_state=not_ok";if(q.pressed){p=p+"&p_unhandled=1";q.setText("All Problems")}else{q.setText("Unhandled")}a.store.proxy.conn.url=p;a.store.reload()}};npc.processInfo=function(){var i="Process Info";var a="processinfo-tab";var c=Ext.getCmp("centerTabPanel");var b=Ext.getCmp(a);if(b){c.setActiveTab(b);return}else{c.add({id:a,title:i,height:600,layout:"fit",deferredRender:false,closable:true});c.show();b=Ext.getCmp(a);c.setActiveTab(b)}var d=new Ext.data.JsonStore({url:"npc.php?module=nagios&action=getProcessInfoGrid",totalProperty:"totalCount",root:"data",fields:["name","value"],autoload:true});var e=new Ext.grid.ColumnModel([{header:"Parameter",dataIndex:"name",width:100},{header:"Value",dataIndex:"value",width:300,align:"left"}]);var f=new Ext.grid.GridPanel({height:800,layout:"fit",store:d,cm:e,autoExpandColumn:"Value",sm:new Ext.grid.RowSelectionModel(),stripeRows:true,view:new Ext.grid.GridView({forceFit:true,autoFill:true,scrollOffset:0})});b.add(f);c.doLayout();f.render();d.load();d.startAutoRefresh(60);var g={destroy:function(){d.stopAutoRefresh()}};f.on("rowdblclick",function(l,m){var o=l.getStore().getAt(m).data.name;var k=l.getStore().getAt(m).data.value;var j=false;if(k.match("tick.png")){j="Stop"}else{if(k.match("cross.png")){j="Start"}}if(j){h(o,j)}});function h(l,k){var n;var o;var j;switch(l){case"Notifications Enabled":k=(k=="Start")?"Enable":"Disable";j=" notifications?";n="_NOTIFICATIONS";break;case"Active Service Checks Enabled":j=" executing active service checks?";n="_EXECUTING_SVC_CHECKS";break;case"Passive Service Checks Enabled":j=" accepting passive service checks?";n="_ACCEPTING_PASSIVE_SVC_CHECKS";break;case"Active Host Checks Enabled":j=" executing active host checks?";n="_EXECUTING_HOST_CHECKS";break;case"Passive Host Checks Enabled":j=" accepting passive host checks?";n="_ACCEPTING_PASSIVE_HOST_CHECKS";break;case"Event Handlers Enabled":k=(k=="Start")?"Enable":"Disable";j=" accepting passive host checks?";n="_EVENT_HANDLERS";break;case"Flap Detection Enabled":k=(k=="Start")?"Enable":"Disable";j=" flap detection?";n="_FLAP_DETECTION";break;case"Processing Performance Data":k=(k=="Start")?"Enable":"Disable";j=" processing performance data?";n="_PERFORMANCE_DATA";break;case"Obsess Over Services":j=" obsessing over services?";n="_OBSESSING_OVER_SVC_CHECKS";break;case"Obsess Over Hosts":j=" obsessing over hosts?";n="_OBSESSING_OVER_HOST_CHECKS";break}n=k.toUpperCase()+n;o=k+j;Ext.Msg.show({title:"Confirm",msg:o,buttons:Ext.Msg.YESNO,fn:function(m){if(m=="yes"){npc.aPost({module:"nagios",action:"command",p_command:n})}},animEl:"elId",icon:Ext.MessageBox.QUESTION})}};npc.n2c=function(){var l=Ext.grid;var f;var g=[];var j=Ext.getCmp("centerTabPanel");var d=Ext.getCmp("n2c-panel");var e=new l.CheckboxSelectionModel();var i=new Ext.data.JsonStore({url:"npc.php?module=sync&action=listHostgroups",totalProperty:"totalCount",root:"data",fields:["alias","members","create_graphs","template"],autoload:true});var o=new Ext.data.JsonStore({url:"npc.php?module=cacti&action=getHostTemplates",totalProperty:"totalCount",root:"data",id:"id",fields:["id","name"],autoload:true});o.load();var m=new Ext.grid.ColumnModel([e,{header:"Hostgroup",dataIndex:"alias",width:150},{header:"Hosts",dataIndex:"members",align:"center",width:40},{header:"Template",dataIndex:"template",renderer:n,width:150,editor:new Ext.form.ComboBox({triggerAction:"all",name:"template",valueField:"id",displayField:"name",editable:false,autoWidth:true,emptyText:"Select a template...",store:o,lazyRender:true,listClass:"x-combo-list-small"})}]);var b=new Ext.grid.EditorGridPanel({store:i,border:false,cm:m,sm:e,width:400,autoHeight:true,autoExpandColumn:"template",frame:false,clicksToEdit:1,view:new Ext.grid.GridView({forceFit:true,emptyText:"No hosts.",autoFill:true}),tbar:[{text:"Import",tooltip:"Import the selected hostgroups with the selected template.",iconCls:"add",handler:function(){var p=Ext.getCmp("n2c-results");if(p){panel.remove(p,true)}c(e.getSelections())}}],listeners:{cellclick:function(u,t,p,q){if(u.getColumnModel().getDataIndex(p)=="create_graphs"&&q.getTarget(".checkbox",1)){var s=u.getStore().getAt(t);s.set("create_graphs",!s.get("create_graphs"))}}}});if(d){j.setActiveTab(d)}else{j.add({title:"N2C",closable:true,height:400,width:600,deferredRender:false,layoutOnTabChange:true,defaults:{autoScroll:true},items:[new Ext.TabPanel({id:"n2c-panel",style:"padding:5px 0 5px 5px",activeTab:0,autoHeight:true,autoWidth:true,plain:true,deferredRender:false,defaults:{autoScroll:true},items:[{title:"Import Hosts",id:"n2c-import",layout:"fit",items:[b]}]})]}).show();j.doLayout();j.setActiveTab(d)}b.render();i.load();function a(q,s,p){if(typeof q=="string"){q=true;p.set("create_graphs",true)}return["<img ",'class="checkbox" ','src="js/ext/resources/images/default/menu/',q?"checked.gif":"unchecked.gif",'"/>'].join("")}function n(p){if(p){return String.format("{0}",o.getById(p).get("name"))}}function h(p){f=Ext.MessageBox.progress("Import Progress");g=[];if(!!p.length){var t=p.length;var q=1;var v;var s=new Date();var u=s.getTime();(function(){var y,w=arguments.callee;if(y=p.shift()){if(!y.template){return(Ext.Msg.alert("Error","You must choose a template."))}v=(q/t);f.updateProgress(v,"Importing host "+q+" of "+t);Ext.Ajax.request({method:"GET",timeout:10000,url:"npc.php",params:{module:"sync",action:"import",p_host_object_id:y.host_object_id,p_description:y.display_name,p_ip:y.address,p_template_id:y.template,p_create_graphs:y.create_graphs,p_cache_id:u},success:function(z){r=z.responseText;g[q-1]=r.split("|");q++;setTimeout(w,1)}})}else{k()}})()}}function k(){f.hide();function t(v){var u;if(v==0){return""}else{return String.format('<p align="center"><img src="images/icons/tick.png"></p>')}}var s=new Ext.data.SimpleStore({fields:[{name:"host"},{name:"imported",type:"int"},{name:"mapped",type:"int"},{name:"message"}]});var q=new Ext.grid.ColumnModel([{header:"Host",dataIndex:"host",sortable:true,width:100},{header:"Imported",dataIndex:"imported",renderer:t,width:45},{header:"Mapped",dataIndex:"mapped",renderer:t,width:45},{header:"Message",dataIndex:"message",width:300}]);var p=new Ext.grid.GridPanel({id:"n2cResultsGrid",store:s,border:false,cm:q,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),view:new Ext.grid.GridView({forceFit:true,autoFill:true}),stripeRows:true,autoScroll:true,height:600,width:600});Ext.getCmp("n2c-panel").add({id:"n2c-results",title:"Import Results",deferredRender:false,layout:"fit",closable:true,items:[p]}).show();j.doLayout();Ext.getCmp("n2c-panel").setActiveTab(Ext.getCmp("n2c-results"));p.render();s.loadData(g)}function c(t){var q=new Object();for(var p=0;p<t.length;p++){q[p]={alias:t[p].data.alias,template:t[p].data.template,create_graphs:t[p].data.create_graphs}}var u=Ext.util.JSON.encode(q);Ext.Ajax.request({url:"npc.php",params:{module:"sync",action:"getHosts",p_data:u},callback:function(z,w,y){var v=Ext.util.JSON.decode(y.responseText);if(v.msg){Ext.Msg.alert("Error",v.msg);return}if(!v.length){return(Ext.Msg.alert("Error","There are no hosts available for import in the selected hostgroup."))}h(v)}})}b.on("afteredit",function(w){if(w){var t=w.grid;var q=w.record;var p=t.getColumnModel();var u=p.getCellEditor(w.column,w.row);var s=u.getValue();if(u.field.hiddenField){var s=u.field.hiddenField.value;q.set("selected",s)}}})};npc.downtime=function(){var v="Scheduled Downtime";var e="downtime-tab";npc.addCenterNestedTab(e,v);var d=Ext.getCmp("centerTabPanel");var u=e+"-inner-panel";var c=Ext.getCmp(u);var b=Ext.getCmp(c);if(b){c.setActiveTab(b);return}else{c.add({id:"host-downtime-tab",title:"Hosts",height:600,layout:"fit",deferredRender:false,closable:false});c.add({id:"service-downtime-tab",title:"Services",height:600,layout:"fit",deferredRender:false,closable:false});c.show();c.setActiveTab(0)}function m(y,A,z){return String.format("[{0}] - {1}",z.data.host_name,z.data.service_description)}var f=new Ext.data.GroupingStore({url:"npc.php?module=downtime&action=getHostDowntime",autoload:true,sortInfo:{field:"host_name",direction:"ASC"},reader:new Ext.data.JsonReader({totalProperty:"totalCount",root:"data"},[{name:"entry_time",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"scheduled_start_time",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"scheduled_end_time",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"object_id",type:"int"},"host_name","author_name","comment_data"]),groupField:"host_name"});var w=new Ext.grid.ColumnModel([{header:"Host Name",dataIndex:"host_name",hidden:true,width:120},{header:"Entry Time",dataIndex:"entry_time",renderer:npc.formatDate,width:120},{header:"Start Time",dataIndex:"scheduled_start_time",renderer:npc.formatDate,width:120},{header:"End Time",dataIndex:"scheduled_end_time",renderer:npc.formatDate,width:120},{header:"User",dataIndex:"author_name",width:100},{header:"Comment",dataIndex:"comment_data",width:400}]);var n="downtime-hdGrid";var h=Ext.state.Manager.get(n);var t=(h&&h.rows)?h.rows:15;var k=(h&&h.refresh)?h.refresh:60;var p=new Ext.grid.GridPanel({id:n,height:800,layout:"fit",autoScroll:true,store:f,cm:w,autoExpandColumn:"comment_data",stripeRows:true,listeners:{beforestatesave:function(z,y){y.rows=t;y.refresh=k;Ext.state.Manager.set(n,y);return false}},view:new Ext.grid.GroupingView({forceFit:true,autoFill:true,hideGroupedColumn:true,enableGroupingMenu:false,showGroupName:false,enableNoGroups:true,emptyText:"No scheduled downtime.",groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "Comments" : "Comment"]})'}),bbar:new Ext.PagingToolbar({pageSize:t,store:f,displayInfo:true,items:npc.setRefreshCombo(n,f,h),plugins:new Ext.ux.Andrie.pPageSize({gridId:n})})});var l=new Ext.data.GroupingStore({url:"npc.php?module=downtime&action=getServiceDowntime&p_id=",autoload:true,sortInfo:{field:"host_name",direction:"ASC"},reader:new Ext.data.JsonReader({totalProperty:"totalCount",root:"data"},[{name:"entry_time",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"scheduled_start_time",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"scheduled_end_time",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"object_id",type:"int"},"host_name","service_description","author_name","comment_data"]),groupField:"object_id"});var q=new Ext.grid.ColumnModel([{header:"Host Name",dataIndex:"host_name",hidden:true},{header:"Service",dataIndex:"object_id",renderer:m,hidden:true},{header:"Entry Time",dataIndex:"entry_time",renderer:npc.formatDate,width:120},{header:"Start Time",dataIndex:"scheduled_start_time",renderer:npc.formatDate,width:120},{header:"End Time",dataIndex:"scheduled_end_time",renderer:npc.formatDate,width:120},{header:"User",dataIndex:"author_name",width:100},{header:"Comment",dataIndex:"comment_data",width:400}]);var a="downtime-sdGrid";var g=Ext.state.Manager.get(a);var s=(g&&g.rows)?g.rows:15;var i=(g&&g.refresh)?g.refresh:60;var j=new Ext.grid.GridPanel({id:a,height:800,layout:"fit",autoScroll:true,store:l,cm:q,autoExpandColumn:"comment_data",stripeRows:true,listeners:{beforestatesave:function(z,y){y.rows=s;y.refresh=i;Ext.state.Manager.set(a,y);return false}},view:new Ext.grid.GroupingView({forceFit:true,autoFill:true,hideGroupedColumn:true,enableGroupingMenu:false,showGroupName:false,enableNoGroups:true,emptyText:"No scheduled downtime.",groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "Comments" : "Comment"]})'}),bbar:new Ext.PagingToolbar({pageSize:s,store:l,displayInfo:true,items:npc.setRefreshCombo(a,l,g),plugins:new Ext.ux.Andrie.pPageSize({gridId:a})})});Ext.getCmp("host-downtime-tab").add(p);Ext.getCmp("service-downtime-tab").add(j);d.doLayout();p.render();j.render();p.store.load({params:{start:0,limit:t}});j.store.load({params:{start:0,limit:s}});f.startAutoRefresh(k);l.startAutoRefresh(i);var o={destroy:function(){f.stopAutoRefresh();l.stopAutoRefresh()}};Ext.getCmp("host-downtime-tab").addListener(o);Ext.getCmp("service-downtime-tab").addListener(o);p.on("rowdblclick",npc.hostGridClick);j.on("rowdblclick",npc.serviceGridClick)};npc.commandNote={xtype:"panel",html:'<br /><span style="font-size:10px;"><b>Note:</b> It may take a while before Nagios processes the command.</span>',width:400};npc.ackProblem=function(f,i,e){var b="ACKNOWLEDGE_"+f.toUpperCase()+"_PROBLEM";var h="Acknowledge Host Problem - "+i;if(f=="svc"){h="Acknowledge Service Problem - "+i+": "+e}var d={name:"p_host_name",value:i,xtype:"hidden"};var g={name:"p_service_description",value:e,xtype:"hidden"};var a=new Ext.FormPanel({labelWidth:110,url:"npc.php?module=nagios&action=command",frame:true,bodyStyle:"padding:5px 5px 0",width:550,defaults:{width:150},defaultType:"textfield",items:[{name:"p_command",value:b,xtype:"hidden"},d,g,{fieldLabel:"Sticky",name:"p_sticky",xtype:"xcheckbox",labelStyle:"cursor: help;",tooltipText:"Disables notifications until the host recovers.",listeners:{render:function(j){npc.setFormFieldTooltip(j)}},checked:true},{fieldLabel:"Send Notification",name:"p_notify",xtype:"xcheckbox",labelStyle:"cursor: help;",tooltipText:"Send a notification about the acknowledgement to contacts for this service.",listeners:{render:function(j){npc.setFormFieldTooltip(j)}},checked:true},{fieldLabel:"Persistent",name:"p_persistent",xtype:"xcheckbox",labelStyle:"cursor: help;",tooltipText:"Keep the service comment even after the acknowledgement is removed.",listeners:{render:function(j){npc.setFormFieldTooltip(j)}},checked:false},{name:"p_author",value:npc.params.userName,xtype:"hidden"},{fieldLabel:"Comment",name:"p_comment",xtype:"htmleditor",height:150,width:500},{xtype:"panel",html:'<br /><span style="font-size:10px;"><b>Note:</b> It may take a while before Nagios processes this command.</span>',width:400}],buttons:npc.cmdFormButtons});var c=new Ext.Window({title:h,layout:"fit",modal:true,closable:true,width:680,height:375,bodyStyle:"padding:5px;",items:a});c.show()};npc.addComment=function(c,e,a){var f="ADD_"+c.toUpperCase()+"_COMMENT";var b={name:"p_host_name",value:e,xtype:"hidden"};if(typeof e=="undefined"){b.fieldLabel="Host Name";b.xtype="textfield";b.allowBlank=false}var h={name:"p_service_description",value:a,xtype:"hidden"};if(c=="svc"){if(typeof a=="undefined"){h.fieldLabel="Service Description";h.xtype="textfield";h.allowBlank=false}}var d=new Ext.FormPanel({labelWidth:110,url:"npc.php?module=nagios&action=command",frame:true,bodyStyle:"padding:5px 5px 0",width:550,defaults:{width:175},defaultType:"textfield",items:[{name:"p_command",value:f,xtype:"hidden"},b,h,{fieldLabel:"Persistent",name:"p_persistent",xtype:"xcheckbox",labelStyle:"cursor: help;",tooltipText:"Persists the comment across Nagios restarts.",listeners:{render:function(i){npc.setFormFieldTooltip(i)}},checked:true},{name:"p_author",value:npc.params.userName,xtype:"hidden"},{fieldLabel:"Comment",name:"p_comment",xtype:"htmleditor",height:200,width:500},{xtype:"panel",html:'<br /><span style="font-size:10px;"><b>Note:</b> It may take a while before Nagios processes the comment.</span>',width:400}],buttons:npc.cmdFormButtons});var g=new Ext.Window({title:"New Comment",layout:"fit",modal:true,closable:true,width:680,height:400,bodyStyle:"padding:5px;",items:d});g.show()};npc.sendCustomNotification=function(c,e,a){var f="SEND_CUSTOM_"+c.toUpperCase()+"_NOTIFICATION";var b={name:"p_host_name",value:e,xtype:"hidden"};if(typeof e=="undefined"){b.fieldLabel="Host Name";b.xtype="textfield";b.allowBlank=false}var h={name:"p_service_description",value:a,xtype:"hidden"};if(c=="svc"){if(typeof a=="undefined"){h.fieldLabel="Service Description";h.xtype="textfield";h.allowBlank=false}}var d=new Ext.FormPanel({labelWidth:110,url:"npc.php?module=nagios&action=command",frame:true,bodyStyle:"padding:5px 5px 0",width:550,defaults:{width:175},defaultType:"textfield",items:[{name:"p_command",value:f,xtype:"hidden"},b,h,{name:"p_options",value:0,xtype:"hidden"},{fieldLabel:"Forced",name:"p_force_notification",xtype:"xcheckbox",labelStyle:"cursor: help;",tooltipText:"Selecting the Forced option will force the notification to be sent out, regardless of the time restrictions, whether or not notifications are enabled, etc.",listeners:{check:function(){var i=2;var j=parseInt(d.form.getValues().p_options);if(this.checked){j=j+i}else{j=j-i}d.form.setValues({p_options:j})},render:function(i){npc.setFormFieldTooltip(i)}},checked:false},{fieldLabel:"Broadcast",name:"p_broadcast_notification",xtype:"xcheckbox",labelStyle:"cursor: help;",tooltipText:"Selecting the Broadcast option causes the notification to be sent out to all normal (non-escalated) and escalated contacts.",listeners:{check:function(){var i=1;var j=parseInt(d.form.getValues().p_options);if(this.checked){j=j+i}else{j=j-i}d.form.setValues({p_options:j})},render:function(i){npc.setFormFieldTooltip(i)}},checked:false},{name:"p_author",value:npc.params.userName,xtype:"hidden"},{fieldLabel:"Comment",name:"p_comment",xtype:"htmleditor",height:200,width:500},{xtype:"panel",html:'<br /><span style="font-size:10px;"><b>Note:</b> It may take a while before Nagios processes the command.</span>',width:400}],buttons:npc.cmdFormButtons});var g=new Ext.Window({title:"Send Custom Notification",layout:"fit",modal:true,closable:true,width:680,height:400,bodyStyle:"padding:5px;",items:d});g.show()};npc.scheduleNextCheck=function(g,l,f){var c="SCHEDULE_FORCED_"+g.toUpperCase()+"_CHECK";var i="Schedule Check";if(g=="host_svc"){i="Schedule check of all services on "+l;c=c+"S"}var b=new Date();var k=b.format("Y-m-d H:i:s");var j=b.format("U");var e={name:"p_host_name",value:l,xtype:"hidden"};if(typeof l=="undefined"){e.fieldLabel="Host Name";e.xtype="textfield";e.allowBlank=false}var h={name:"p_service_description",value:f,xtype:"hidden"};if(g=="svc"&&typeof f=="undefined"){h.fieldLabel="Service Description";h.xtype="textfield";h.allowBlank=false}var a=new Ext.FormPanel({labelWidth:100,url:"npc.php?module=nagios&action=command",frame:true,bodyStyle:"padding:5px 5px 0",width:350,defaults:{width:175},defaultType:"textfield",items:[{name:"p_command",value:c,xtype:"hidden"},e,h,{fieldLabel:"Force",name:"p_force_notification",xtype:"xcheckbox",checked:true,labelStyle:"cursor: help;",tooltipText:"Force a check of the service regardless of what time the scheduled check occurs and whether or not checks are enabled for the service.",listeners:{change:function(){var m=parseInt(a.form.getValues().p_cmd);if(this.checked){m=m.replace(/SCHEDULE_/,"SCHEDULE_FORCED_")}else{m=m.replace(/FORCED_/,"")}a.form.setValues({p_cmd:m})},render:function(m){npc.setFormFieldTooltip(m)}}},{fieldLabel:"Check Time",name:"p_date",value:k,labelStyle:"cursor: help;",tooltipText:"The date/time must be in the format YYYY-MM-DD HH:MM:SS.",listeners:{change:function(){var m=a.form.getValues().p_date;var n=new Date(m.replace(/-/g," "));a.form.setValues({p_check_time:n.format("U")})},render:function(m){npc.setFormFieldTooltip(m)}},xtype:"textfield"},{name:"p_check_time",value:j,xtype:"hidden"},{xtype:"panel",html:'<br /><span style="font-size:10px;"><b>Note:</b> It may take a while before Nagios processes the command.</span>',width:400}],buttons:npc.cmdFormButtons});var d=new Ext.Window({title:i,layout:"fit",modal:true,closable:true,width:400,height:200,bodyStyle:"padding:5px;",items:a});d.show()};npc.submitPassiveCheckResult=function(g,i,f){var b="PROCESS_"+g.toUpperCase()+"_CHECK_RESULT";var e={name:"p_host_name",value:i,xtype:"hidden"};var c=[["UP",0],["DOWN",1],["UNREACHABLE",2],["PENDING",-1]];if(typeof i=="undefined"){e.fieldLabel="Host Name";e.xtype="textfield";e.allowBlank=false}var h={name:"p_service_description",value:f,xtype:"hidden"};if(g=="service"){c=[["OK",0],["WARNING",1],["CRITICAL",2],["UNKNOWN",3],["PENDING",-1]];if(typeof f=="undefined"){h.fieldLabel="Service Description";h.xtype="textfield";h.allowBlank=false}}var a=new Ext.FormPanel({labelWidth:110,url:"npc.php?module=nagios&action=command",frame:true,bodyStyle:"padding:5px 5px 0",width:500,defaultType:"textfield",items:[{name:"p_command",value:b,xtype:"hidden"},e,h,new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["name","value"],data:c}),fieldLabel:"Check Result",hiddenName:"p_return_code",displayField:"name",valueField:"value",forceSelection:true,mode:"local",editable:false,width:100,allowBlank:false,emptyText:"",triggerAction:"all",selectOnFocus:true}),{fieldLabel:"Check Output",name:"p_plugin_output",xtype:"textfield",allowBlank:false,width:350,labelStyle:"cursor: help;",tooltipText:"The check results for this passive check.",listeners:{render:function(j){npc.setFormFieldTooltip(j)}}},{xtype:"panel",html:'<br /><span style="font-size:10px;"><b>Note:</b> It may take a while before Nagios processes the command.</span>',width:400}],buttons:npc.cmdFormButtons});var d=new Ext.Window({title:"Submit Passive Check Result",layout:"fit",modal:true,closable:true,width:550,height:200,bodyStyle:"padding:5px;",items:a});d.show()};npc.scheduleHostgroupDowntime=function(q,m){var d="SCHEDULE_HOSTGROUP_"+m+"_DOWNTIME";var l=(m=="HOST")?"Hosts":"Services";var p="Schedule Downtime for All "+l+" in Hostgroup - "+q;var k=new Date();var h=new Date();var c=k.format("Y-m-d H:i:s");h.setHours(h.getHours()+2);var g=h.format("Y-m-d H:i:s");var f=k.format("U");var a=h.format("U");var j={name:"p_hostgroup_name",value:q,xtype:"hidden"};var o=false;var e="Schedule Hosts";if(m=="HOST"){o=true;e=""}var n={name:"p_hosts",xtype:"hidden",value:0};if(m=="SVC"){n.fieldLabel="Schedule Hosts";n.xtype="xcheckbox";n.labelStyle="cursor: help;";n.tooltipText="Check to schedule Downtime For Hosts Too.";n.listeners={render:function(s){npc.setFormFieldTooltip(s)}};n.checked=false}var b=new Ext.FormPanel({labelWidth:110,url:"npc.php?module=nagios&action=command",frame:true,bodyStyle:"padding:5px 5px 0",width:550,defaultType:"textfield",items:[{name:"p_command",value:d,xtype:"hidden"},j,{name:"p_author",value:npc.params.userName,xtype:"hidden"},{fieldLabel:"Comment",name:"p_comment",xtype:"htmleditor",height:150,width:500},new Ext.form.ComboBox({store:new Ext.data.JsonStore({url:"npc.php?module=downtime&action=getTriggeredByCombo",totalProperty:"totalCount",root:"data",fields:["name",{name:"value",type:"int"}],autoload:true}),fieldLabel:"Triggered By",hiddenName:"p_trigger_id",displayField:"name",valueField:"value",forceSelection:true,labelStyle:"cursor: help;",tooltipText:"Trigger the start of the downtime by the start of some other scheduled host or service downtime.",listeners:{expand:function(s){s.list.setWidth("auto");s.innerList.setWidth("auto")},render:function(s){npc.setFormFieldTooltip(s)}},mode:"remote",editable:false,width:400,allowBlank:true,emptyText:"",triggerAction:"all",selectOnFocus:true}),{name:"p_start_time",value:f,xtype:"hidden"},{name:"p_end_time",value:a,xtype:"hidden"},{fieldLabel:"Start Time",name:"p_stime",value:c,labelStyle:"cursor: help;",tooltipText:"Start time must be in the format 'YYYY-MM-DD HH:MM:SS'.",listeners:{change:function(t){var s=b.form.getValues().p_stime;var u=new Date(s.replace(/-/g," "));b.form.setValues({p_start_time:u.format("U")})},render:function(s){npc.setFormFieldTooltip(s)}},xtype:"textfield",allowBlank:false},{fieldLabel:"End Time",name:"p_etime",value:g,labelStyle:"cursor: help;",tooltipText:"End time must be in the format 'YYYY-MM-DD HH:MM:SS'.",listeners:{change:function(t){var s=b.form.getValues().p_etime;var u=new Date(s.replace(/-/g," "));b.form.setValues({p_end_time:u.format("U")})},render:function(s){npc.setFormFieldTooltip(s)}},xtype:"textfield",allowBlank:false},new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["name","value"],data:[["Fixed",1],["Flexible",0]]}),fieldLabel:"Type",hiddenName:"p_fixed",value:1,displayField:"name",valueField:"value",labelStyle:"cursor: help;",tooltipText:"Flexible downtime starts when the service enters a non-OK state (sometime between the start and end times you specified) and lasts as long as the duration of time you enter. Fixed downtime is starts and ands strictly based on start and end times provided. The duration field does not apply for fixed downtime.",listeners:{render:function(s){npc.setFormFieldTooltip(s)},change:function(){var s=parseInt(b.form.getValues().p_minutes);var t=s?(s*60):0;b.form.setValues({p_duration:t})}},forceSelection:true,mode:"local",editable:false,width:100,allowBlank:false,triggerAction:"all",selectOnFocus:true}),{name:"p_duration",value:0,xtype:"hidden"},{fieldLabel:"Duration (minutes)",name:"p_minutes",value:120,width:50,tooltipText:"Duration is only required when selecting flexible downtime.",listeners:{change:function(){var s=parseInt(b.form.getValues().p_minutes);var t=s?(s*60):0;b.form.setValues({p_duration:t})}}},n,],buttons:npc.cmdFormButtons});var i=new Ext.Window({title:p,layout:"fit",modal:true,closable:true,width:700,height:450,bodyStyle:"padding:5px;",items:b});i.show()};npc.scheduleDowntime=function(m,p,j){var d="SCHEDULE_"+m.toUpperCase()+"_DOWNTIME";var o="Schedule Host Downtime - "+p;if(m=="svc"){o="Schedule Service Downtime - "+p+": "+j}var l=new Date();var g=new Date();var c=l.format("Y-m-d H:i:s");g.setHours(g.getHours()+2);var f=g.format("Y-m-d H:i:s");var e=l.format("U");var a=g.format("U");var i={name:"p_host_name",value:p,xtype:"hidden"};if(typeof p=="undefined"){i.fieldLabel="Host Name";i.xtype="textfield";i.allowBlank=false}var n={name:"p_service_description",value:j,xtype:"hidden"};if(m=="svc"&&typeof j=="undefined"){n.fieldLabel="Service Description";n.xtype="textfield";n.allowBlank=false}var b=new Ext.FormPanel({labelWidth:110,url:"npc.php?module=nagios&action=command",frame:true,bodyStyle:"padding:5px 5px 0",width:550,defaultType:"textfield",items:[{name:"p_command",value:d,xtype:"hidden"},i,n,{name:"p_author",value:npc.params.userName,xtype:"hidden"},{fieldLabel:"Comment",name:"p_comment",xtype:"htmleditor",height:150,width:500},new Ext.form.ComboBox({store:new Ext.data.JsonStore({url:"npc.php?module=downtime&action=getTriggeredByCombo",totalProperty:"totalCount",root:"data",fields:["name",{name:"value",type:"int"}],autoload:true}),fieldLabel:"Triggered By",hiddenName:"p_trigger_id",displayField:"name",valueField:"value",forceSelection:true,labelStyle:"cursor: help;",tooltipText:"Trigger the start of the downtime by the start of some other scheduled host or service downtime.",listeners:{expand:function(q){q.list.setWidth("auto");q.innerList.setWidth("auto")},render:function(q){npc.setFormFieldTooltip(q)}},mode:"remote",editable:false,width:400,allowBlank:true,emptyText:"",triggerAction:"all",selectOnFocus:true}),{name:"p_start_time",value:e,xtype:"hidden"},{name:"p_end_time",value:a,xtype:"hidden"},{fieldLabel:"Start Time",name:"p_stime",value:c,labelStyle:"cursor: help;",tooltipText:"Start time must be in the format 'YYYY-MM-DD HH:MM:SS'.",listeners:{change:function(s){var q=b.form.getValues().p_stime;var t=new Date(q.replace(/-/g," "));b.form.setValues({p_start_time:t.format("U")})},render:function(q){npc.setFormFieldTooltip(q)}},xtype:"textfield",allowBlank:false},{fieldLabel:"End Time",name:"p_etime",value:f,labelStyle:"cursor: help;",tooltipText:"End time must be in the format 'YYYY-MM-DD HH:MM:SS'.",listeners:{change:function(s){var q=b.form.getValues().p_etime;var t=new Date(q.replace(/-/g," "));b.form.setValues({p_end_time:t.format("U")})},render:function(q){npc.setFormFieldTooltip(q)}},xtype:"textfield",allowBlank:false},new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["name","value"],data:[["Fixed",1],["Flexible",0]]}),fieldLabel:"Type",hiddenName:"p_fixed",value:1,displayField:"name",valueField:"value",labelStyle:"cursor: help;",tooltipText:"Flexible downtime starts when the service enters a non-OK state (sometime between the start and end times you specified) and lasts as long as the duration of time you enter. Fixed downtime is starts and ands strictly based on start and end times provided. The duration field does not apply for fixed downtime.",listeners:{render:function(q){npc.setFormFieldTooltip(q)},change:function(){var q=parseInt(b.form.getValues().p_minutes);var s=q?(q*60):0;b.form.setValues({p_duration:s})}},forceSelection:true,mode:"local",editable:false,width:100,allowBlank:false,triggerAction:"all",selectOnFocus:true}),{name:"p_duration",value:0,xtype:"hidden"},{fieldLabel:"Duration (minutes)",name:"p_minutes",value:120,width:50,listeners:{change:function(t){var q=parseInt(b.form.getValues().p_minutes);var s=q?(q*60):0;b.form.setValues({p_duration:s})}}}],buttons:npc.cmdFormButtons});if(m=="host"){var k=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["name","value"],data:[["Do nothing with child hosts",0],["Schedule triggered downtime for all child hosts",1],["Schedule non-triggered downtime for all child hosts",2]]}),fieldLabel:"Child Hosts",hiddenName:"p_child",value:0,displayField:"name",valueField:"value",forceSelection:true,listeners:{change:function(s){var q=parseInt(b.form.getValues().p_child);if(q==1){b.form.setValues({p_cmd:"SCHEDULE_AND_PROPAGATE_TRIGGERED_HOST_DOWNTIME"})}if(q==2){b.form.setValues({p_cmd:"SCHEDULE_AND_PROPAGATE_HOST_DOWNTIME"})}}},mode:"local",editable:false,width:300,allowBlank:false,triggerAction:"all",selectOnFocus:true});b.items.add(k)}var h=new Ext.Window({title:o,layout:"fit",modal:true,closable:true,width:700,height:450,bodyStyle:"padding:5px;",items:b});h.show()};npc.delayNextNotification=function(b,d,a){var e="DELAY_"+b.toUpperCase()+"_NOTIFICATION";var c=new Ext.FormPanel({labelWidth:110,url:"npc.php?module=nagios&action=command",frame:true,bodyStyle:"padding:5px 5px 0",width:250,defaults:{width:50},defaultType:"textfield",items:[{name:"p_command",value:e,xtype:"hidden"},{name:"p_host_name",value:d,xtype:"hidden"},{name:"p_service_description",value:a,xtype:"hidden"},{fieldLabel:"Delay (minutes)",name:"p_notification_time",xtype:"textfield",labelStyle:"cursor: help;",tooltipText:"The number of minutes from now that the notification should be delayed.",allowBlank:false,listeners:{render:function(g){npc.setFormFieldTooltip(g)}},checked:true},{xtype:"panel",html:'<br /><span style="font-size:10px;"><b>Note:</b> It may take a while before Nagios processes this command.</span>',width:400}],buttons:npc.cmdFormButtons});var f=new Ext.Window({title:"Delay Next Notification",layout:"fit",modal:true,closable:true,width:400,height:200,bodyStyle:"padding:5px;",items:c});f.show()};npc.reporting=function(g,b){var k="Reporting";var c=g.replace(/[-' ']/g,"")+"-tab";var a="reporting-tab";npc.addCenterNestedTab(a,k);var e=Ext.getCmp("centerTabPanel");var j=a+"-inner-panel";var f=Ext.getCmp(j);var h=Ext.getCmp(j);var d=(Ext.getCmp(c));if(!d){h.add({title:g,id:c,layout:"fit",height:600,closable:true,scripts:true,items:[new Ext.ux.IFrameComponent({url:b})]}).show();h.doLayout();d=(Ext.getCmp(c))}h.setActiveTab(d);var i={destroy:function(){if(!h.items.length){e.remove(a,true)}}};d.addListener(i)};npc.hostgroupGrid=function(m,s,b){s=(typeof s=="undefined")?"Hostgroup Grid":s;m=(typeof m=="undefined")?"hostgroupGrid-tab":m;b=(typeof b=="undefined")?"":"&p_id="+b;var f="npc.php?module=hostgroups&action=getHosts"+b;var l=m+"-grid";var g=Ext.state.Manager.get(l);var p=(g&&g.rows)?g.rows:15;var e=(g&&g.refresh)?g.refresh:60;var j="hosts-tab";npc.addCenterNestedTab(j,"Hosts");var h=Ext.getCmp("centerTabPanel");var q="hosts-tab-inner-panel";var d=Ext.getCmp(q);var c=Ext.getCmp(m);if(c){d.setActiveTab(c);return}else{d.add({id:m,title:s,height:600,layout:"fit",closable:true}).show();d.setActiveTab(c);c=Ext.getCmp(m)}function o(v,u,t){return String.format("{0}/{1}",v,t.data.max_check_attempts)}var i=new Ext.data.GroupingStore({url:f,autoload:true,sortInfo:{field:"host_name",direction:"ASC"},reader:new Ext.data.JsonReader({totalProperty:"totalCount",root:"data"},[{name:"hostgroup_id",type:"int"},{name:"instance_id",type:"int"},{name:"config_type",type:"int"},{name:"hostgroup_object_id",type:"int"},"alias","instance_name","hostgroup_name",{name:"hoststatus_id",type:"int"},{name:"host_object_id",type:"int"},{name:"current_state",type:"int"},"output","host_name"]),groupField:"alias"});var k=new Ext.grid.ColumnModel([{header:"Host",dataIndex:"host_name",sortable:true,width:75},{header:"Status",dataIndex:"current_state",align:"center",renderer:npc.hostStatusImage,width:40},{header:"Plugin Output",dataIndex:"output",width:400},{header:"Host Group",dataIndex:"alias",hidden:true,width:75}]);var a=new Ext.grid.GridPanel({id:l,height:800,layout:"fit",autoExpandColumn:"output",autoScroll:true,store:i,cm:k,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),stripeRows:true,listeners:{beforestatesave:function(u,t){t.rows=p;t.refresh=e;Ext.state.Manager.set(l,t);return false}},view:new Ext.grid.GroupingView({forceFit:true,autoFill:true,hideGroupedColumn:true,enableGroupingMenu:false,enableNoGroups:true,emptyText:"No hostgroups.",groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "Hosts" : "Host"]})'}),bbar:new Ext.PagingToolbar({pageSize:p,store:i,displayInfo:true,items:npc.setRefreshCombo(l,i,g),plugins:new Ext.ux.Andrie.pPageSize({gridId:l})}),plugins:[new Ext.ux.grid.Search({mode:"remote",iconCls:false,disableIndexes:["current_state"]})]});c.add(a);h.doLayout();a.render();a.store.load({params:{start:0,limit:p}});i.startAutoRefresh(e);var n={destroy:function(){i.stopAutoRefresh();if(!d.items.length){h.remove(j,true)}}};c.addListener(n);a.on("rowdblclick",npc.hostGridClick);a.on("rowcontextmenu",npc.hostContextMenu)};npc.hostsGrid=Ext.extend(Ext.ux.grid.livegrid.GridPanel,{filter:"any",initComponent:function(){var a=new Ext.ux.grid.livegrid.JsonReader({root:"response.value.items",versionProperty:"response.value.version",totalProperty:"response.value.total_count",id:"host_object_id"},[{name:"host_object_id",type:"int",sortType:"int"},{name:"host_name",sortType:"string"},{name:"alias",sortType:"string"},{name:"address",sortType:"string"},{name:"comment",sortType:"string"},{name:"notes",sortType:"string"},{name:"notes_url",sortType:"string"},{name:"action_url",sortType:"string"},{name:"icon_image",sortType:"string"},{name:"icon_image_alt",sortType:"string"},{name:"service_count",type:"int",sortType:"int"},{name:"current_state",type:"int",sortType:"int"},{name:"current_check_attempt",sortType:"string"},{name:"max_check_attempts",sortType:"string"},{name:"output",sortType:"string"},{name:"acknowledgement",sortType:"string"},{name:"local_graph_id",type:"int",sortType:"int"},{name:"last_check",type:"date",sortType:"date",dateFormat:"Y-m-d H:i:s"},{name:"next_check",type:"date",sortType:"date",dateFormat:"Y-m-d H:i:s"},{name:"last_state_change",type:"date",sortType:"date",dateFormat:"Y-m-d H:i:s"},{name:"problem_has_been_acknowledged",type:"int",sortType:"int"},{name:"notifications_enabled",type:"int",sortType:"int"},{name:"active_checks_enabled",type:"int",sortType:"int"},{name:"passive_checks_enabled",type:"int",sortType:"int"},{name:"is_flapping",type:"int",sortType:"int"}]);this.store=new Ext.ux.grid.livegrid.Store({autoLoad:true,bufferSize:100,reader:a,sortInfo:{field:"host_name",direction:"ASC"},url:"npc.php?module=hosts&action=getHosts&p_state="+this.filter});this.selModel=new Ext.ux.grid.livegrid.RowSelectionModel();this.view=new Ext.ux.grid.livegrid.GridView({nearLimit:30,forceFit:true,autoFill:true,emptyText:"No hosts.",loadMask:{msg:"Please wait..."}});this.bbar=new Ext.ux.grid.livegrid.Toolbar({view:this.view,displayInfo:true});npc.hostsGrid.superclass.initComponent.call(this)}});npc.hosts=function(m,d){var c=m.replace(/[-' ']/g,"")+"-tab";var h=c+"-grid";var b="hosts-tab";npc.addCenterNestedTab(b,"Hosts");var f=Ext.getCmp("centerTabPanel");var l="hosts-tab-inner-panel";var g=Ext.getCmp(l);var e=Ext.getCmp(c);if(e){g.setActiveTab(e);return}else{g.add({id:c,title:m,deferredRender:false,height:600,layout:"fit",closable:true}).show();g.setActiveTab(e);e=Ext.getCmp(c)}function j(s,q,o){return String.format("{0}/{1}",s,o.data.max_check_attempts)}function i(t,s,o){var q="";if(t){q='<img src="images/icons/chart_bar.png">'}return String.format("{0}",q)}var n=new Ext.grid.ColumnModel([{header:"Host",dataIndex:"host_name",sortable:true,renderer:npc.renderHostIcons,width:100},{header:"Alias",dataIndex:"alias",hidden:true,width:100},{header:"Address",dataIndex:"address",hidden:true,width:100},{header:"Status",dataIndex:"current_state",renderer:npc.hostStatusImage,align:"center",width:30},{header:"Graph",dataIndex:"local_graph_id",renderer:i,width:30},{header:"Last Check",dataIndex:"last_check",renderer:npc.formatDate,width:100},{header:"Next Check",dataIndex:"next_check",renderer:npc.formatDate,width:100},{header:"Duration",dataIndex:"last_state_change",hidden:true,renderer:npc.getDuration,width:110},{header:"Attempt",dataIndex:"current_check_attempt",renderer:j,hidden:true,align:"center",width:50},{header:"Services",dataIndex:"service_count",hidden:true,align:"center",width:50},{header:"Plugin Output",dataIndex:"output",width:400}]);var a=new npc.hostsGrid({id:h,height:800,filter:d,enableDragDrop:false,cm:n,stripeRows:true,loadMask:{msg:"Loading..."},plugins:[new Ext.ux.grid.Search({mode:"remote",iconCls:false,disableIndexes:["last_check","next_check","local_graph_id","service_count","last_state_change","current_check_attempt","current_state"]})]});e.add(a);f.doLayout();if(d!="any"){a.store.startAutoRefresh(npc.params.npc_portlet_refresh)}var k={destroy:function(){a.store.stopAutoRefresh();if(!g.items.length){f.remove(b,true)}}};e.addListener(k);a.on("rowdblclick",npc.hostGridClick);a.on("rowcontextmenu",npc.hostContextMenu);a.on("cellclick",function(p,v,q){var o=p.getStore().getAt(v);var u=p.getColumnModel().getDataIndex(q);var s=o.get(u);if(u=="local_graph_id"&&s&&!Ext.getCmp("hostGraph"+s)){var t=new Ext.Window({title:o.data.host_name,id:"hostGraph"+s,layout:"fit",modal:false,closable:true,html:'<img src="'+npc.params.cacti_path+"/graph_image.php?action=view&local_graph_id="+s+'&rra_id=1">',width:600}).show()}})};npc.hostDetail=function(J){var y=(typeof J.data.host_object_id!="undefined")?J.data.host_object_id:J.data.object_id;var H="hostDetail"+y+"-tab";var B=J.data.host_name;var G="hosts-tab";npc.addCenterNestedTab(G,"Hosts");var Z=Ext.getCmp("centerTabPanel");var p="hosts-tab-inner-panel";var T=Ext.getCmp(p);var D=p+"-details";var Q=Ext.getCmp(H);var z=20;var U=new Ext.menu.Menu();U=npc.hostCommandMenu(J.data,U);function o(ad,ac,ab){return String.format("{0}/{1}",ad,ab.data.max_check_attempts)}function W(ac){var ab;switch(ac){case"0":ab="Soft";break;case"1":ab="Hard";break}return String.format("{0}",ab)}function a(ad,ac,ab){return(ad)}function I(ab,ad,ac){return String.format('<img src="images/icons/comment_delete.png">')}if(Q){T.setActiveTab(Q);return}else{T.add({id:H,title:B,height:600,layout:"fit",closable:true,autoScroll:true,containerScroll:true,items:[new Ext.TabPanel({id:D,style:"padding:10px 0 10px 10px",height:600,border:false,plain:true,deferredRender:false,defaults:{autoScroll:true}})]}).show();Z.doLayout();T.setActiveTab(Q);Q=Ext.getCmp(H)}function v(ad,ac){var af;var ag;var ab;switch(ad){case"Active Checks Enabled":ab=" active checks for this host?";af="_HOST_CHECK";break;case"Passive Checks Enabled":ab=" passive checks for this host?";af="_PASSIVE_HOST_CHECKS";break;case"Event Handler Enabled":ab=" event handler for this host?";af="_HOST_EVENT_HANDLER";break;case"Flap Detection Enabled":ab=" flap detection for this host?";af="_HOST_FLAP_DETECTION";break;case"Notifications Enabled":ab=" notifications for this host?";af="_HOST_NOTIFICATIONS";break;case"Obsess Over Host":var ah="Stop";if(ac=="Enable"){ah="Start"}ag=ah+" obsessing over this host?";af=ah.toUpperCase()+"_OBSESSING_OVER_HOST";break}if(ad.match("Enabled")){af=ac.toUpperCase()+af;ag=ac+ab}var ae={module:"nagios",action:"command",p_command:af,p_host_name:J.data.host_name};npc.doCommand(ag,ae)}var X=new Ext.data.JsonStore({url:"npc.php?module=hosts&action=getHosts&p_id="+y,root:"response.value.items",versionProperty:"response.value.version",totalProperty:"response.value.total_count",id:"host_object_id",fields:["host_name","notes_url","perfdata",{name:"host_object_id",type:"int"},{name:"local_graph_id",type:"int"},{name:"current_state",type:"int"},{name:"problem_has_been_acknowledged",type:"int"},{name:"notifications_enabled",type:"int"},{name:"active_checks_enabled",type:"int"},{name:"passive_checks_enabled",type:"int"},{name:"obsess_over_host",type:"int"},{name:"event_handler_enabled",type:"int"},{name:"flap_detection_enabled",type:"int"}]});var j=new Ext.data.JsonStore({url:"npc.php?module=hosts&action=getStateInfo&p_id="+y,totalProperty:"totalCount",root:"data",fields:["name","value"],autoload:true});var w=new Ext.grid.ColumnModel([{header:"Parameter",dataIndex:"name",width:100},{header:"Value",dataIndex:"value",width:300,align:"left"}]);var A=new Ext.grid.GridPanel({title:"Host State Information",height:800,autoWidth:true,store:j,cm:w,autoExpandColumn:"Value",stripeRows:true,tbar:[{text:"Commands",iconCls:"cogAdd",menu:U},"-",{text:"View Graph",iconCls:"chartBar",handler:function(){var ab=X.data.items[0].data.local_graph_id;if(ab){if(!Ext.getCmp("hostGraph"+ab)){var ac=new Ext.Window({title:J.data.host_name,id:"hostGraph"+ab,layout:"fit",modal:false,closable:true,html:'<img src="'+npc.params.cacti_path+"/graph_image.php?action=view&local_graph_id="+ab+'&rra_id=1">',width:640}).show()}}else{npc.mapGraph("hosts",y)}}},"-",{text:"Map Graph",iconCls:"chartBarAdd",handler:function(){npc.mapGraph("hosts",y)}}],view:new Ext.grid.GridView({forceFit:true,autoFill:true,scrollOffset:0})});A.on("rowdblclick",function(ad,ae){var af=ad.getStore().getAt(ae).data.name;var ac=ad.getStore().getAt(ae).data.value;var ab=false;if(ac.match("tick.png")){ab="Disable"}else{if(ac.match("cross.png")){ab="Enable"}}if(ab){v(af,ab)}});var O=new Ext.data.JsonStore({url:"npc.php?module=notifications&action=getNotifications&p_id="+y,totalProperty:"totalCount",root:"data",fields:["state",{name:"start_time",type:"date",dateFormat:"Y-m-d H:i:s"},"output"],autoload:true});var Y=new Ext.grid.ColumnModel([{header:"",dataIndex:"state",width:40,renderer:npc.hostStatusImage},{header:"Date",dataIndex:"start_time",width:120,renderer:npc.formatDate},{header:"Message",dataIndex:"output",width:600}]);var t=H+"-hnGrid";var b=Ext.state.Manager.get(t);var R=(b&&b.rows)?b.rows:15;var k=(b&&b.refresh)?b.refresh:60;var f=new Ext.grid.GridPanel({id:t,title:"Notification History",height:800,layout:"fit",autoScroll:true,store:O,cm:Y,autoExpandColumn:"output",stripeRows:true,listeners:{beforestatesave:function(ac,ab){ab.rows=R;ab.refresh=k;Ext.state.Manager.set(t,ab);return false}},view:new Ext.grid.GridView({forceFit:true,autoFill:true,emptyText:"No notifications."}),bbar:new Ext.PagingToolbar({pageSize:R,store:O,displayInfo:true,items:npc.setRefreshCombo(t,O,b),plugins:new Ext.ux.Andrie.pPageSize({gridId:t})})});var K=new Ext.data.JsonStore({url:"npc.php?module=statehistory&action=getStateHistory&type=2&p_id="+y,totalProperty:"totalCount",root:"data",fields:["state",{name:"state_time",type:"date",dateFormat:"Y-m-d H:i:s"},"state_type","current_check_attempt","max_check_attempts","output"],autoload:true});var E=new Ext.grid.ColumnModel([{header:"",dataIndex:"state",renderer:npc.hostStatusImage,width:40},{header:"Date",dataIndex:"state_time",renderer:npc.formatDate,width:120},{header:"State Type",dataIndex:"state_type",renderer:W,width:80},{header:"Check Attempt",dataIndex:"current_check_attempt",renderer:o,width:100},{header:"Plugin Output",dataIndex:"output",width:500}]);var u=H+"-hhGrid";var N=Ext.state.Manager.get(u);var m=(N&&N.rows)?N.rows:15;var c=(N&&N.refresh)?N.refresh:60;var P=new Ext.grid.GridPanel({id:u,title:"State History",height:800,layout:"fit",autoScroll:true,store:K,cm:E,autoExpandColumn:"output",stripeRows:true,listeners:{beforestatesave:function(ac,ab){ab.rows=m;ab.refresh=c;Ext.state.Manager.set(u,ab);return false}},view:new Ext.grid.GridView({forceFit:true,autoFill:true,emptyText:"No alerts."}),bbar:new Ext.PagingToolbar({pageSize:m,store:K,displayInfo:true,items:npc.setRefreshCombo(u,K,N),plugins:new Ext.ux.Andrie.pPageSize({gridId:u})})});var F=new Ext.data.JsonStore({url:"npc.php?module=downtime&action=getDowntime&p_id="+y,totalProperty:"totalCount",root:"data",fields:[{name:"entry_time",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"scheduled_start_time",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"scheduled_end_time",type:"date",dateFormat:"Y-m-d H:i:s"},"author_name","comment_data"],autoload:true});var d=new Ext.grid.ColumnModel([{header:"Entry Time",dataIndex:"entry_time",renderer:npc.formatDate,width:120},{header:"Start Time",dataIndex:"scheduled_start_time",renderer:npc.formatDate,width:120},{header:"End Time",dataIndex:"scheduled_end_time",renderer:npc.formatDate,width:120},{header:"User",dataIndex:"author_name",width:100},{header:"Comment",dataIndex:"comment_data",width:400}]);var q=H+"-hdGrid";var aa=Ext.state.Manager.get(q);var C=(aa&&aa.rows)?aa.rows:15;var S=(aa&&aa.refresh)?aa.refresh:60;var V=new Ext.grid.GridPanel({id:q,title:"Scheduled Downtime History",height:800,layout:"fit",autoScroll:true,store:F,cm:d,autoExpandColumn:"comment_data",stripeRows:true,listeners:{beforestatesave:function(ac,ab){ab.rows=C;ab.refresh=S;Ext.state.Manager.set(q,ab);return false}},view:new Ext.grid.GridView({forceFit:true,autoFill:true,emptyText:"No downtime."}),bbar:new Ext.PagingToolbar({pageSize:C,store:F,displayInfo:true,items:npc.setRefreshCombo(q,F,aa),plugins:new Ext.ux.Andrie.pPageSize({gridId:q})})});var e=new Ext.data.JsonStore({url:"npc.php?module=comments&action=getComments&p_id="+y,totalProperty:"totalCount",root:"data",fields:["comment_id","instance_id",{name:"comment_time",type:"date",dateFormat:"Y-m-d H:i:s"},"entry_type","author_name","comment_data","is_persistent","internal_comment_id",{name:"expiration_time",type:"date",dateFormat:"Y-m-d H:i:s"}],autoload:true});var i=new Ext.grid.ColumnModel([{header:"Entry Time",dataIndex:"comment_time",renderer:npc.formatDate,width:120},{header:"Author",dataIndex:"author_name",width:100},{header:"Comment",dataIndex:"comment_data",width:400},{header:"Persistent",dataIndex:"is_persistent",renderer:npc.renderPersistent,width:80},{header:"Type",dataIndex:"entry_type",renderer:npc.renderCommentType,width:100},{header:"Expires",dataIndex:"expiration_time",renderer:npc.renderCommentExpires,width:120},{header:"Delete",dataIndex:"internal_comment_id",renderer:I,align:"center",width:50}]);var s=H+"-hcGrid";var L=Ext.state.Manager.get(s);var h=(L&&L.rows)?L.rows:15;var n=(L&&L.refresh)?L.refresh:60;var g=new Ext.grid.GridPanel({id:s,host_object_id:y,title:"Comments",height:800,layout:"fit",autoScroll:true,store:e,cm:i,autoExpandColumn:"comment_data",stripeRows:true,listeners:{beforestatesave:function(ac,ab){ab.rows=h;ab.refresh=n;Ext.state.Manager.set(s,ab);return false}},view:new Ext.grid.GridView({forceFit:true,autoFill:true,emptyText:"No comments."}),tbar:[{text:"New Comment",iconCls:"commentAdd",handler:function(){npc.addComment("host",J.data.host_name)}},"-",{text:"Delete comments",tooltip:"Delete all comments",iconCls:"commentsDelete",handler:function(){Ext.Msg.show({title:"Confirm Delete",msg:"Are you sure you want to delete all comments?",buttons:Ext.Msg.YESNO,fn:function(ab){if(ab=="yes"){npc.aPost({module:"nagios",action:"command",p_command:"DEL_ALL_HOST_COMMENTS",p_host_name:J.data.host_name})}},animEl:"elId",icon:Ext.MessageBox.QUESTION})}}],bbar:new Ext.PagingToolbar({pageSize:h,store:e,displayInfo:true,items:npc.setRefreshCombo(q,e,L),plugins:new Ext.ux.Andrie.pPageSize({gridId:s})})});var l=Ext.getCmp(D);l.add(A);l.add(f);l.add(P);l.add(V);l.add(g);l.add({id:"hdNotes"+y,title:"Additional Information",disabled:true,tabTip:"Enabled by setting the notes_url parameter in your Nagios host definition."});Z.doLayout();A.render();f.render();P.render();V.render();g.render();l.setActiveTab(A);X.load();j.load();O.load({params:{start:0,limit:R}});K.load({params:{start:0,limit:m}});F.load({params:{start:0,limit:C}});e.load({params:{start:0,limit:h}});X.startAutoRefresh(60);j.startAutoRefresh(60);O.startAutoRefresh(k);K.startAutoRefresh(c);F.startAutoRefresh(S);e.startAutoRefresh(n);var M={destroy:function(){X.stopAutoRefresh();j.stopAutoRefresh();O.stopAutoRefresh();K.stopAutoRefresh();F.stopAutoRefresh();e.stopAutoRefresh();if(!T.items.length){Z.remove(G,true)}}};Q.addListener(M);g.addListener("cellclick",function(ab,af,ac,ad){var ae=ab.getStore().getAt(af);var ag=ab.getColumnModel().getDataIndex(ac);if(ag=="internal_comment_id"){Ext.Msg.show({title:"Confirm Delete",msg:"Are you sure you want to delete this comment?",buttons:Ext.Msg.YESNO,fn:function(ai){if(ai=="yes"){var ah={module:"nagios",action:"command",p_command:"DEL_HOST_COMMENT",p_comment_id:ae.get(ag)};npc.aPost(ah)}},animEl:"elId",icon:Ext.MessageBox.QUESTION})}});X.on("load",function(){npc.hostCommandMenu(X.data.items[0].data,U);var ab=X.data.items[0].data.notes_url;var ad=Ext.getCmp("hdNotes"+y);if(ab&&ad.disabled){l.remove(ad);l.add({id:"hdNotes"+y,title:"Additional Information",disabled:false,layout:"fit",deferredRender:false,layoutOnTabChange:true,scripts:true,items:[new Ext.ux.IFrameComponent({url:ab})]});l.doLayout()}if(!Ext.getCmp("dimb"+y)){var ac=X.data.items[0].data.perfdata;if(ac!=""){A.getTopToolbar().add("-",{text:"Data Input Method",id:"dimb"+y,iconCls:"scriptAdd",handler:function(){Ext.Msg.show({title:"Create Data Input Method",msg:"Are you sure you want to create a data input method for this host?",buttons:Ext.Msg.YESNO,fn:function(af){if(af=="yes"){var ae={module:"cacti",action:"addDataInputMethod",p_host:J.data.host_name,p_object_id:y};npc.aPost(ae)}},animEl:"elId",icon:Ext.MessageBox.QUESTION})}})}}})};npc.hostgroupOverview=function(){var o="Hostgroup Overview";var e="hostgroupOverview-tab";var i=e+"-grid";var d="npc.php?module=hostgroups&action=getOverview";var c=Ext.state.Manager.get(i);var m=(c&&c.rows)?c.rows:15;var k=(c&&c.refresh)?c.refresh:60;var b="hosts-tab";npc.addCenterNestedTab(b,"Hosts");var h=Ext.getCmp("centerTabPanel");var n="hosts-tab-inner-panel";var g=Ext.getCmp(n);var f=Ext.getCmp(e);if(f){g.setActiveTab(f);return}else{g.add({id:e,title:o,height:600,layout:"fit",closable:true}).show();g.setActiveTab(f);f=Ext.getCmp(e)}var q=new Ext.data.GroupingStore({url:d,autoload:true,sortInfo:{field:"host_name",direction:"ASC"},reader:new Ext.data.JsonReader({totalProperty:"totalCount",root:"data"},[{name:"instance_id",type:"int"},{name:"hostgroup_object_id",type:"int"},"alias","host_name",{name:"host_state",type:"int"},{name:"critical",type:"int"},{name:"warning",type:"int"},{name:"unknown",type:"int"},{name:"ok",type:"int"},{name:"pending",type:"int"}]),groupField:"alias"});var p=new Ext.grid.ColumnModel([{header:"Hostgroup",dataIndex:"alias",hidden:true},{header:"Host",dataIndex:"host_name",sortable:true,width:100},{header:"Status",dataIndex:"host_state",align:"center",width:40,renderer:npc.hostStatusImage},{id:"hgHostTotalsCRITICAL",header:"Critical",dataIndex:"critical",align:"center",width:40,renderer:npc.renderStatusBg},{id:"hgHostTotalsWARNING",header:"Warning",dataIndex:"warning",align:"center",width:45,renderer:npc.renderStatusBg},{id:"hgHostTotalsUNKNOWN",header:"Unknown",dataIndex:"unknown",align:"center",width:45,renderer:npc.renderStatusBg},{id:"hgHostTotalsOK",header:"Ok",dataIndex:"ok",align:"center",width:25,renderer:npc.renderStatusBg},{id:"hgHostTotalsPENDING",header:"Pending",dataIndex:"pending",align:"center",width:45,renderer:npc.renderStatusBg}]);var a=new Ext.grid.GridPanel({id:"hostgroup-overview-portlet-grid",height:800,layout:"fit",autoExpandColumn:"host_name",autoScroll:true,store:q,cm:p,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),stripeRows:true,listeners:{beforestatesave:function(u,t){t.rows=m;t.refresh=k;Ext.state.Manager.set(i,t);return false}},view:new Ext.grid.GroupingView({forceFit:true,autoFill:true,hideGroupedColumn:true,enableGroupingMenu:false,enableNoGroups:true,emptyText:"No hostgroups.",groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "Hosts" : "Host"]})'}),bbar:new Ext.PagingToolbar({pageSize:m,store:q,displayInfo:true,displayMsg:"",items:npc.setRefreshCombo(i,q,c),plugins:new Ext.ux.Andrie.pPageSize({gridId:i})})});f.add(a);h.doLayout();a.render();a.store.load({params:{start:0,limit:m}});q.startAutoRefresh(k);var l={destroy:function(){q.stopAutoRefresh();if(!g.items.length){h.remove(b,true)}}};f.addListener(l);a.on("rowdblclick",j);a.on("rowcontextmenu",npc.hostContextMenu);function j(t,w,v){var u=t.getStore().getAt(w).json.hostgroup_object_id;var s=t.getStore().getAt(w).json.alias;npc.hostgroupGrid("hostgroupGrid-"+u,"Hostgroup: "+s,u)}};npc.hostCommandMenu=function(e,g){var f;var b;g.removeAll();var d={module:"nagios",action:"command",p_host_name:e.host_name};var c='<b style="font-size: xx-small">';if(e.current_state==1){if(e.problem_has_been_acknowledged){g.add({text:c+"Remove Problem Acknowledgement</b>",handler:function(a){d.p_command="REMOVE_HOST_ACKNOWLEDGEMENT";d.p_host_name=e.host_name;npc.doCommand(a.text+"?",d)}})}else{g.add({text:c+"Acknowledge Problem</b>",handler:function(a){npc.ackProblem("host",e.host_name)}})}}g.add({text:c+"Re-schedule Next Check</b>",handler:function(){npc.scheduleNextCheck("host",e.host_name)}});b=e.active_checks_enabled?"Disable":"Enable";f=c+b+" Active Checks</b>";g.add({action:b,text:f,handler:function(a){d.p_command=a.action.toUpperCase()+"_HOST_CHECK";npc.doCommand(a.text+"?",d)}});b=e.notifications_enabled?"Disable":"Enable";f=c+b+" Notifications</b>";g.add({action:b,text:f,handler:function(a){d.p_command=a.action.toUpperCase()+"_HOST_NOTIFICATIONS";npc.doCommand(a.text+"?",d)}});g.add({text:c+"Send Custom Notification</b>",handler:function(){npc.sendCustomNotification("host",e.host_name)}});if(e.passive_checks_enabled){g.add({text:c+"Submit Passive Check Result</b>",handler:function(){npc.submitPassiveCheckResult("host",e.host_name)}})}g.add({text:c+"Schedule Downtime</b>",handler:function(){npc.scheduleDowntime("host",e.host_name)}});b=e.passive_checks_enabled?"Stop":"Start";f=c+b+" Accepting Passive Checks</b>";g.add({action:b,text:f,handler:function(a){d.p_command=a.action.toUpperCase()+"_PASSIVE_HOST_CHECKS</b>";npc.doCommand(a.text+"?",d)}});b=e.event_handler_enabled?"Disable":"Enable";f=c+b+" Event Handler</b>";g.add({action:b,text:f,handler:function(a){d.p_command=a.action.toUpperCase()+"_HOST_EVENT_HANDLER";npc.doCommand(a.text+"?",d)}});b=e.flap_detection_enabled?"Disable":"Enable";f=c+b+" Flap Detection</b>";g.add({action:b,text:f,handler:function(a){d.p_command=a.action.toUpperCase()+"_HOST_FLAP_DETECTION";npc.doCommand(a.text+"?",d)}});if(e.current_state==1){g.add({text:c+"Delay next notification</b>",handler:function(){npc.delayNextNotification("host",e.host_name)}})}b=e.obsess_over_host?"Stop":"Start";f=c+b+" Obsessing</b>";g.add({action:b,text:f,handler:function(a){d.p_command=a.action.toUpperCase()+"_OBSESSING_OVER_HOST";npc.doCommand(a.text+"?",d)}});g.add({text:c+"Schedule Check of all Services</b>",handler:function(){npc.scheduleNextCheck("host_svc",e.host_name)}});g.add({text:c+"Disable notifications for all services</b>",handler:function(a){d.p_command="DISABLE_HOST_SVC_NOTIFICATIONS";npc.doCommand(a.text+"?",d)}});g.add({text:c+"Enable notifications for all services</b>",handler:function(a){d.p_command="ENABLE_HOST_SVC_NOTIFICATIONS";npc.doCommand(a.text+"?",d)}});g.add({text:c+"Disable checks of all services</b>",handler:function(a){d.p_command="DISABLE_HOST_SVC_CHECKS";npc.doCommand(a.text+"?",d)}});g.add({text:c+"Enable checks of all services</b>",handler:function(a){d.p_command="ENABLE_HOST_SVC_CHECKS";npc.doCommand(a.text+"?",d)}});return(g)};npc.hostgroupCommandMenu=function(c,d){d.removeAll();var b={module:"nagios",action:"command",p_hostgroup_name:c.hostgroup_name};var a='<b style="font-size: xx-small">';d.add({text:a+"Schedule Downtime for all Services</b>",handler:function(){npc.scheduleHostgroupDowntime(c.hostgroup_name,"SVC")}});d.add({text:a+"Schedule Downtime for all Hosts</b>",handler:function(){npc.scheduleHostgroupDowntime(c.hostgroup_name,"HOST")}});d.add({text:a+"Enable Notifications for all Hosts</b>",handler:function(e){b.p_command="ENABLE_HOSTGROUP_HOST_NOTIFICATIONS";npc.doCommand(e.text+"?",b)}});d.add({text:a+"Disable Notifications for all Hosts</b>",handler:function(e){b.p_command="DISABLE_HOSTGROUP_HOST_NOTIFICATIONS";npc.doCommand(e.text+"?",b)}});d.add({text:a+"Enable Notifications for all Services</b>",handler:function(e){b.p_command="ENABLE_HOSTGROUP_SVC_NOTIFICATIONS";npc.doCommand(e.text+"?",b)}});d.add({text:a+"Disable Notifications for all Services</b>",handler:function(e){b.p_command="DISABLE_HOSTGROUP_SVC_NOTIFICATIONS";npc.doCommand(e.text+"?",b)}});d.add({text:a+"Enable Active Checks of all Services</b>",handler:function(e){b.p_command="ENABLE_HOSTGROUP_SVC_CHECKS";npc.doCommand(e.text+"?",b)}});d.add({text:a+"Disable Active Checks of all Services</b>",handler:function(e){b.p_command="DISABLE_HOSTGROUP_SVC_CHECKS";npc.doCommand(e.text+"?",b)}});return(d)};